import{__esmMin as e,__export as t}from"./chunk-___ucjiX.js";import{StreamResponseFormatHeader as n}from"./api-_RFSw3t6.js";import*as r from"zod/v4";import i,{z as a}from"zod/v4";import{ZodFirstPartyTypeKind as o}from"zod/v3";var s=`vercel.ai.error`,c=Symbol.for(s),l,u=class e extends Error{constructor({name:e,message:t,cause:n}){super(t),this[l]=!0,this.name=e,this.cause=n}static isInstance(t){return e.hasMarker(t,s)}static hasMarker(e,t){let n=Symbol.for(t);return typeof e==`object`&&!!e&&n in e&&typeof e[n]==`boolean`&&e[n]===!0}};l=c;var d=u,f=`AI_APICallError`,p=`vercel.ai.error.${f}`,m=Symbol.for(p),h,g=class extends d{constructor({message:e,url:t,requestBodyValues:n,statusCode:r,responseHeaders:i,responseBody:a,cause:o,isRetryable:s=r!=null&&(r===408||r===409||r===429||r>=500),data:c}){super({name:f,message:e,cause:o}),this[h]=!0,this.url=t,this.requestBodyValues=n,this.statusCode=r,this.responseHeaders=i,this.responseBody=a,this.isRetryable=s,this.data=c}static isInstance(e){return d.hasMarker(e,p)}};h=m;var _=`AI_EmptyResponseBodyError`,v=`vercel.ai.error.${_}`,y=Symbol.for(v),b,x=class extends d{constructor({message:e=`Empty response body`}={}){super({name:_,message:e}),this[b]=!0}static isInstance(e){return d.hasMarker(e,v)}};b=y;function S(e){return e==null?`unknown error`:typeof e==`string`?e:e instanceof Error?e.message:JSON.stringify(e)}var C=`AI_InvalidArgumentError`,w=`vercel.ai.error.${C}`,T=Symbol.for(w),E,D=class extends d{constructor({message:e,cause:t,argument:n}){super({name:C,message:e,cause:t}),this[E]=!0,this.argument=n}static isInstance(e){return d.hasMarker(e,w)}};E=T;var O=`AI_InvalidPromptError`,ee=`vercel.ai.error.${O}`,k=Symbol.for(ee),te,A=class extends d{constructor({prompt:e,message:t,cause:n}){super({name:O,message:`Invalid prompt: ${t}`,cause:n}),this[te]=!0,this.prompt=e}static isInstance(e){return d.hasMarker(e,ee)}};te=k;var j=`AI_InvalidResponseDataError`,M=`vercel.ai.error.${j}`,N=Symbol.for(M),P,ne=class extends d{constructor({data:e,message:t=`Invalid response data: ${JSON.stringify(e)}.`}){super({name:j,message:t}),this[P]=!0,this.data=e}static isInstance(e){return d.hasMarker(e,M)}};P=N;var re=`AI_JSONParseError`,ie=`vercel.ai.error.${re}`,ae=Symbol.for(ie),oe,se=class extends d{constructor({text:e,cause:t}){super({name:re,message:`JSON parsing failed: Text: ${e}.
Error message: ${S(t)}`,cause:t}),this[oe]=!0,this.text=e}static isInstance(e){return d.hasMarker(e,ie)}};oe=ae;var ce=`AI_LoadAPIKeyError`,le=`vercel.ai.error.${ce}`,ue=Symbol.for(le),de,F=class extends d{constructor({message:e}){super({name:ce,message:e}),this[de]=!0}static isInstance(e){return d.hasMarker(e,le)}};de=ue;var fe=`AI_LoadSettingError`,I=`vercel.ai.error.${fe}`,pe=Symbol.for(I),me;me=pe;var he=`AI_NoContentGeneratedError`,ge=`vercel.ai.error.${he}`,_e=Symbol.for(ge),ve;ve=_e;var L=`AI_NoSuchModelError`,ye=`vercel.ai.error.${L}`,be=Symbol.for(ye),R,xe=class extends d{constructor({errorName:e=L,modelId:t,modelType:n,message:r=`No such ${n}: ${t}`}){super({name:e,message:r}),this[R]=!0,this.modelId=t,this.modelType=n}static isInstance(e){return d.hasMarker(e,ye)}};R=be;var Se=`AI_TooManyEmbeddingValuesForCallError`,Ce=`vercel.ai.error.${Se}`,we=Symbol.for(Ce),Te,Ee=class extends d{constructor(e){super({name:Se,message:`Too many values for a single embedding call. The ${e.provider} model "${e.modelId}" can only embed up to ${e.maxEmbeddingsPerCall} values per call, but ${e.values.length} values were provided.`}),this[Te]=!0,this.provider=e.provider,this.modelId=e.modelId,this.maxEmbeddingsPerCall=e.maxEmbeddingsPerCall,this.values=e.values}static isInstance(e){return d.hasMarker(e,Ce)}};Te=we;var De=`AI_TypeValidationError`,Oe=`vercel.ai.error.${De}`,ke=Symbol.for(Oe),Ae,je=class e extends d{constructor({value:e,cause:t}){super({name:De,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${S(t)}`,cause:t}),this[Ae]=!0,this.value=e}static isInstance(e){return d.hasMarker(e,Oe)}static wrap({value:t,cause:n}){return e.isInstance(n)&&n.value===t?n:new e({value:t,cause:n})}};Ae=ke;var Me=je,Ne=`AI_UnsupportedFunctionalityError`,Pe=`vercel.ai.error.${Ne}`,Fe=Symbol.for(Pe),Ie,z=class extends d{constructor({functionality:e,message:t=`'${e}' functionality not supported.`}){super({name:Ne,message:t}),this[Ie]=!0,this.functionality=e}static isInstance(e){return d.hasMarker(e,Pe)}};Ie=Fe;var Le=class extends Error{constructor(e,t){super(e),this.name=`ParseError`,this.type=t.type,this.field=t.field,this.value=t.value,this.line=t.line}};function Re(e){}function ze(e){if(typeof e==`function`)throw TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");let{onEvent:t=Re,onError:n=Re,onRetry:r=Re,onComment:i}=e,a=``,o=!0,s,c=``,l=``;function u(e){let t=o?e.replace(/^\xEF\xBB\xBF/,``):e,[n,r]=Be(`${a}${t}`);for(let e of n)d(e);a=r,o=!1}function d(e){if(e===``){p();return}if(e.startsWith(`:`)){i&&i(e.slice(e.startsWith(`: `)?2:1));return}let t=e.indexOf(`:`);if(t!==-1){let n=e.slice(0,t),r=e[t+1]===` `?2:1,i=e.slice(t+r);f(n,i,e);return}f(e,``,e)}function f(e,t,i){switch(e){case`event`:l=t;break;case`data`:c=`${c}${t}
`;break;case`id`:s=t.includes(`\0`)?void 0:t;break;case`retry`:/^\d+$/.test(t)?r(parseInt(t,10)):n(new Le(`Invalid \`retry\` value: "${t}"`,{type:`invalid-retry`,value:t,line:i}));break;default:n(new Le(`Unknown field "${e.length>20?`${e.slice(0,20)}\u2026`:e}"`,{type:`unknown-field`,field:e,value:t,line:i}));break}}function p(){c.length>0&&t({id:s,event:l||void 0,data:c.endsWith(`
`)?c.slice(0,-1):c}),s=void 0,c=``,l=``}function m(e={}){a&&e.consume&&d(a),o=!0,s=void 0,c=``,l=``,a=``}return{feed:u,reset:m}}function Be(e){let t=[],n=``,r=0;for(;r<e.length;){let i=e.indexOf(`\r`,r),a=e.indexOf(`
`,r),o=-1;if(i!==-1&&a!==-1?o=Math.min(i,a):i===-1?a!==-1&&(o=a):o=i===e.length-1?-1:i,o===-1){n=e.slice(r);break}else{let n=e.slice(r,o);t.push(n),r=o+1,e[r-1]===`\r`&&e[r]===`
`&&r++}}return[t,n]}var Ve=class extends TransformStream{constructor({onError:e,onRetry:t,onComment:n}={}){let r;super({start(i){r=ze({onEvent:e=>{i.enqueue(e)},onError(t){e===`terminate`?i.error(t):typeof e==`function`&&e(t)},onRetry:t,onComment:n})},transform(e){r.feed(e)}})}};function B(...e){return e.reduce((e,t)=>({...e,...t??{}}),{})}async function He(e,t){if(e==null)return Promise.resolve();let n=t?.abortSignal;return new Promise((t,r)=>{if(n?.aborted){r(Ue());return}let i=setTimeout(()=>{a(),t()},e),a=()=>{clearTimeout(i),n?.removeEventListener(`abort`,o)},o=()=>{a(),r(Ue())};n?.addEventListener(`abort`,o)})}function Ue(){return new DOMException(`Delay was aborted`,`AbortError`)}function We(e){return Object.fromEntries([...e.headers])}var Ge=({prefix:e,size:t=16,alphabet:n=`0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz`,separator:r=`-`}={})=>{let i=()=>{let e=n.length,r=Array(t);for(let i=0;i<t;i++)r[i]=n[Math.random()*e|0];return r.join(``)};if(e==null)return i;if(n.includes(r))throw new D({argument:`separator`,message:`The separator "${r}" must not be part of the alphabet "${n}".`});return()=>`${e}${r}${i()}`},V=Ge();function Ke(e){return e==null?`unknown error`:typeof e==`string`?e:e instanceof Error?e.message:JSON.stringify(e)}function qe(e){return(e instanceof Error||e instanceof DOMException)&&(e.name===`AbortError`||e.name===`ResponseAborted`||e.name===`TimeoutError`)}var Je=[`fetch failed`,`failed to fetch`];function Ye({error:e,url:t,requestBodyValues:n}){if(qe(e))return e;if(e instanceof TypeError&&Je.includes(e.message.toLowerCase())){let r=e.cause;if(r!=null)return new g({message:`Cannot connect to API: ${r.message}`,cause:r,url:t,requestBodyValues:n,isRetryable:!0})}return e}function Xe(e){return Object.fromEntries(Object.entries(e).filter(([e,t])=>t!=null))}var Ze=()=>globalThis.fetch,Qe=async({url:e,headers:t={},successfulResponseHandler:n,failedResponseHandler:r,abortSignal:i,fetch:a=Ze()})=>{try{let o=await a(e,{method:`GET`,headers:Xe(t),signal:i}),s=We(o);if(!o.ok){let t;try{t=await r({response:o,url:e,requestBodyValues:{}})}catch(t){throw qe(t)||g.isInstance(t)?t:new g({message:`Failed to process error response`,cause:t,statusCode:o.status,url:e,responseHeaders:s,requestBodyValues:{}})}throw t.value}try{return await n({response:o,url:e,requestBodyValues:{}})}catch(t){throw t instanceof Error&&(qe(t)||g.isInstance(t))?t:new g({message:`Failed to process successful response`,cause:t,statusCode:o.status,url:e,responseHeaders:s,requestBodyValues:{}})}}catch(t){throw Ye({error:t,url:e,requestBodyValues:{}})}};function $e({mediaType:e,url:t,supportedUrls:n}){return t=t.toLowerCase(),e=e.toLowerCase(),Object.entries(n).map(([e,t])=>{let n=e.toLowerCase();return n===`*`||n===`*/*`?{mediaTypePrefix:``,regexes:t}:{mediaTypePrefix:n.replace(/\*/,``),regexes:t}}).filter(({mediaTypePrefix:t})=>e.startsWith(t)).flatMap(({regexes:e})=>e).some(e=>e.test(t))}function et({apiKey:e,environmentVariableName:t,apiKeyParameterName:n=`apiKey`,description:r}){if(typeof e==`string`)return e;if(e!=null)throw new F({message:`${r} API key must be a string.`});if(typeof process>`u`)throw new F({message:`${r} API key is missing. Pass it using the '${n}' parameter. Environment variables is not supported in this environment.`});if(e=process.env[t],e==null)throw new F({message:`${r} API key is missing. Pass it using the '${n}' parameter or the ${t} environment variable.`});if(typeof e!=`string`)throw new F({message:`${r} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}function tt({settingValue:e,environmentVariableName:t}){if(typeof e==`string`||!(e!=null||typeof process>`u`)&&(e=process.env[t],!(e==null||typeof e!=`string`)))return e}function nt(e){var t;let[n,r=``]=e.toLowerCase().split(`/`);return(t={mpeg:`mp3`,"x-wav":`wav`,opus:`ogg`,mp4:`m4a`,"x-m4a":`m4a`}[r])??r}var rt=/"__proto__"\s*:/,it=/"constructor"\s*:/;function at(e){let t=JSON.parse(e);return typeof t!=`object`||!t||rt.test(e)===!1&&it.test(e)===!1?t:ot(t)}function ot(e){let t=[e];for(;t.length;){let e=t;t=[];for(let n of e){if(Object.prototype.hasOwnProperty.call(n,`__proto__`)||Object.prototype.hasOwnProperty.call(n,`constructor`)&&Object.prototype.hasOwnProperty.call(n.constructor,`prototype`))throw SyntaxError(`Object contains forbidden prototype property`);for(let e in n){let r=n[e];r&&typeof r==`object`&&t.push(r)}}}return e}function st(e){let{stackTraceLimit:t}=Error;Error.stackTraceLimit=0;try{return at(e)}finally{Error.stackTraceLimit=t}}var ct=Symbol.for(`vercel.ai.validator`);function lt(e){return{[ct]:!0,validate:e}}function ut(e){return typeof e==`object`&&!!e&&ct in e&&e[ct]===!0&&`validate`in e}function dt(e){return ut(e)?e:ft(e)}function ft(e){return lt(async t=>{let n=await e[`~standard`].validate(t);return n.issues==null?{success:!0,value:n.value}:{success:!1,error:new Me({value:t,cause:n.issues})}})}async function pt({value:e,schema:t}){let n=await mt({value:e,schema:t});if(!n.success)throw Me.wrap({value:e,cause:n.error});return n.value}async function mt({value:e,schema:t}){let n=dt(t);try{if(n.validate==null)return{success:!0,value:e,rawValue:e};let t=await n.validate(e);return t.success?{success:!0,value:t.value,rawValue:e}:{success:!1,error:Me.wrap({value:e,cause:t.error}),rawValue:e}}catch(t){return{success:!1,error:Me.wrap({value:e,cause:t}),rawValue:e}}}async function ht({text:e,schema:t}){try{let n=st(e);return t==null?n:pt({value:n,schema:t})}catch(t){throw se.isInstance(t)||Me.isInstance(t)?t:new se({text:e,cause:t})}}async function gt({text:e,schema:t}){try{let n=st(e);return t==null?{success:!0,value:n,rawValue:n}:await mt({value:n,schema:t})}catch(t){return{success:!1,error:se.isInstance(t)?t:new se({text:e,cause:t}),rawValue:void 0}}}function _t(e){try{return st(e),!0}catch{return!1}}function vt({stream:e,schema:t}){return e.pipeThrough(new TextDecoderStream).pipeThrough(new Ve).pipeThrough(new TransformStream({async transform({data:e},n){e!==`[DONE]`&&n.enqueue(await gt({text:e,schema:t}))}}))}async function H({provider:e,providerOptions:t,schema:n}){if(t?.[e]==null)return;let r=await mt({value:t[e],schema:n});if(!r.success)throw new D({argument:`providerOptions`,message:`invalid ${e} provider options`,cause:r.error});return r.value}var yt=()=>globalThis.fetch,U=async({url:e,headers:t,body:n,failedResponseHandler:r,successfulResponseHandler:i,abortSignal:a,fetch:o})=>xt({url:e,headers:{"Content-Type":`application/json`,...t},body:{content:JSON.stringify(n),values:n},failedResponseHandler:r,successfulResponseHandler:i,abortSignal:a,fetch:o}),bt=async({url:e,headers:t,formData:n,failedResponseHandler:r,successfulResponseHandler:i,abortSignal:a,fetch:o})=>xt({url:e,headers:t,body:{content:n,values:Object.fromEntries(n.entries())},failedResponseHandler:r,successfulResponseHandler:i,abortSignal:a,fetch:o}),xt=async({url:e,headers:t={},body:n,successfulResponseHandler:r,failedResponseHandler:i,abortSignal:a,fetch:o=yt()})=>{try{let s=await o(e,{method:`POST`,headers:Xe(t),body:n.content,signal:a}),c=We(s);if(!s.ok){let t;try{t=await i({response:s,url:e,requestBodyValues:n.values})}catch(t){throw qe(t)||g.isInstance(t)?t:new g({message:`Failed to process error response`,cause:t,statusCode:s.status,url:e,responseHeaders:c,requestBodyValues:n.values})}throw t.value}try{return await r({response:s,url:e,requestBodyValues:n.values})}catch(t){throw t instanceof Error&&(qe(t)||g.isInstance(t))?t:new g({message:`Failed to process successful response`,cause:t,statusCode:s.status,url:e,responseHeaders:c,requestBodyValues:n.values})}}catch(t){throw Ye({error:t,url:e,requestBodyValues:n.values})}};function St(e){return e}function W({id:e,name:t,inputSchema:n}){return({execute:r,outputSchema:i,toModelOutput:a,onInputStart:o,onInputDelta:s,onInputAvailable:c,...l})=>St({type:`provider-defined`,id:e,name:t,args:l,inputSchema:n,outputSchema:i,execute:r,toModelOutput:a,onInputStart:o,onInputDelta:s,onInputAvailable:c})}function Ct({id:e,name:t,inputSchema:n,outputSchema:r}){return({execute:i,toModelOutput:a,onInputStart:o,onInputDelta:s,onInputAvailable:c,...l})=>St({type:`provider-defined`,id:e,name:t,args:l,inputSchema:n,outputSchema:r,execute:i,toModelOutput:a,onInputStart:o,onInputDelta:s,onInputAvailable:c})}async function G(e){return typeof e==`function`&&(e=e()),Promise.resolve(e)}var wt=({errorSchema:e,errorToMessage:t,isRetryable:n})=>async({response:r,url:i,requestBodyValues:a})=>{let o=await r.text(),s=We(r);if(o.trim()===``)return{responseHeaders:s,value:new g({message:r.statusText,url:i,requestBodyValues:a,statusCode:r.status,responseHeaders:s,responseBody:o,isRetryable:n?.(r)})};try{let c=await ht({text:o,schema:e});return{responseHeaders:s,value:new g({message:t(c),url:i,requestBodyValues:a,statusCode:r.status,responseHeaders:s,responseBody:o,data:c,isRetryable:n?.(r,c)})}}catch{return{responseHeaders:s,value:new g({message:r.statusText,url:i,requestBodyValues:a,statusCode:r.status,responseHeaders:s,responseBody:o,isRetryable:n?.(r)})}}},Tt=e=>async({response:t})=>{let n=We(t);if(t.body==null)throw new x({});return{responseHeaders:n,value:vt({stream:t.body,schema:e})}},K=e=>async({response:t,url:n,requestBodyValues:r})=>{let i=await t.text(),a=await gt({text:i,schema:e}),o=We(t);if(!a.success)throw new g({message:`Invalid JSON response`,cause:a.error,statusCode:t.status,responseHeaders:o,responseBody:i,url:n,requestBodyValues:r});return{responseHeaders:o,value:a.value,rawValue:a.rawValue}},Et=()=>async({response:e,url:t,requestBodyValues:n})=>{let r=We(e);if(!e.body)throw new g({message:`Response body is empty`,url:t,requestBodyValues:n,statusCode:e.status,responseHeaders:r,responseBody:void 0});try{let t=await e.arrayBuffer();return{responseHeaders:r,value:new Uint8Array(t)}}catch(i){throw new g({message:`Failed to read response as array buffer`,url:t,requestBodyValues:n,statusCode:e.status,responseHeaders:r,responseBody:void 0,cause:i})}},Dt=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join(`/`)},Ot=Symbol(`Let zodToJsonSchema decide on which parser to use`),kt={name:void 0,$refStrategy:`root`,basePath:[`#`],effectStrategy:`input`,pipeStrategy:`all`,dateStrategy:`format:date-time`,mapStrategy:`entries`,removeAdditionalStrategy:`passthrough`,allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:`definitions`,strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:`escape`,applyRegexFlags:!1,emailStrategy:`format:email`,base64Strategy:`contentEncoding:base64`,nameStrategy:`ref`},At=e=>typeof e==`string`?{...kt,name:e}:{...kt,...e};function q(){return{}}function jt(e,t){var n,r,i;let a={type:`array`};return(n=e.type)?._def&&(i=(r=e.type)?._def)?.typeName!==o.ZodAny&&(a.items=X(e.type._def,{...t,currentPath:[...t.currentPath,`items`]})),e.minLength&&(a.minItems=e.minLength.value),e.maxLength&&(a.maxItems=e.maxLength.value),e.exactLength&&(a.minItems=e.exactLength.value,a.maxItems=e.exactLength.value),a}function Mt(e){let t={type:`integer`,format:`int64`};if(!e.checks)return t;for(let n of e.checks)switch(n.kind){case`min`:n.inclusive?t.minimum=n.value:t.exclusiveMinimum=n.value;break;case`max`:n.inclusive?t.maximum=n.value:t.exclusiveMaximum=n.value;break;case`multipleOf`:t.multipleOf=n.value;break}return t}function Nt(){return{type:`boolean`}}function Pt(e,t){return X(e.type._def,t)}var Ft=(e,t)=>X(e.innerType._def,t);function It(e,t,n){let r=n??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((n,r)=>It(e,t,n))};switch(r){case`string`:case`format:date-time`:return{type:`string`,format:`date-time`};case`format:date`:return{type:`string`,format:`date`};case`integer`:return Lt(e)}}var Lt=e=>{let t={type:`integer`,format:`unix-time`};for(let n of e.checks)switch(n.kind){case`min`:t.minimum=n.value;break;case`max`:t.maximum=n.value;break}return t};function Rt(e,t){return{...X(e.innerType._def,t),default:e.defaultValue()}}function zt(e,t){return t.effectStrategy===`input`?X(e.schema._def,t):q()}function Bt(e){return{type:`string`,enum:Array.from(e.values)}}var Vt=e=>`type`in e&&e.type===`string`?!1:`allOf`in e;function Ht(e,t){let n=[X(e.left._def,{...t,currentPath:[...t.currentPath,`allOf`,`0`]}),X(e.right._def,{...t,currentPath:[...t.currentPath,`allOf`,`1`]})].filter(e=>!!e),r=[];return n.forEach(e=>{if(Vt(e))r.push(...e.allOf);else{let t=e;if(`additionalProperties`in e&&e.additionalProperties===!1){let{additionalProperties:n,...r}=e;t=r}r.push(t)}}),r.length?{allOf:r}:void 0}function Ut(e){let t=typeof e.value;return t!==`bigint`&&t!==`number`&&t!==`boolean`&&t!==`string`?{type:Array.isArray(e.value)?`array`:`object`}:{type:t===`bigint`?`integer`:t,const:e.value}}var Wt=void 0,J={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Wt===void 0&&(Wt=RegExp(`^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$`,`u`)),Wt),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Gt(e,t){let n={type:`string`};if(e.checks)for(let r of e.checks)switch(r.kind){case`min`:n.minLength=typeof n.minLength==`number`?Math.max(n.minLength,r.value):r.value;break;case`max`:n.maxLength=typeof n.maxLength==`number`?Math.min(n.maxLength,r.value):r.value;break;case`email`:switch(t.emailStrategy){case`format:email`:Yt(n,`email`,r.message,t);break;case`format:idn-email`:Yt(n,`idn-email`,r.message,t);break;case`pattern:zod`:Y(n,J.email,r.message,t);break}break;case`url`:Yt(n,`uri`,r.message,t);break;case`uuid`:Yt(n,`uuid`,r.message,t);break;case`regex`:Y(n,r.regex,r.message,t);break;case`cuid`:Y(n,J.cuid,r.message,t);break;case`cuid2`:Y(n,J.cuid2,r.message,t);break;case`startsWith`:Y(n,RegExp(`^${Kt(r.value,t)}`),r.message,t);break;case`endsWith`:Y(n,RegExp(`${Kt(r.value,t)}$`),r.message,t);break;case`datetime`:Yt(n,`date-time`,r.message,t);break;case`date`:Yt(n,`date`,r.message,t);break;case`time`:Yt(n,`time`,r.message,t);break;case`duration`:Yt(n,`duration`,r.message,t);break;case`length`:n.minLength=typeof n.minLength==`number`?Math.max(n.minLength,r.value):r.value,n.maxLength=typeof n.maxLength==`number`?Math.min(n.maxLength,r.value):r.value;break;case`includes`:Y(n,RegExp(Kt(r.value,t)),r.message,t);break;case`ip`:r.version!==`v6`&&Yt(n,`ipv4`,r.message,t),r.version!==`v4`&&Yt(n,`ipv6`,r.message,t);break;case`base64url`:Y(n,J.base64url,r.message,t);break;case`jwt`:Y(n,J.jwt,r.message,t);break;case`cidr`:r.version!==`v6`&&Y(n,J.ipv4Cidr,r.message,t),r.version!==`v4`&&Y(n,J.ipv6Cidr,r.message,t);break;case`emoji`:Y(n,J.emoji(),r.message,t);break;case`ulid`:Y(n,J.ulid,r.message,t);break;case`base64`:switch(t.base64Strategy){case`format:binary`:Yt(n,`binary`,r.message,t);break;case`contentEncoding:base64`:n.contentEncoding=`base64`;break;case`pattern:zod`:Y(n,J.base64,r.message,t);break}break;case`nanoid`:Y(n,J.nanoid,r.message,t);case`toLowerCase`:case`toUpperCase`:case`trim`:break;default:}return n}function Kt(e,t){return t.patternStrategy===`escape`?Jt(e):e}var qt=new Set(`ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789`);function Jt(e){let t=``;for(let n=0;n<e.length;n++)qt.has(e[n])||(t+=`\\`),t+=e[n];return t}function Yt(e,t,n,r){var i;e.format||(i=e.anyOf)?.some(e=>e.format)?(e.anyOf||=[],e.format&&(e.anyOf.push({format:e.format}),delete e.format),e.anyOf.push({format:t,...n&&r.errorMessages&&{errorMessage:{format:n}}})):e.format=t}function Y(e,t,n,r){var i;e.pattern||(i=e.allOf)?.some(e=>e.pattern)?(e.allOf||=[],e.pattern&&(e.allOf.push({pattern:e.pattern}),delete e.pattern),e.allOf.push({pattern:Xt(t,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):e.pattern=Xt(t,r)}function Xt(e,t){var n;if(!t.applyRegexFlags||!e.flags)return e.source;let r={i:e.flags.includes(`i`),m:e.flags.includes(`m`),s:e.flags.includes(`s`)},i=r.i?e.source.toLowerCase():e.source,a=``,o=!1,s=!1,c=!1;for(let e=0;e<i.length;e++){if(o){a+=i[e],o=!1;continue}if(r.i){if(s){if(i[e].match(/[a-z]/)){c?(a+=i[e],a+=`${i[e-2]}-${i[e]}`.toUpperCase(),c=!1):i[e+1]===`-`&&(n=i[e+2])?.match(/[a-z]/)?(a+=i[e],c=!0):a+=`${i[e]}${i[e].toUpperCase()}`;continue}}else if(i[e].match(/[a-z]/)){a+=`[${i[e]}${i[e].toUpperCase()}]`;continue}}if(r.m){if(i[e]===`^`){a+=`(^|(?<=[\r
]))`;continue}else if(i[e]===`$`){a+=`($|(?=[\r
]))`;continue}}if(r.s&&i[e]===`.`){a+=s?`${i[e]}\r
`:`[${i[e]}\r
]`;continue}a+=i[e],i[e]===`\\`?o=!0:s&&i[e]===`]`?s=!1:!s&&i[e]===`[`&&(s=!0)}try{new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join(`/`)} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return a}function Zt(e,t){var n,r,i,a,s,c;let l={type:`object`,additionalProperties:(n=X(e.valueType._def,{...t,currentPath:[...t.currentPath,`additionalProperties`]}))??t.allowedAdditionalProperties};if((r=e.keyType)?._def.typeName===o.ZodString&&(i=e.keyType._def.checks)?.length){let{type:n,...r}=Gt(e.keyType._def,t);return{...l,propertyNames:r}}else if((a=e.keyType)?._def.typeName===o.ZodEnum)return{...l,propertyNames:{enum:e.keyType._def.values}};else if((s=e.keyType)?._def.typeName===o.ZodBranded&&e.keyType._def.type._def.typeName===o.ZodString&&(c=e.keyType._def.type._def.checks)?.length){let{type:n,...r}=Pt(e.keyType._def,t);return{...l,propertyNames:r}}return l}function Qt(e,t){if(t.mapStrategy===`record`)return Zt(e,t);let n=X(e.keyType._def,{...t,currentPath:[...t.currentPath,`items`,`items`,`0`]})||q(),r=X(e.valueType._def,{...t,currentPath:[...t.currentPath,`items`,`items`,`1`]})||q();return{type:`array`,maxItems:125,items:{type:`array`,items:[n,r],minItems:2,maxItems:2}}}function $t(e){let t=e.values,n=Object.keys(e.values).filter(e=>typeof t[t[e]]!=`number`),r=n.map(e=>t[e]),i=Array.from(new Set(r.map(e=>typeof e)));return{type:i.length===1?i[0]===`string`?`string`:`number`:[`string`,`number`],enum:r}}function en(){return{not:q()}}function tn(){return{type:`null`}}var nn={ZodString:`string`,ZodNumber:`number`,ZodBigInt:`integer`,ZodBoolean:`boolean`,ZodNull:`null`};function rn(e,t){let n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every(e=>e._def.typeName in nn&&(!e._def.checks||!e._def.checks.length))){let e=n.reduce((e,t)=>{let n=nn[t._def.typeName];return n&&!e.includes(n)?[...e,n]:e},[]);return{type:e.length>1?e:e[0]}}else if(n.every(e=>e._def.typeName===`ZodLiteral`&&!e.description)){let e=n.reduce((e,t)=>{let n=typeof t._def.value;switch(n){case`string`:case`number`:case`boolean`:return[...e,n];case`bigint`:return[...e,`integer`];case`object`:if(t._def.value===null)return[...e,`null`];case`symbol`:case`undefined`:case`function`:default:return e}},[]);if(e.length===n.length){let t=e.filter((e,t,n)=>n.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:n.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(n.every(e=>e._def.typeName===`ZodEnum`))return{type:`string`,enum:n.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return an(e,t)}var an=(e,t)=>{let n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,n)=>X(e._def,{...t,currentPath:[...t.currentPath,`anyOf`,`${n}`]})).filter(e=>!!e&&(!t.strictUnions||typeof e==`object`&&Object.keys(e).length>0));return n.length?{anyOf:n}:void 0};function on(e,t){if([`ZodString`,`ZodNumber`,`ZodBigInt`,`ZodBoolean`,`ZodNull`].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return{type:[nn[e.innerType._def.typeName],`null`]};let n=X(e.innerType._def,{...t,currentPath:[...t.currentPath,`anyOf`,`0`]});return n&&{anyOf:[n,{type:`null`}]}}function sn(e){let t={type:`number`};if(!e.checks)return t;for(let n of e.checks)switch(n.kind){case`int`:t.type=`integer`;break;case`min`:n.inclusive?t.minimum=n.value:t.exclusiveMinimum=n.value;break;case`max`:n.inclusive?t.maximum=n.value:t.exclusiveMaximum=n.value;break;case`multipleOf`:t.multipleOf=n.value;break}return t}function cn(e,t){let n={type:`object`,properties:{}},r=[],i=e.shape();for(let e in i){let a=i[e];if(a===void 0||a._def===void 0)continue;let o=un(a),s=X(a._def,{...t,currentPath:[...t.currentPath,`properties`,e],propertyPath:[...t.currentPath,`properties`,e]});if(s===void 0)continue;n.properties[e]=s,o||r.push(e)}r.length&&(n.required=r);let a=ln(e,t);return a!==void 0&&(n.additionalProperties=a),n}function ln(e,t){if(e.catchall._def.typeName!==`ZodNever`)return X(e.catchall._def,{...t,currentPath:[...t.currentPath,`additionalProperties`]});switch(e.unknownKeys){case`passthrough`:return t.allowedAdditionalProperties;case`strict`:return t.rejectedAdditionalProperties;case`strip`:return t.removeAdditionalStrategy===`strict`?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}function un(e){try{return e.isOptional()}catch{return!0}}var dn=(e,t)=>{var n;if(t.currentPath.toString()===(n=t.propertyPath)?.toString())return X(e.innerType._def,t);let r=X(e.innerType._def,{...t,currentPath:[...t.currentPath,`anyOf`,`1`]});return r?{anyOf:[{not:q()},r]}:q()},fn=(e,t)=>{if(t.pipeStrategy===`input`)return X(e.in._def,t);if(t.pipeStrategy===`output`)return X(e.out._def,t);let n=X(e.in._def,{...t,currentPath:[...t.currentPath,`allOf`,`0`]}),r=X(e.out._def,{...t,currentPath:[...t.currentPath,`allOf`,n?`1`:`0`]});return{allOf:[n,r].filter(e=>e!==void 0)}};function pn(e,t){return X(e.type._def,t)}function mn(e,t){let n=X(e.valueType._def,{...t,currentPath:[...t.currentPath,`items`]}),r={type:`array`,uniqueItems:!0,items:n};return e.minSize&&(r.minItems=e.minSize.value),e.maxSize&&(r.maxItems=e.maxSize.value),r}function hn(e,t){return e.rest?{type:`array`,minItems:e.items.length,items:e.items.map((e,n)=>X(e._def,{...t,currentPath:[...t.currentPath,`items`,`${n}`]})).reduce((e,t)=>t===void 0?e:[...e,t],[]),additionalItems:X(e.rest._def,{...t,currentPath:[...t.currentPath,`additionalItems`]})}:{type:`array`,minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,n)=>X(e._def,{...t,currentPath:[...t.currentPath,`items`,`${n}`]})).reduce((e,t)=>t===void 0?e:[...e,t],[])}}function gn(){return{not:q()}}function _n(){return q()}var vn=(e,t)=>X(e.innerType._def,t),yn=(e,t,n)=>{switch(t){case o.ZodString:return Gt(e,n);case o.ZodNumber:return sn(e);case o.ZodObject:return cn(e,n);case o.ZodBigInt:return Mt(e);case o.ZodBoolean:return Nt();case o.ZodDate:return It(e,n);case o.ZodUndefined:return gn();case o.ZodNull:return tn();case o.ZodArray:return jt(e,n);case o.ZodUnion:case o.ZodDiscriminatedUnion:return rn(e,n);case o.ZodIntersection:return Ht(e,n);case o.ZodTuple:return hn(e,n);case o.ZodRecord:return Zt(e,n);case o.ZodLiteral:return Ut(e);case o.ZodEnum:return Bt(e);case o.ZodNativeEnum:return $t(e);case o.ZodNullable:return on(e,n);case o.ZodOptional:return dn(e,n);case o.ZodMap:return Qt(e,n);case o.ZodSet:return mn(e,n);case o.ZodLazy:return()=>e.getter()._def;case o.ZodPromise:return pn(e,n);case o.ZodNaN:case o.ZodNever:return en();case o.ZodEffects:return zt(e,n);case o.ZodAny:return q();case o.ZodUnknown:return _n();case o.ZodDefault:return Rt(e,n);case o.ZodBranded:return Pt(e,n);case o.ZodReadonly:return vn(e,n);case o.ZodCatch:return Ft(e,n);case o.ZodPipeline:return fn(e,n);case o.ZodFunction:case o.ZodVoid:case o.ZodSymbol:return;default:return(e=>void 0)(t)}};function X(e,t,n=!1){var r;let i=t.seen.get(e);if(t.override){let a=(r=t.override)?.call(t,e,t,i,n);if(a!==Ot)return a}if(i&&!n){let e=bn(i,t);if(e!==void 0)return e}let a={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,a);let o=yn(e,e.typeName,t),s=typeof o==`function`?X(o(),t):o;if(s&&xn(e,t,s),t.postProcess){let n=t.postProcess(s,e,t);return a.jsonSchema=s,n}return a.jsonSchema=s,s}var bn=(e,t)=>{switch(t.$refStrategy){case`root`:return{$ref:e.path.join(`/`)};case`relative`:return{$ref:Dt(t.currentPath,e.path)};case`none`:case`seen`:return e.path.length<t.currentPath.length&&e.path.every((e,n)=>t.currentPath[n]===e)?(console.warn(`Recursive reference detected at ${t.currentPath.join(`/`)}! Defaulting to any`),q()):t.$refStrategy===`seen`?q():void 0}},xn=(e,t,n)=>(e.description&&(n.description=e.description),n),Sn=e=>{let t=At(e),n=t.name===void 0?t.basePath:[...t.basePath,t.definitionPath,t.name];return{...t,currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([e,n])=>[n._def,{def:n._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}]))}},Cn=(e,t)=>{var n;let r=Sn(t),i=typeof t==`object`&&t.definitions?Object.entries(t.definitions).reduce((e,[t,n])=>{var i;return{...e,[t]:(i=X(n._def,{...r,currentPath:[...r.basePath,r.definitionPath,t]},!0))??q()}},{}):void 0,a=typeof t==`string`?t:t?.nameStrategy===`title`?void 0:t?.name,o=(n=X(e._def,a===void 0?r:{...r,currentPath:[...r.basePath,r.definitionPath,a]},!1))??q(),s=typeof t==`object`&&t.name!==void 0&&t.nameStrategy===`title`?t.name:void 0;s!==void 0&&(o.title=s);let c=a===void 0?i?{...o,[r.definitionPath]:i}:o:{$ref:[...r.$refStrategy===`relative`?[]:r.basePath,r.definitionPath,a].join(`/`),[r.definitionPath]:{...i,[a]:o}};return c.$schema=`http://json-schema.org/draft-07/schema#`,c},wn=Cn;function Tn(e,t){var n;let r=(n=t?.useReferences)??!1;return An(wn(e,{$refStrategy:r?`root`:`none`}),{validate:async t=>{let n=await e.safeParseAsync(t);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}}})}function En(e,t){var n;let i=(n=t?.useReferences)??!1,a=r.toJSONSchema(e,{target:`draft-7`,io:`output`,reused:i?`ref`:`inline`});return An(a,{validate:async t=>{let n=await r.safeParseAsync(e,t);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}}})}function Dn(e){return`_zod`in e}function On(e,t){return Dn(e)?En(e,t):Tn(e,t)}var kn=Symbol.for(`vercel.ai.schema`);function An(e,{validate:t}={}){return{[kn]:!0,_type:void 0,[ct]:!0,jsonSchema:e,validate:t}}function jn(e){return typeof e==`object`&&!!e&&kn in e&&e[kn]===!0&&`jsonSchema`in e&&`validate`in e}function Mn(e){return e==null?An({properties:{},additionalProperties:!1}):jn(e)?e:On(e)}var{btoa:Nn,atob:Pn}=globalThis;function Fn(e){let t=e.replace(/-/g,`+`).replace(/_/g,`/`),n=Pn(t);return Uint8Array.from(n,e=>e.codePointAt(0))}function In(e){let t=``;for(let n=0;n<e.length;n++)t+=String.fromCodePoint(e[n]);return Nn(t)}function Ln(e){return e instanceof Uint8Array?In(e):e}function Rn(e){return e?.replace(/\/$/,``)}function zn(e){return e!=null&&typeof e[Symbol.asyncIterator]==`function`}async function*Bn({execute:e,input:t,options:n}){let r=e(t,n);if(zn(r)){let e;for await(let t of r)e=t,yield{type:`preliminary`,output:t};yield{type:`final`,output:e}}else yield{type:`final`,output:await r}}var Vn=a.object({error:a.object({message:a.string(),type:a.string().nullish(),param:a.any().nullish(),code:a.union([a.string(),a.number()]).nullish()})}),Hn=wt({errorSchema:Vn,errorToMessage:e=>e.error.message});function Un({prompt:e,systemMessageMode:t=`system`}){let n=[],r=[];for(let{role:i,content:a}of e)switch(i){case`system`:switch(t){case`system`:n.push({role:`system`,content:a});break;case`developer`:n.push({role:`developer`,content:a});break;case`remove`:r.push({type:`other`,message:`system messages are removed for this model`});break;default:{let e=t;throw Error(`Unsupported system message mode: ${e}`)}}break;case`user`:if(a.length===1&&a[0].type===`text`){n.push({role:`user`,content:a[0].text});break}n.push({role:`user`,content:a.map((e,t)=>{var n,r,i;switch(e.type){case`text`:return{type:`text`,text:e.text};case`file`:if(e.mediaType.startsWith(`image/`)){let t=e.mediaType===`image/*`?`image/jpeg`:e.mediaType;return{type:`image_url`,image_url:{url:e.data instanceof URL?e.data.toString():`data:${t};base64,${Ln(e.data)}`,detail:(r=(n=e.providerOptions)?.openai)?.imageDetail}}}else if(e.mediaType.startsWith(`audio/`)){if(e.data instanceof URL)throw new z({functionality:`audio file parts with URLs`});switch(e.mediaType){case`audio/wav`:return{type:`input_audio`,input_audio:{data:Ln(e.data),format:`wav`}};case`audio/mp3`:case`audio/mpeg`:return{type:`input_audio`,input_audio:{data:Ln(e.data),format:`mp3`}};default:throw new z({functionality:`audio content parts with media type ${e.mediaType}`})}}else if(e.mediaType===`application/pdf`){if(e.data instanceof URL)throw new z({functionality:`PDF file parts with URLs`});return{type:`file`,file:typeof e.data==`string`&&e.data.startsWith(`file-`)?{file_id:e.data}:{filename:(i=e.filename)??`part-${t}.pdf`,file_data:`data:application/pdf;base64,${Ln(e.data)}`}}}else throw new z({functionality:`file part media type ${e.mediaType}`})}})});break;case`assistant`:{let e=``,t=[];for(let n of a)switch(n.type){case`text`:e+=n.text;break;case`tool-call`:t.push({id:n.toolCallId,type:`function`,function:{name:n.toolName,arguments:JSON.stringify(n.input)}});break}n.push({role:`assistant`,content:e,tool_calls:t.length>0?t:void 0});break}case`tool`:for(let e of a){let t=e.output,r;switch(t.type){case`text`:case`error-text`:r=t.value;break;case`content`:case`json`:case`error-json`:r=JSON.stringify(t.value);break}n.push({role:`tool`,tool_call_id:e.toolCallId,content:r})}break;default:{let e=i;throw Error(`Unsupported role: ${e}`)}}return{messages:n,warnings:r}}function Wn({id:e,model:t,created:n}){return{id:e??void 0,modelId:t??void 0,timestamp:n==null?void 0:new Date(n*1e3)}}function Gn(e){switch(e){case`stop`:return`stop`;case`length`:return`length`;case`content_filter`:return`content-filter`;case`function_call`:case`tool_calls`:return`tool-calls`;default:return`unknown`}}var Kn=a.object({logitBias:a.record(a.coerce.number(),a.number()).optional(),logprobs:a.union([a.boolean(),a.number()]).optional(),parallelToolCalls:a.boolean().optional(),user:a.string().optional(),reasoningEffort:a.enum([`minimal`,`low`,`medium`,`high`]).optional(),maxCompletionTokens:a.number().optional(),store:a.boolean().optional(),metadata:a.record(a.string().max(64),a.string().max(512)).optional(),prediction:a.record(a.string(),a.any()).optional(),structuredOutputs:a.boolean().optional(),serviceTier:a.enum([`auto`,`flex`,`priority`]).optional(),strictJsonSchema:a.boolean().optional(),textVerbosity:a.enum([`low`,`medium`,`high`]).optional(),promptCacheKey:a.string().optional(),safetyIdentifier:a.string().optional()}),qn=a.object({key:a.string(),type:a.enum([`eq`,`ne`,`gt`,`gte`,`lt`,`lte`]),value:a.union([a.string(),a.number(),a.boolean()])}),Jn=a.object({type:a.enum([`and`,`or`]),filters:a.array(a.union([qn,a.lazy(()=>Jn)]))}),Yn=a.union([qn,Jn]),Xn=a.object({vectorStoreIds:a.array(a.string()).optional(),maxNumResults:a.number().optional(),ranking:a.object({ranker:a.enum([`auto`,`default-2024-08-21`]).optional()}).optional(),filters:Yn.optional()}),Zn=W({id:`openai.file_search`,name:`file_search`,inputSchema:a.object({query:a.string()})}),Qn=a.object({searchContextSize:a.enum([`low`,`medium`,`high`]).optional(),userLocation:a.object({type:a.literal(`approximate`),country:a.string().optional(),city:a.string().optional(),region:a.string().optional(),timezone:a.string().optional()}).optional()}),$n=W({id:`openai.web_search_preview`,name:`web_search_preview`,inputSchema:a.object({action:a.discriminatedUnion(`type`,[a.object({type:a.literal(`search`),query:a.string().nullish()}),a.object({type:a.literal(`open_page`),url:a.string()}),a.object({type:a.literal(`find`),url:a.string(),pattern:a.string()})]).nullish()})});function er({tools:e,toolChoice:t,structuredOutputs:n,strictJsonSchema:r}){e=e?.length?e:void 0;let i=[];if(e==null)return{tools:void 0,toolChoice:void 0,toolWarnings:i};let a=[];for(let t of e)switch(t.type){case`function`:a.push({type:`function`,function:{name:t.name,description:t.description,parameters:t.inputSchema,strict:n?r:void 0}});break;case`provider-defined`:switch(t.id){case`openai.file_search`:{let e=Xn.parse(t.args);a.push({type:`file_search`,vector_store_ids:e.vectorStoreIds,max_num_results:e.maxNumResults,ranking_options:e.ranking?{ranker:e.ranking.ranker}:void 0,filters:e.filters});break}case`openai.web_search_preview`:{let e=Qn.parse(t.args);a.push({type:`web_search_preview`,search_context_size:e.searchContextSize,user_location:e.userLocation});break}default:i.push({type:`unsupported-tool`,tool:t});break}break;default:i.push({type:`unsupported-tool`,tool:t});break}if(t==null)return{tools:a,toolChoice:void 0,toolWarnings:i};let o=t.type;switch(o){case`auto`:case`none`:case`required`:return{tools:a,toolChoice:o,toolWarnings:i};case`tool`:return{tools:a,toolChoice:{type:`function`,function:{name:t.toolName}},toolWarnings:i};default:{let e=o;throw new z({functionality:`tool choice type: ${e}`})}}}var tr=class{constructor(e,t){this.specificationVersion=`v2`,this.supportedUrls={"image/*":[/^https?:\/\/.*$/]},this.modelId=e,this.config=t}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,topK:i,frequencyPenalty:a,presencePenalty:o,stopSequences:s,responseFormat:c,seed:l,tools:u,toolChoice:d,providerOptions:f}){var p,m,h,g;let _=[],v=(p=await H({provider:`openai`,providerOptions:f,schema:Kn}))??{},y=(m=v.structuredOutputs)??!0;i!=null&&_.push({type:`unsupported-setting`,setting:`topK`}),c?.type===`json`&&c.schema!=null&&!y&&_.push({type:`unsupported-setting`,setting:`responseFormat`,details:`JSON response format schema is only supported with structuredOutputs`});let{messages:b,warnings:x}=Un({prompt:e,systemMessageMode:cr(this.modelId)});_.push(...x);let S=(h=v.strictJsonSchema)??!1,C={model:this.modelId,logit_bias:v.logitBias,logprobs:v.logprobs===!0||typeof v.logprobs==`number`?!0:void 0,top_logprobs:typeof v.logprobs==`number`?v.logprobs:typeof v.logprobs==`boolean`&&v.logprobs?0:void 0,user:v.user,parallel_tool_calls:v.parallelToolCalls,max_tokens:t,temperature:n,top_p:r,frequency_penalty:a,presence_penalty:o,response_format:c?.type===`json`?y&&c.schema!=null?{type:`json_schema`,json_schema:{schema:c.schema,strict:S,name:(g=c.name)??`response`,description:c.description}}:{type:`json_object`}:void 0,stop:s,seed:l,verbosity:v.textVerbosity,max_completion_tokens:v.maxCompletionTokens,store:v.store,metadata:v.metadata,prediction:v.prediction,reasoning_effort:v.reasoningEffort,service_tier:v.serviceTier,prompt_cache_key:v.promptCacheKey,safety_identifier:v.safetyIdentifier,messages:b};ar(this.modelId)?(C.temperature!=null&&(C.temperature=void 0,_.push({type:`unsupported-setting`,setting:`temperature`,details:`temperature is not supported for reasoning models`})),C.top_p!=null&&(C.top_p=void 0,_.push({type:`unsupported-setting`,setting:`topP`,details:`topP is not supported for reasoning models`})),C.frequency_penalty!=null&&(C.frequency_penalty=void 0,_.push({type:`unsupported-setting`,setting:`frequencyPenalty`,details:`frequencyPenalty is not supported for reasoning models`})),C.presence_penalty!=null&&(C.presence_penalty=void 0,_.push({type:`unsupported-setting`,setting:`presencePenalty`,details:`presencePenalty is not supported for reasoning models`})),C.logit_bias!=null&&(C.logit_bias=void 0,_.push({type:`other`,message:`logitBias is not supported for reasoning models`})),C.logprobs!=null&&(C.logprobs=void 0,_.push({type:`other`,message:`logprobs is not supported for reasoning models`})),C.top_logprobs!=null&&(C.top_logprobs=void 0,_.push({type:`other`,message:`topLogprobs is not supported for reasoning models`})),C.max_tokens!=null&&(C.max_completion_tokens??=C.max_tokens,C.max_tokens=void 0)):(this.modelId.startsWith(`gpt-4o-search-preview`)||this.modelId.startsWith(`gpt-4o-mini-search-preview`))&&C.temperature!=null&&(C.temperature=void 0,_.push({type:`unsupported-setting`,setting:`temperature`,details:`temperature is not supported for the search preview models and has been removed.`})),v.serviceTier===`flex`&&!or(this.modelId)&&(_.push({type:`unsupported-setting`,setting:`serviceTier`,details:`flex processing is only available for o3, o4-mini, and gpt-5 models`}),C.service_tier=void 0),v.serviceTier===`priority`&&!sr(this.modelId)&&(_.push({type:`unsupported-setting`,setting:`serviceTier`,details:`priority processing is only available for supported models (gpt-4, gpt-5, gpt-5-mini, o3, o4-mini) and requires Enterprise access. gpt-5-nano is not supported`}),C.service_tier=void 0);let{tools:w,toolChoice:T,toolWarnings:E}=er({tools:u,toolChoice:d,structuredOutputs:y,strictJsonSchema:S});return{args:{...C,tools:w,tool_choice:T},warnings:[..._,...E]}}async doGenerate(e){var t,n,r,i,a,o,s,c,l,u,d,f,p,m;let{args:h,warnings:g}=await this.getArgs(e),{responseHeaders:_,value:v,rawValue:y}=await U({url:this.config.url({path:`/chat/completions`,modelId:this.modelId}),headers:B(this.config.headers(),e.headers),body:h,failedResponseHandler:Hn,successfulResponseHandler:K(rr),abortSignal:e.abortSignal,fetch:this.config.fetch}),b=v.choices[0],x=[],S=b.message.content;S!=null&&S.length>0&&x.push({type:`text`,text:S});for(let e of(t=b.message.tool_calls)??[])x.push({type:`tool-call`,toolCallId:(n=e.id)??V(),toolName:e.function.name,input:e.function.arguments});for(let e of(r=b.message.annotations)??[])x.push({type:`source`,sourceType:`url`,id:V(),url:e.url,title:e.title});let C=(i=v.usage)?.completion_tokens_details,w=(a=v.usage)?.prompt_tokens_details,T={openai:{}};return C?.accepted_prediction_tokens!=null&&(T.openai.acceptedPredictionTokens=C?.accepted_prediction_tokens),C?.rejected_prediction_tokens!=null&&(T.openai.rejectedPredictionTokens=C?.rejected_prediction_tokens),(o=b.logprobs)?.content!=null&&(T.openai.logprobs=b.logprobs.content),{content:x,finishReason:Gn(b.finish_reason),usage:{inputTokens:(c=(s=v.usage)?.prompt_tokens)??void 0,outputTokens:(u=(l=v.usage)?.completion_tokens)??void 0,totalTokens:(f=(d=v.usage)?.total_tokens)??void 0,reasoningTokens:(p=C?.reasoning_tokens)??void 0,cachedInputTokens:(m=w?.cached_tokens)??void 0},request:{body:h},response:{...Wn(v),headers:_,body:y},warnings:g,providerMetadata:T}}async doStream(e){let{args:t,warnings:n}=await this.getArgs(e),r={...t,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:i,value:a}=await U({url:this.config.url({path:`/chat/completions`,modelId:this.modelId}),headers:B(this.config.headers(),e.headers),body:r,failedResponseHandler:Hn,successfulResponseHandler:Tt(ir),abortSignal:e.abortSignal,fetch:this.config.fetch}),o=[],s=`unknown`,c={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},l=!0,u=!1,d={openai:{}};return{stream:a.pipeThrough(new TransformStream({start(e){e.enqueue({type:`stream-start`,warnings:n})},transform(t,n){var r,i,a,f,p,m,h,g,_,v,y,b,x,S,C,w,T,E,D,O,ee,k,te,A;if(e.includeRawChunks&&n.enqueue({type:`raw`,rawValue:t.rawValue}),!t.success){s=`error`,n.enqueue({type:`error`,error:t.error});return}let j=t.value;if(`error`in j){s=`error`,n.enqueue({type:`error`,error:j.error});return}l&&(l=!1,n.enqueue({type:`response-metadata`,...Wn(j)})),j.usage!=null&&(c.inputTokens=(r=j.usage.prompt_tokens)??void 0,c.outputTokens=(i=j.usage.completion_tokens)??void 0,c.totalTokens=(a=j.usage.total_tokens)??void 0,c.reasoningTokens=(p=(f=j.usage.completion_tokens_details)?.reasoning_tokens)??void 0,c.cachedInputTokens=(h=(m=j.usage.prompt_tokens_details)?.cached_tokens)??void 0,(g=j.usage.completion_tokens_details)?.accepted_prediction_tokens!=null&&(d.openai.acceptedPredictionTokens=(_=j.usage.completion_tokens_details)?.accepted_prediction_tokens),(v=j.usage.completion_tokens_details)?.rejected_prediction_tokens!=null&&(d.openai.rejectedPredictionTokens=(y=j.usage.completion_tokens_details)?.rejected_prediction_tokens));let M=j.choices[0];if(M?.finish_reason!=null&&(s=Gn(M.finish_reason)),(b=M?.logprobs)?.content!=null&&(d.openai.logprobs=M.logprobs.content),M?.delta==null)return;let N=M.delta;if(N.content!=null&&(u||=(n.enqueue({type:`text-start`,id:`0`}),!0),n.enqueue({type:`text-delta`,id:`0`,delta:N.content})),N.tool_calls!=null)for(let e of N.tool_calls){let t=e.index;if(o[t]==null){if(e.type!==`function`)throw new ne({data:e,message:`Expected 'function' type.`});if(e.id==null)throw new ne({data:e,message:`Expected 'id' to be a string.`});if((x=e.function)?.name==null)throw new ne({data:e,message:`Expected 'function.name' to be a string.`});n.enqueue({type:`tool-input-start`,id:e.id,toolName:e.function.name}),o[t]={id:e.id,type:`function`,function:{name:e.function.name,arguments:(S=e.function.arguments)??``},hasFinished:!1};let r=o[t];(C=r.function)?.name!=null&&(w=r.function)?.arguments!=null&&(r.function.arguments.length>0&&n.enqueue({type:`tool-input-delta`,id:r.id,delta:r.function.arguments}),_t(r.function.arguments)&&(n.enqueue({type:`tool-input-end`,id:r.id}),n.enqueue({type:`tool-call`,toolCallId:(T=r.id)??V(),toolName:r.function.name,input:r.function.arguments}),r.hasFinished=!0));continue}let r=o[t];if(r.hasFinished)continue;(E=e.function)?.arguments!=null&&(r.function.arguments+=(O=(D=e.function)?.arguments)??``),n.enqueue({type:`tool-input-delta`,id:r.id,delta:(ee=e.function.arguments)??``}),(k=r.function)?.name!=null&&(te=r.function)?.arguments!=null&&_t(r.function.arguments)&&(n.enqueue({type:`tool-input-end`,id:r.id}),n.enqueue({type:`tool-call`,toolCallId:(A=r.id)??V(),toolName:r.function.name,input:r.function.arguments}),r.hasFinished=!0)}if(N.annotations!=null)for(let e of N.annotations)n.enqueue({type:`source`,sourceType:`url`,id:V(),url:e.url,title:e.title})},flush(e){u&&e.enqueue({type:`text-end`,id:`0`}),e.enqueue({type:`finish`,finishReason:s,usage:c,...d==null?{}:{providerMetadata:d}})}})),request:{body:r},response:{headers:i}}}},nr=a.object({prompt_tokens:a.number().nullish(),completion_tokens:a.number().nullish(),total_tokens:a.number().nullish(),prompt_tokens_details:a.object({cached_tokens:a.number().nullish()}).nullish(),completion_tokens_details:a.object({reasoning_tokens:a.number().nullish(),accepted_prediction_tokens:a.number().nullish(),rejected_prediction_tokens:a.number().nullish()}).nullish()}).nullish(),rr=a.object({id:a.string().nullish(),created:a.number().nullish(),model:a.string().nullish(),choices:a.array(a.object({message:a.object({role:a.literal(`assistant`).nullish(),content:a.string().nullish(),tool_calls:a.array(a.object({id:a.string().nullish(),type:a.literal(`function`),function:a.object({name:a.string(),arguments:a.string()})})).nullish(),annotations:a.array(a.object({type:a.literal(`url_citation`),start_index:a.number(),end_index:a.number(),url:a.string(),title:a.string()})).nullish()}),index:a.number(),logprobs:a.object({content:a.array(a.object({token:a.string(),logprob:a.number(),top_logprobs:a.array(a.object({token:a.string(),logprob:a.number()}))})).nullish()}).nullish(),finish_reason:a.string().nullish()})),usage:nr}),ir=a.union([a.object({id:a.string().nullish(),created:a.number().nullish(),model:a.string().nullish(),choices:a.array(a.object({delta:a.object({role:a.enum([`assistant`]).nullish(),content:a.string().nullish(),tool_calls:a.array(a.object({index:a.number(),id:a.string().nullish(),type:a.literal(`function`).nullish(),function:a.object({name:a.string().nullish(),arguments:a.string().nullish()})})).nullish(),annotations:a.array(a.object({type:a.literal(`url_citation`),start_index:a.number(),end_index:a.number(),url:a.string(),title:a.string()})).nullish()}).nullish(),logprobs:a.object({content:a.array(a.object({token:a.string(),logprob:a.number(),top_logprobs:a.array(a.object({token:a.string(),logprob:a.number()}))})).nullish()}).nullish(),finish_reason:a.string().nullish(),index:a.number()})),usage:nr}),Vn]);function ar(e){return(e.startsWith(`o`)||e.startsWith(`gpt-5`))&&!e.startsWith(`gpt-5-chat`)}function or(e){return e.startsWith(`o3`)||e.startsWith(`o4-mini`)||e.startsWith(`gpt-5`)&&!e.startsWith(`gpt-5-chat`)}function sr(e){return e.startsWith(`gpt-4`)||e.startsWith(`gpt-5-mini`)||e.startsWith(`gpt-5`)&&!e.startsWith(`gpt-5-nano`)&&!e.startsWith(`gpt-5-chat`)||e.startsWith(`o3`)||e.startsWith(`o4-mini`)}function cr(e){var t,n;return ar(e)?(n=(t=lr[e])?.systemMessageMode)??`developer`:`system`}var lr={"o1-mini":{systemMessageMode:`remove`},"o1-mini-2024-09-12":{systemMessageMode:`remove`},"o1-preview":{systemMessageMode:`remove`},"o1-preview-2024-09-12":{systemMessageMode:`remove`},o3:{systemMessageMode:`developer`},"o3-2025-04-16":{systemMessageMode:`developer`},"o3-mini":{systemMessageMode:`developer`},"o3-mini-2025-01-31":{systemMessageMode:`developer`},"o4-mini":{systemMessageMode:`developer`},"o4-mini-2025-04-16":{systemMessageMode:`developer`}};function ur({prompt:e,user:t=`user`,assistant:n=`assistant`}){let r=``;e[0].role===`system`&&(r+=`${e[0].content}

`,e=e.slice(1));for(let{role:i,content:a}of e)switch(i){case`system`:throw new A({message:"Unexpected system message in prompt: ${content}",prompt:e});case`user`:{let e=a.map(e=>{switch(e.type){case`text`:return e.text}}).filter(Boolean).join(``);r+=`${t}:
${e}

`;break}case`assistant`:{let e=a.map(e=>{switch(e.type){case`text`:return e.text;case`tool-call`:throw new z({functionality:`tool-call messages`})}}).join(``);r+=`${n}:
${e}

`;break}case`tool`:throw new z({functionality:`tool messages`});default:{let e=i;throw Error(`Unsupported role: ${e}`)}}return r+=`${n}:
`,{prompt:r,stopSequences:[`
${t}:`]}}function dr({id:e,model:t,created:n}){return{id:e??void 0,modelId:t??void 0,timestamp:n==null?void 0:new Date(n*1e3)}}function fr(e){switch(e){case`stop`:return`stop`;case`length`:return`length`;case`content_filter`:return`content-filter`;case`function_call`:case`tool_calls`:return`tool-calls`;default:return`unknown`}}var pr=a.object({echo:a.boolean().optional(),logitBias:a.record(a.string(),a.number()).optional(),suffix:a.string().optional(),user:a.string().optional(),logprobs:a.union([a.boolean(),a.number()]).optional()}),mr=class{constructor(e,t){this.specificationVersion=`v2`,this.supportedUrls={},this.modelId=e,this.config=t}get providerOptionsName(){return this.config.provider.split(`.`)[0].trim()}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,topK:i,frequencyPenalty:a,presencePenalty:o,stopSequences:s,responseFormat:c,tools:l,toolChoice:u,seed:d,providerOptions:f}){let p=[],m={...await H({provider:`openai`,providerOptions:f,schema:pr}),...await H({provider:this.providerOptionsName,providerOptions:f,schema:pr})};i!=null&&p.push({type:`unsupported-setting`,setting:`topK`}),l?.length&&p.push({type:`unsupported-setting`,setting:`tools`}),u!=null&&p.push({type:`unsupported-setting`,setting:`toolChoice`}),c!=null&&c.type!==`text`&&p.push({type:`unsupported-setting`,setting:`responseFormat`,details:`JSON response format is not supported.`});let{prompt:h,stopSequences:g}=ur({prompt:e}),_=[...g??[],...s??[]];return{args:{model:this.modelId,echo:m.echo,logit_bias:m.logitBias,logprobs:m?.logprobs===!0?0:m?.logprobs===!1?void 0:m?.logprobs,suffix:m.suffix,user:m.user,max_tokens:t,temperature:n,top_p:r,frequency_penalty:a,presence_penalty:o,seed:d,prompt:h,stop:_.length>0?_:void 0},warnings:p}}async doGenerate(e){var t,n,r;let{args:i,warnings:a}=await this.getArgs(e),{responseHeaders:o,value:s,rawValue:c}=await U({url:this.config.url({path:`/completions`,modelId:this.modelId}),headers:B(this.config.headers(),e.headers),body:i,failedResponseHandler:Hn,successfulResponseHandler:K(gr),abortSignal:e.abortSignal,fetch:this.config.fetch}),l=s.choices[0],u={openai:{}};return l.logprobs!=null&&(u.openai.logprobs=l.logprobs),{content:[{type:`text`,text:l.text}],usage:{inputTokens:(t=s.usage)?.prompt_tokens,outputTokens:(n=s.usage)?.completion_tokens,totalTokens:(r=s.usage)?.total_tokens},finishReason:fr(l.finish_reason),request:{body:i},response:{...dr(s),headers:o,body:c},providerMetadata:u,warnings:a}}async doStream(e){let{args:t,warnings:n}=await this.getArgs(e),r={...t,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:i,value:a}=await U({url:this.config.url({path:`/completions`,modelId:this.modelId}),headers:B(this.config.headers(),e.headers),body:r,failedResponseHandler:Hn,successfulResponseHandler:Tt(_r),abortSignal:e.abortSignal,fetch:this.config.fetch}),o=`unknown`,s={openai:{}},c={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},l=!0;return{stream:a.pipeThrough(new TransformStream({start(e){e.enqueue({type:`stream-start`,warnings:n})},transform(t,n){if(e.includeRawChunks&&n.enqueue({type:`raw`,rawValue:t.rawValue}),!t.success){o=`error`,n.enqueue({type:`error`,error:t.error});return}let r=t.value;if(`error`in r){o=`error`,n.enqueue({type:`error`,error:r.error});return}l&&(l=!1,n.enqueue({type:`response-metadata`,...dr(r)}),n.enqueue({type:`text-start`,id:`0`})),r.usage!=null&&(c.inputTokens=r.usage.prompt_tokens,c.outputTokens=r.usage.completion_tokens,c.totalTokens=r.usage.total_tokens);let i=r.choices[0];i?.finish_reason!=null&&(o=fr(i.finish_reason)),i?.logprobs!=null&&(s.openai.logprobs=i.logprobs),i?.text!=null&&i.text.length>0&&n.enqueue({type:`text-delta`,id:`0`,delta:i.text})},flush(e){l||e.enqueue({type:`text-end`,id:`0`}),e.enqueue({type:`finish`,finishReason:o,providerMetadata:s,usage:c})}})),request:{body:r},response:{headers:i}}}},hr=a.object({prompt_tokens:a.number(),completion_tokens:a.number(),total_tokens:a.number()}),gr=a.object({id:a.string().nullish(),created:a.number().nullish(),model:a.string().nullish(),choices:a.array(a.object({text:a.string(),finish_reason:a.string(),logprobs:a.object({tokens:a.array(a.string()),token_logprobs:a.array(a.number()),top_logprobs:a.array(a.record(a.string(),a.number())).nullish()}).nullish()})),usage:hr.nullish()}),_r=a.union([a.object({id:a.string().nullish(),created:a.number().nullish(),model:a.string().nullish(),choices:a.array(a.object({text:a.string(),finish_reason:a.string().nullish(),index:a.number(),logprobs:a.object({tokens:a.array(a.string()),token_logprobs:a.array(a.number()),top_logprobs:a.array(a.record(a.string(),a.number())).nullish()}).nullish()})),usage:hr.nullish()}),Vn]),vr=a.object({dimensions:a.number().optional(),user:a.string().optional()}),yr=class{constructor(e,t){this.specificationVersion=`v2`,this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0,this.modelId=e,this.config=t}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:n,providerOptions:r}){var i;if(e.length>this.maxEmbeddingsPerCall)throw new Ee({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let a=(i=await H({provider:`openai`,providerOptions:r,schema:vr}))??{},{responseHeaders:o,value:s,rawValue:c}=await U({url:this.config.url({path:`/embeddings`,modelId:this.modelId}),headers:B(this.config.headers(),t),body:{model:this.modelId,input:e,encoding_format:`float`,dimensions:a.dimensions,user:a.user},failedResponseHandler:Hn,successfulResponseHandler:K(br),abortSignal:n,fetch:this.config.fetch});return{embeddings:s.data.map(e=>e.embedding),usage:s.usage?{tokens:s.usage.prompt_tokens}:void 0,response:{headers:o,body:c}}}},br=a.object({data:a.array(a.object({embedding:a.array(a.number())})),usage:a.object({prompt_tokens:a.number()}).nullish()}),xr={"dall-e-3":1,"dall-e-2":10,"gpt-image-1":10},Sr=new Set([`gpt-image-1`]),Cr=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion=`v2`}get maxImagesPerCall(){var e;return(e=xr[this.modelId])??1}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:n,aspectRatio:r,seed:i,providerOptions:a,headers:o,abortSignal:s}){var c,l,u,d;let f=[];r!=null&&f.push({type:`unsupported-setting`,setting:`aspectRatio`,details:"This model does not support aspect ratio. Use `size` instead."}),i!=null&&f.push({type:`unsupported-setting`,setting:`seed`});let p=(u=(l=(c=this.config._internal)?.currentDate)?.call(c))??new Date,{value:m,responseHeaders:h}=await U({url:this.config.url({path:`/images/generations`,modelId:this.modelId}),headers:B(this.config.headers(),o),body:{model:this.modelId,prompt:e,n:t,size:n,...(d=a.openai)??{},...Sr.has(this.modelId)?{}:{response_format:`b64_json`}},failedResponseHandler:Hn,successfulResponseHandler:K(wr),abortSignal:s,fetch:this.config.fetch});return{images:m.data.map(e=>e.b64_json),warnings:f,response:{timestamp:p,modelId:this.modelId,headers:h},providerMetadata:{openai:{images:m.data.map(e=>e.revised_prompt?{revisedPrompt:e.revised_prompt}:null)}}}}},wr=a.object({data:a.array(a.object({b64_json:a.string(),revised_prompt:a.string().optional()}))}),Tr=a.object({container:a.union([a.string(),a.object({fileIds:a.array(a.string()).optional()})]).optional()}),Er=W({id:`openai.code_interpreter`,name:`code_interpreter`,inputSchema:a.object({})}),Dr=(e={})=>Er(e),Or=a.object({filters:a.object({allowedDomains:a.array(a.string()).optional()}).optional(),searchContextSize:a.enum([`low`,`medium`,`high`]).optional(),userLocation:a.object({type:a.literal(`approximate`),country:a.string().optional(),city:a.string().optional(),region:a.string().optional(),timezone:a.string().optional()}).optional()}),kr=W({id:`openai.web_search`,name:`web_search`,inputSchema:a.object({action:a.discriminatedUnion(`type`,[a.object({type:a.literal(`search`),query:a.string().nullish()}),a.object({type:a.literal(`open_page`),url:a.string()}),a.object({type:a.literal(`find`),url:a.string(),pattern:a.string()})]).nullish()})}),Ar=(e={})=>kr(e),jr={codeInterpreter:Dr,fileSearch:Zn,webSearchPreview:$n,webSearch:Ar};function Mr(e,t){return t?t.some(t=>e.startsWith(t)):!1}async function Nr({prompt:e,systemMessageMode:t,fileIdPrefixes:n}){var r,i,a,o,s,c;let l=[],u=[];for(let{role:d,content:f}of e)switch(d){case`system`:switch(t){case`system`:l.push({role:`system`,content:f});break;case`developer`:l.push({role:`developer`,content:f});break;case`remove`:u.push({type:`other`,message:`system messages are removed for this model`});break;default:{let e=t;throw Error(`Unsupported system message mode: ${e}`)}}break;case`user`:l.push({role:`user`,content:f.map((e,t)=>{var r,i,a;switch(e.type){case`text`:return{type:`input_text`,text:e.text};case`file`:if(e.mediaType.startsWith(`image/`)){let t=e.mediaType===`image/*`?`image/jpeg`:e.mediaType;return{type:`input_image`,...e.data instanceof URL?{image_url:e.data.toString()}:typeof e.data==`string`&&Mr(e.data,n)?{file_id:e.data}:{image_url:`data:${t};base64,${Ln(e.data)}`},detail:(i=(r=e.providerOptions)?.openai)?.imageDetail}}else if(e.mediaType===`application/pdf`)return e.data instanceof URL?{type:`input_file`,file_url:e.data.toString()}:{type:`input_file`,...typeof e.data==`string`&&Mr(e.data,n)?{file_id:e.data}:{filename:(a=e.filename)??`part-${t}.pdf`,file_data:`data:application/pdf;base64,${Ln(e.data)}`}};else throw new z({functionality:`file part media type ${e.mediaType}`})}})});break;case`assistant`:{let e={};for(let t of f)switch(t.type){case`text`:l.push({role:`assistant`,content:[{type:`output_text`,text:t.text}],id:(a=(i=(r=t.providerOptions)?.openai)?.itemId)??void 0});break;case`tool-call`:if(t.providerExecuted)break;l.push({type:`function_call`,call_id:t.toolCallId,name:t.toolName,arguments:JSON.stringify(t.input),id:(c=(s=(o=t.providerOptions)?.openai)?.itemId)??void 0});break;case`tool-result`:u.push({type:`other`,message:`tool result parts in assistant messages are not supported for OpenAI responses`});break;case`reasoning`:{let n=await H({provider:`openai`,providerOptions:t.providerOptions,schema:Pr}),r=n?.itemId;if(r!=null){let i=e[r],a=[];t.text.length>0?a.push({type:`summary_text`,text:t.text}):i!==void 0&&u.push({type:`other`,message:`Cannot append empty reasoning part to existing reasoning sequence. Skipping reasoning part: ${JSON.stringify(t)}.`}),i===void 0?(e[r]={type:`reasoning`,id:r,encrypted_content:n?.reasoningEncryptedContent,summary:a},l.push(e[r])):i.summary.push(...a)}else u.push({type:`other`,message:`Non-OpenAI reasoning parts are not supported. Skipping reasoning part: ${JSON.stringify(t)}.`});break}}break}case`tool`:for(let e of f){let t=e.output,n;switch(t.type){case`text`:case`error-text`:n=t.value;break;case`content`:case`json`:case`error-json`:n=JSON.stringify(t.value);break}l.push({type:`function_call_output`,call_id:e.toolCallId,output:n})}break;default:{let e=d;throw Error(`Unsupported role: ${e}`)}}return{messages:l,warnings:u}}var Pr=a.object({itemId:a.string().nullish(),reasoningEncryptedContent:a.string().nullish()});function Fr({finishReason:e,hasFunctionCall:t}){switch(e){case void 0:case null:return t?`tool-calls`:`stop`;case`max_output_tokens`:return`length`;case`content_filter`:return`content-filter`;default:return t?`tool-calls`:`unknown`}}function Ir({tools:e,toolChoice:t,strictJsonSchema:n}){e=e?.length?e:void 0;let r=[];if(e==null)return{tools:void 0,toolChoice:void 0,toolWarnings:r};let i=[];for(let t of e)switch(t.type){case`function`:i.push({type:`function`,name:t.name,description:t.description,parameters:t.inputSchema,strict:n});break;case`provider-defined`:switch(t.id){case`openai.file_search`:{let e=Xn.parse(t.args);i.push({type:`file_search`,vector_store_ids:e.vectorStoreIds,max_num_results:e.maxNumResults,ranking_options:e.ranking?{ranker:e.ranking.ranker}:void 0,filters:e.filters});break}case`openai.web_search_preview`:{let e=Qn.parse(t.args);i.push({type:`web_search_preview`,search_context_size:e.searchContextSize,user_location:e.userLocation});break}case`openai.web_search`:{let e=Or.parse(t.args);i.push({type:`web_search`,filters:e.filters==null?void 0:{allowed_domains:e.filters.allowedDomains},search_context_size:e.searchContextSize,user_location:e.userLocation});break}case`openai.code_interpreter`:{let e=Tr.parse(t.args);i.push({type:`code_interpreter`,container:e.container==null?{type:`auto`,file_ids:void 0}:typeof e.container==`string`?e.container:{type:`auto`,file_ids:e.container.fileIds}});break}default:r.push({type:`unsupported-tool`,tool:t});break}break;default:r.push({type:`unsupported-tool`,tool:t});break}if(t==null)return{tools:i,toolChoice:void 0,toolWarnings:r};let a=t.type;switch(a){case`auto`:case`none`:case`required`:return{tools:i,toolChoice:a,toolWarnings:r};case`tool`:return{tools:i,toolChoice:t.toolName===`code_interpreter`||t.toolName===`file_search`||t.toolName===`web_search_preview`||t.toolName===`web_search`?{type:t.toolName}:{type:`function`,name:t.toolName},toolWarnings:r};default:{let e=a;throw new z({functionality:`tool choice type: ${e}`})}}}var Lr=a.object({type:a.literal(`web_search_call`),id:a.string(),status:a.string(),action:a.discriminatedUnion(`type`,[a.object({type:a.literal(`search`),query:a.string().nullish()}),a.object({type:a.literal(`open_page`),url:a.string()}),a.object({type:a.literal(`find`),url:a.string(),pattern:a.string()})]).nullish()}),Rr=20,zr=a.array(a.object({token:a.string(),logprob:a.number(),top_logprobs:a.array(a.object({token:a.string(),logprob:a.number()}))})),Br=class{constructor(e,t){this.specificationVersion=`v2`,this.supportedUrls={"image/*":[/^https?:\/\/.*$/],"application/pdf":[/^https?:\/\/.*$/]},this.modelId=e,this.config=t}get provider(){return this.config.provider}async getArgs({maxOutputTokens:e,temperature:t,stopSequences:n,topP:r,topK:i,presencePenalty:a,frequencyPenalty:o,seed:s,prompt:c,providerOptions:l,tools:u,toolChoice:d,responseFormat:f}){var p,m,h;let g=[],_=di(this.modelId);i!=null&&g.push({type:`unsupported-setting`,setting:`topK`}),s!=null&&g.push({type:`unsupported-setting`,setting:`seed`}),a!=null&&g.push({type:`unsupported-setting`,setting:`presencePenalty`}),o!=null&&g.push({type:`unsupported-setting`,setting:`frequencyPenalty`}),n!=null&&g.push({type:`unsupported-setting`,setting:`stopSequences`});let{messages:v,warnings:y}=await Nr({prompt:c,systemMessageMode:_.systemMessageMode,fileIdPrefixes:this.config.fileIdPrefixes});g.push(...y);let b=await H({provider:`openai`,providerOptions:l,schema:fi}),x=(p=b?.strictJsonSchema)??!1,S=b?.include,C=typeof b?.logprobs==`number`?b?.logprobs:b?.logprobs===!0?Rr:void 0;S=C?Array.isArray(S)?[...S,`message.output_text.logprobs`]:[`message.output_text.logprobs`]:S;let w=(m=u?.find(e=>e.type===`provider-defined`&&(e.id===`openai.web_search`||e.id===`openai.web_search_preview`)))?.name;S=w?Array.isArray(S)?[...S,`web_search_call.action.sources`]:[`web_search_call.action.sources`]:S;let T={model:this.modelId,input:v,temperature:t,top_p:r,max_output_tokens:e,...(f?.type===`json`||b?.textVerbosity)&&{text:{...f?.type===`json`&&{format:f.schema==null?{type:`json_object`}:{type:`json_schema`,strict:x,name:(h=f.name)??`response`,description:f.description,schema:f.schema}},...b?.textVerbosity&&{verbosity:b.textVerbosity}}},metadata:b?.metadata,parallel_tool_calls:b?.parallelToolCalls,previous_response_id:b?.previousResponseId,store:b?.store,user:b?.user,instructions:b?.instructions,service_tier:b?.serviceTier,include:S,prompt_cache_key:b?.promptCacheKey,safety_identifier:b?.safetyIdentifier,top_logprobs:C,..._.isReasoningModel&&(b?.reasoningEffort!=null||b?.reasoningSummary!=null)&&{reasoning:{...b?.reasoningEffort!=null&&{effort:b.reasoningEffort},...b?.reasoningSummary!=null&&{summary:b.reasoningSummary}}},..._.requiredAutoTruncation&&{truncation:`auto`}};_.isReasoningModel?(T.temperature!=null&&(T.temperature=void 0,g.push({type:`unsupported-setting`,setting:`temperature`,details:`temperature is not supported for reasoning models`})),T.top_p!=null&&(T.top_p=void 0,g.push({type:`unsupported-setting`,setting:`topP`,details:`topP is not supported for reasoning models`}))):(b?.reasoningEffort!=null&&g.push({type:`unsupported-setting`,setting:`reasoningEffort`,details:`reasoningEffort is not supported for non-reasoning models`}),b?.reasoningSummary!=null&&g.push({type:`unsupported-setting`,setting:`reasoningSummary`,details:`reasoningSummary is not supported for non-reasoning models`})),b?.serviceTier===`flex`&&!_.supportsFlexProcessing&&(g.push({type:`unsupported-setting`,setting:`serviceTier`,details:`flex processing is only available for o3, o4-mini, and gpt-5 models`}),delete T.service_tier),b?.serviceTier===`priority`&&!_.supportsPriorityProcessing&&(g.push({type:`unsupported-setting`,setting:`serviceTier`,details:`priority processing is only available for supported models (gpt-4, gpt-5, gpt-5-mini, o3, o4-mini) and requires Enterprise access. gpt-5-nano is not supported`}),delete T.service_tier);let{tools:E,toolChoice:D,toolWarnings:O}=Ir({tools:u,toolChoice:d,strictJsonSchema:x});return{webSearchToolName:w,args:{...T,tools:E,tool_choice:D},warnings:[...g,...O]}}async doGenerate(e){var t,n,r,i,o,s,c,l,u,d,f,p,m,h,_,v,y;let{args:b,warnings:x,webSearchToolName:S}=await this.getArgs(e),C=this.config.url({path:`/responses`,modelId:this.modelId}),{responseHeaders:w,value:T,rawValue:E}=await U({url:C,headers:B(this.config.headers(),e.headers),body:b,failedResponseHandler:Hn,successfulResponseHandler:K(a.object({id:a.string(),created_at:a.number(),error:a.object({code:a.string(),message:a.string()}).nullish(),model:a.string(),output:a.array(a.discriminatedUnion(`type`,[a.object({type:a.literal(`message`),role:a.literal(`assistant`),id:a.string(),content:a.array(a.object({type:a.literal(`output_text`),text:a.string(),logprobs:zr.nullish(),annotations:a.array(a.discriminatedUnion(`type`,[a.object({type:a.literal(`url_citation`),start_index:a.number(),end_index:a.number(),url:a.string(),title:a.string()}),a.object({type:a.literal(`file_citation`),file_id:a.string(),filename:a.string().nullish(),index:a.number().nullish(),start_index:a.number().nullish(),end_index:a.number().nullish(),quote:a.string().nullish()}),a.object({type:a.literal(`container_file_citation`)})]))}))}),a.object({type:a.literal(`code_interpreter_call`)}),a.object({type:a.literal(`function_call`),call_id:a.string(),name:a.string(),arguments:a.string(),id:a.string()}),Lr,a.object({type:a.literal(`computer_call`),id:a.string(),status:a.string().optional()}),a.object({type:a.literal(`file_search_call`),id:a.string(),status:a.string().optional(),queries:a.array(a.string()).nullish(),results:a.array(a.object({attributes:a.object({file_id:a.string(),filename:a.string(),score:a.number(),text:a.string()})})).nullish()}),a.object({type:a.literal(`reasoning`),id:a.string(),encrypted_content:a.string().nullish(),summary:a.array(a.object({type:a.literal(`summary_text`),text:a.string()}))})])),service_tier:a.string().nullish(),incomplete_details:a.object({reason:a.string()}).nullable(),usage:Vr})),abortSignal:e.abortSignal,fetch:this.config.fetch});if(T.error)throw new g({message:T.error.message,url:C,requestBodyValues:b,statusCode:400,responseHeaders:w,responseBody:E,isRetryable:!1});let D=[],O=[],ee=!1;for(let a of T.output)switch(a.type){case`reasoning`:a.summary.length===0&&a.summary.push({type:`summary_text`,text:``});for(let e of a.summary)D.push({type:`reasoning`,text:e.text,providerMetadata:{openai:{itemId:a.id,reasoningEncryptedContent:(t=a.encrypted_content)??null}}});break;case`message`:for(let t of a.content){(r=(n=e.providerOptions)?.openai)?.logprobs&&t.logprobs&&O.push(t.logprobs),D.push({type:`text`,text:t.text,providerMetadata:{openai:{itemId:a.id}}});for(let e of t.annotations)e.type===`url_citation`?D.push({type:`source`,sourceType:`url`,id:(s=(o=(i=this.config).generateId)?.call(i))??V(),url:e.url,title:e.title}):e.type===`file_citation`&&D.push({type:`source`,sourceType:`document`,id:(u=(l=(c=this.config).generateId)?.call(c))??V(),mediaType:`text/plain`,title:(f=(d=e.quote)??e.filename)??`Document`,filename:(p=e.filename)??e.file_id})}break;case`function_call`:ee=!0,D.push({type:`tool-call`,toolCallId:a.call_id,toolName:a.name,input:a.arguments,providerMetadata:{openai:{itemId:a.id}}});break;case`web_search_call`:D.push({type:`tool-call`,toolCallId:a.id,toolName:S??`web_search`,input:JSON.stringify({action:a.action}),providerExecuted:!0}),D.push({type:`tool-result`,toolCallId:a.id,toolName:S??`web_search`,result:{status:a.status},providerExecuted:!0});break;case`computer_call`:D.push({type:`tool-call`,toolCallId:a.id,toolName:`computer_use`,input:``,providerExecuted:!0}),D.push({type:`tool-result`,toolCallId:a.id,toolName:`computer_use`,result:{type:`computer_use_tool_result`,status:a.status||`completed`},providerExecuted:!0});break;case`file_search_call`:D.push({type:`tool-call`,toolCallId:a.id,toolName:`file_search`,input:``,providerExecuted:!0}),D.push({type:`tool-result`,toolCallId:a.id,toolName:`file_search`,result:{type:`file_search_tool_result`,status:a.status||`completed`,...a.queries&&{queries:a.queries},...a.results&&{results:a.results}},providerExecuted:!0});break}let k={openai:{responseId:T.id}};return O.length>0&&(k.openai.logprobs=O),typeof T.service_tier==`string`&&(k.openai.serviceTier=T.service_tier),{content:D,finishReason:Fr({finishReason:(m=T.incomplete_details)?.reason,hasFunctionCall:ee}),usage:{inputTokens:T.usage.input_tokens,outputTokens:T.usage.output_tokens,totalTokens:T.usage.input_tokens+T.usage.output_tokens,reasoningTokens:(_=(h=T.usage.output_tokens_details)?.reasoning_tokens)??void 0,cachedInputTokens:(y=(v=T.usage.input_tokens_details)?.cached_tokens)??void 0},request:{body:b},response:{id:T.id,timestamp:new Date(T.created_at*1e3),modelId:T.model,headers:w,body:E},providerMetadata:k,warnings:x}}async doStream(e){let{args:t,warnings:n,webSearchToolName:r}=await this.getArgs(e),{responseHeaders:i,value:a}=await U({url:this.config.url({path:`/responses`,modelId:this.modelId}),headers:B(this.config.headers(),e.headers),body:{...t,stream:!0},failedResponseHandler:Hn,successfulResponseHandler:Tt(Qr),abortSignal:e.abortSignal,fetch:this.config.fetch}),o=this,s=`unknown`,c={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},l=[],u=null,d={},f=!1,p={},m;return{stream:a.pipeThrough(new TransformStream({start(e){e.enqueue({type:`stream-start`,warnings:n})},transform(t,n){var i,a,h,g,_,v,y,b,x,S,C,w,T,E,D,O,ee,k,te,A,j;if(e.includeRawChunks&&n.enqueue({type:`raw`,rawValue:t.rawValue}),!t.success){s=`error`,n.enqueue({type:`error`,error:t.error});return}let M=t.value;if(ai(M))M.item.type===`function_call`?(d[M.output_index]={toolName:M.item.name,toolCallId:M.item.call_id},n.enqueue({type:`tool-input-start`,id:M.item.call_id,toolName:M.item.name})):M.item.type===`web_search_call`?(d[M.output_index]={toolName:r??`web_search`,toolCallId:M.item.id},n.enqueue({type:`tool-input-start`,id:M.item.id,toolName:r??`web_search`})):M.item.type===`computer_call`?(d[M.output_index]={toolName:`computer_use`,toolCallId:M.item.id},n.enqueue({type:`tool-input-start`,id:M.item.id,toolName:`computer_use`})):M.item.type===`file_search_call`?(d[M.output_index]={toolName:`file_search`,toolCallId:M.item.id},n.enqueue({type:`tool-input-start`,id:M.item.id,toolName:`file_search`})):M.item.type===`message`?n.enqueue({type:`text-start`,id:M.item.id,providerMetadata:{openai:{itemId:M.item.id}}}):oi(M)&&(p[M.item.id]={encryptedContent:M.item.encrypted_content,summaryParts:[0]},n.enqueue({type:`reasoning-start`,id:`${M.item.id}:0`,providerMetadata:{openai:{itemId:M.item.id,reasoningEncryptedContent:(i=M.item.encrypted_content)??null}}}));else if(ei(M)){if(M.item.type===`function_call`)d[M.output_index]=void 0,f=!0,n.enqueue({type:`tool-input-end`,id:M.item.call_id}),n.enqueue({type:`tool-call`,toolCallId:M.item.call_id,toolName:M.item.name,input:M.item.arguments,providerMetadata:{openai:{itemId:M.item.id}}});else if(M.item.type===`web_search_call`)d[M.output_index]=void 0,n.enqueue({type:`tool-input-end`,id:M.item.id}),n.enqueue({type:`tool-call`,toolCallId:M.item.id,toolName:`web_search`,input:JSON.stringify({action:M.item.action}),providerExecuted:!0}),n.enqueue({type:`tool-result`,toolCallId:M.item.id,toolName:`web_search`,result:{status:M.item.status},providerExecuted:!0});else if(M.item.type===`computer_call`)d[M.output_index]=void 0,n.enqueue({type:`tool-input-end`,id:M.item.id}),n.enqueue({type:`tool-call`,toolCallId:M.item.id,toolName:`computer_use`,input:``,providerExecuted:!0}),n.enqueue({type:`tool-result`,toolCallId:M.item.id,toolName:`computer_use`,result:{type:`computer_use_tool_result`,status:M.item.status||`completed`},providerExecuted:!0});else if(M.item.type===`file_search_call`)d[M.output_index]=void 0,n.enqueue({type:`tool-input-end`,id:M.item.id}),n.enqueue({type:`tool-call`,toolCallId:M.item.id,toolName:`file_search`,input:``,providerExecuted:!0}),n.enqueue({type:`tool-result`,toolCallId:M.item.id,toolName:`file_search`,result:{type:`file_search_tool_result`,status:M.item.status||`completed`,...M.item.queries&&{queries:M.item.queries},...M.item.results&&{results:M.item.results}},providerExecuted:!0});else if(M.item.type===`message`)n.enqueue({type:`text-end`,id:M.item.id});else if(ti(M)){let e=p[M.item.id];for(let t of e.summaryParts)n.enqueue({type:`reasoning-end`,id:`${M.item.id}:${t}`,providerMetadata:{openai:{itemId:M.item.id,reasoningEncryptedContent:(a=M.item.encrypted_content)??null}}});delete p[M.item.id]}}else if(ii(M)){let e=d[M.output_index];e!=null&&n.enqueue({type:`tool-input-delta`,id:e.toolCallId,delta:M.delta})}else ri(M)?(u=M.response.id,n.enqueue({type:`response-metadata`,id:M.response.id,timestamp:new Date(M.response.created_at*1e3),modelId:M.response.model})):$r(M)?(n.enqueue({type:`text-delta`,id:M.item_id,delta:M.delta}),(g=(h=e.providerOptions)?.openai)?.logprobs&&M.logprobs&&l.push(M.logprobs)):ci(M)?M.summary_index>0&&((_=p[M.item_id])==null||_.summaryParts.push(M.summary_index),n.enqueue({type:`reasoning-start`,id:`${M.item_id}:${M.summary_index}`,providerMetadata:{openai:{itemId:M.item_id,reasoningEncryptedContent:(y=(v=p[M.item_id])?.encryptedContent)??null}}})):li(M)?n.enqueue({type:`reasoning-delta`,id:`${M.item_id}:${M.summary_index}`,delta:M.delta,providerMetadata:{openai:{itemId:M.item_id}}}):ni(M)?(s=Fr({finishReason:(b=M.response.incomplete_details)?.reason,hasFunctionCall:f}),c.inputTokens=M.response.usage.input_tokens,c.outputTokens=M.response.usage.output_tokens,c.totalTokens=M.response.usage.input_tokens+M.response.usage.output_tokens,c.reasoningTokens=(S=(x=M.response.usage.output_tokens_details)?.reasoning_tokens)??void 0,c.cachedInputTokens=(w=(C=M.response.usage.input_tokens_details)?.cached_tokens)??void 0,typeof M.response.service_tier==`string`&&(m=M.response.service_tier)):si(M)?M.annotation.type===`url_citation`?n.enqueue({type:`source`,sourceType:`url`,id:(D=(E=(T=o.config).generateId)?.call(T))??V(),url:M.annotation.url,title:M.annotation.title}):M.annotation.type===`file_citation`&&n.enqueue({type:`source`,sourceType:`document`,id:(k=(ee=(O=o.config).generateId)?.call(O))??V(),mediaType:`text/plain`,title:(A=(te=M.annotation.quote)??M.annotation.filename)??`Document`,filename:(j=M.annotation.filename)??M.annotation.file_id}):ui(M)&&n.enqueue({type:`error`,error:M})},flush(e){let t={openai:{responseId:u}};l.length>0&&(t.openai.logprobs=l),m!==void 0&&(t.openai.serviceTier=m),e.enqueue({type:`finish`,finishReason:s,usage:c,providerMetadata:t})}})),request:{body:t},response:{headers:i}}}},Vr=a.object({input_tokens:a.number(),input_tokens_details:a.object({cached_tokens:a.number().nullish()}).nullish(),output_tokens:a.number(),output_tokens_details:a.object({reasoning_tokens:a.number().nullish()}).nullish()}),Hr=a.object({type:a.literal(`response.output_text.delta`),item_id:a.string(),delta:a.string(),logprobs:zr.nullish()}),Ur=a.object({type:a.literal(`error`),code:a.string(),message:a.string(),param:a.string().nullish(),sequence_number:a.number()}),Wr=a.object({type:a.enum([`response.completed`,`response.incomplete`]),response:a.object({incomplete_details:a.object({reason:a.string()}).nullish(),usage:Vr,service_tier:a.string().nullish()})}),Gr=a.object({type:a.literal(`response.created`),response:a.object({id:a.string(),created_at:a.number(),model:a.string(),service_tier:a.string().nullish()})}),Kr=a.object({type:a.literal(`response.output_item.added`),output_index:a.number(),item:a.discriminatedUnion(`type`,[a.object({type:a.literal(`message`),id:a.string()}),a.object({type:a.literal(`reasoning`),id:a.string(),encrypted_content:a.string().nullish()}),a.object({type:a.literal(`function_call`),id:a.string(),call_id:a.string(),name:a.string(),arguments:a.string()}),a.object({type:a.literal(`web_search_call`),id:a.string(),status:a.string(),action:a.object({type:a.literal(`search`),query:a.string().optional()}).nullish()}),a.object({type:a.literal(`computer_call`),id:a.string(),status:a.string()}),a.object({type:a.literal(`file_search_call`),id:a.string(),status:a.string(),queries:a.array(a.string()).nullish(),results:a.array(a.object({attributes:a.object({file_id:a.string(),filename:a.string(),score:a.number(),text:a.string()})})).optional()})])}),qr=a.object({type:a.literal(`response.output_item.done`),output_index:a.number(),item:a.discriminatedUnion(`type`,[a.object({type:a.literal(`message`),id:a.string()}),a.object({type:a.literal(`reasoning`),id:a.string(),encrypted_content:a.string().nullish()}),a.object({type:a.literal(`function_call`),id:a.string(),call_id:a.string(),name:a.string(),arguments:a.string(),status:a.literal(`completed`)}),Lr,a.object({type:a.literal(`computer_call`),id:a.string(),status:a.literal(`completed`)}),a.object({type:a.literal(`file_search_call`),id:a.string(),status:a.literal(`completed`),queries:a.array(a.string()).nullish(),results:a.array(a.object({attributes:a.object({file_id:a.string(),filename:a.string(),score:a.number(),text:a.string()})})).nullish()})])}),Jr=a.object({type:a.literal(`response.function_call_arguments.delta`),item_id:a.string(),output_index:a.number(),delta:a.string()}),Yr=a.object({type:a.literal(`response.output_text.annotation.added`),annotation:a.discriminatedUnion(`type`,[a.object({type:a.literal(`url_citation`),url:a.string(),title:a.string()}),a.object({type:a.literal(`file_citation`),file_id:a.string(),filename:a.string().nullish(),index:a.number().nullish(),start_index:a.number().nullish(),end_index:a.number().nullish(),quote:a.string().nullish()})])}),Xr=a.object({type:a.literal(`response.reasoning_summary_part.added`),item_id:a.string(),summary_index:a.number()}),Zr=a.object({type:a.literal(`response.reasoning_summary_text.delta`),item_id:a.string(),summary_index:a.number(),delta:a.string()}),Qr=a.union([Hr,Wr,Gr,Kr,qr,Jr,Yr,Xr,Zr,Ur,a.object({type:a.string()}).loose()]);function $r(e){return e.type===`response.output_text.delta`}function ei(e){return e.type===`response.output_item.done`}function ti(e){return ei(e)&&e.item.type===`reasoning`}function ni(e){return e.type===`response.completed`||e.type===`response.incomplete`}function ri(e){return e.type===`response.created`}function ii(e){return e.type===`response.function_call_arguments.delta`}function ai(e){return e.type===`response.output_item.added`}function oi(e){return ai(e)&&e.item.type===`reasoning`}function si(e){return e.type===`response.output_text.annotation.added`}function ci(e){return e.type===`response.reasoning_summary_part.added`}function li(e){return e.type===`response.reasoning_summary_text.delta`}function ui(e){return e.type===`error`}function di(e){let t=e.startsWith(`o3`)||e.startsWith(`o4-mini`)||e.startsWith(`gpt-5`)&&!e.startsWith(`gpt-5-chat`),n=e.startsWith(`gpt-4`)||e.startsWith(`gpt-5-mini`)||e.startsWith(`gpt-5`)&&!e.startsWith(`gpt-5-nano`)&&!e.startsWith(`gpt-5-chat`)||e.startsWith(`o3`)||e.startsWith(`o4-mini`),r={requiredAutoTruncation:!1,systemMessageMode:`system`,supportsFlexProcessing:t,supportsPriorityProcessing:n};return e.startsWith(`gpt-5-chat`)?{...r,isReasoningModel:!1}:e.startsWith(`o`)||e.startsWith(`gpt-5`)||e.startsWith(`codex-`)||e.startsWith(`computer-use`)?e.startsWith(`o1-mini`)||e.startsWith(`o1-preview`)?{...r,isReasoningModel:!0,systemMessageMode:`remove`}:{...r,isReasoningModel:!0,systemMessageMode:`developer`}:{...r,isReasoningModel:!1}}var fi=a.object({metadata:a.any().nullish(),parallelToolCalls:a.boolean().nullish(),previousResponseId:a.string().nullish(),store:a.boolean().nullish(),user:a.string().nullish(),reasoningEffort:a.string().nullish(),strictJsonSchema:a.boolean().nullish(),instructions:a.string().nullish(),reasoningSummary:a.string().nullish(),serviceTier:a.enum([`auto`,`flex`,`priority`]).nullish(),include:a.array(a.enum([`reasoning.encrypted_content`,`file_search_call.results`,`message.output_text.logprobs`])).nullish(),textVerbosity:a.enum([`low`,`medium`,`high`]).nullish(),promptCacheKey:a.string().nullish(),safetyIdentifier:a.string().nullish(),logprobs:a.union([a.boolean(),a.number().min(1).max(Rr)]).optional()}),pi=a.object({instructions:a.string().nullish(),speed:a.number().min(.25).max(4).default(1).nullish()}),mi=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion=`v2`}get provider(){return this.config.provider}async getArgs({text:e,voice:t=`alloy`,outputFormat:n=`mp3`,speed:r,instructions:i,language:a,providerOptions:o}){let s=[],c=await H({provider:`openai`,providerOptions:o,schema:pi}),l={model:this.modelId,input:e,voice:t,response_format:`mp3`,speed:r,instructions:i};if(n&&([`mp3`,`opus`,`aac`,`flac`,`wav`,`pcm`].includes(n)?l.response_format=n:s.push({type:`unsupported-setting`,setting:`outputFormat`,details:`Unsupported output format: ${n}. Using mp3 instead.`})),c){let e={};for(let t in e){let n=e[t];n!==void 0&&(l[t]=n)}}return a&&s.push({type:`unsupported-setting`,setting:`language`,details:`OpenAI speech models do not support language selection. Language parameter "${a}" was ignored.`}),{requestBody:l,warnings:s}}async doGenerate(e){var t,n,r;let i=(r=(n=(t=this.config._internal)?.currentDate)?.call(t))??new Date,{requestBody:a,warnings:o}=await this.getArgs(e),{value:s,responseHeaders:c,rawValue:l}=await U({url:this.config.url({path:`/audio/speech`,modelId:this.modelId}),headers:B(this.config.headers(),e.headers),body:a,failedResponseHandler:Hn,successfulResponseHandler:Et(),abortSignal:e.abortSignal,fetch:this.config.fetch});return{audio:s,warnings:o,request:{body:JSON.stringify(a)},response:{timestamp:i,modelId:this.modelId,headers:c,body:l}}}},hi=a.object({include:a.array(a.string()).optional(),language:a.string().optional(),prompt:a.string().optional(),temperature:a.number().min(0).max(1).default(0).optional(),timestampGranularities:a.array(a.enum([`word`,`segment`])).default([`segment`]).optional()}),gi={afrikaans:`af`,arabic:`ar`,armenian:`hy`,azerbaijani:`az`,belarusian:`be`,bosnian:`bs`,bulgarian:`bg`,catalan:`ca`,chinese:`zh`,croatian:`hr`,czech:`cs`,danish:`da`,dutch:`nl`,english:`en`,estonian:`et`,finnish:`fi`,french:`fr`,galician:`gl`,german:`de`,greek:`el`,hebrew:`he`,hindi:`hi`,hungarian:`hu`,icelandic:`is`,indonesian:`id`,italian:`it`,japanese:`ja`,kannada:`kn`,kazakh:`kk`,korean:`ko`,latvian:`lv`,lithuanian:`lt`,macedonian:`mk`,malay:`ms`,marathi:`mr`,maori:`mi`,nepali:`ne`,norwegian:`no`,persian:`fa`,polish:`pl`,portuguese:`pt`,romanian:`ro`,russian:`ru`,serbian:`sr`,slovak:`sk`,slovenian:`sl`,spanish:`es`,swahili:`sw`,swedish:`sv`,tagalog:`tl`,tamil:`ta`,thai:`th`,turkish:`tr`,ukrainian:`uk`,urdu:`ur`,vietnamese:`vi`,welsh:`cy`},_i=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion=`v2`}get provider(){return this.config.provider}async getArgs({audio:e,mediaType:t,providerOptions:n}){let r=[],i=await H({provider:`openai`,providerOptions:n,schema:hi}),a=new FormData,o=e instanceof Uint8Array?new Blob([e]):new Blob([Fn(e)]);a.append(`model`,this.modelId);let s=nt(t);if(a.append(`file`,new File([o],`audio`,{type:t}),`audio.${s}`),i){let e={include:i.include,language:i.language,prompt:i.prompt,response_format:[`gpt-4o-transcribe`,`gpt-4o-mini-transcribe`].includes(this.modelId)?`json`:`verbose_json`,temperature:i.temperature,timestamp_granularities:i.timestampGranularities};for(let[t,n]of Object.entries(e))if(n!=null)if(Array.isArray(n))for(let e of n)a.append(`${t}[]`,String(e));else a.append(t,String(n))}return{formData:a,warnings:r}}async doGenerate(e){var t,n,r,i,a,o,s,c;let l=(r=(n=(t=this.config._internal)?.currentDate)?.call(t))??new Date,{formData:u,warnings:d}=await this.getArgs(e),{value:f,responseHeaders:p,rawValue:m}=await bt({url:this.config.url({path:`/audio/transcriptions`,modelId:this.modelId}),headers:B(this.config.headers(),e.headers),formData:u,failedResponseHandler:Hn,successfulResponseHandler:K(vi),abortSignal:e.abortSignal,fetch:this.config.fetch}),h=f.language!=null&&f.language in gi?gi[f.language]:void 0;return{text:f.text,segments:(s=(o=(i=f.segments)?.map(e=>({text:e.text,startSecond:e.start,endSecond:e.end})))??(a=f.words)?.map(e=>({text:e.word,startSecond:e.start,endSecond:e.end})))??[],language:h,durationInSeconds:(c=f.duration)??void 0,warnings:d,response:{timestamp:l,modelId:this.modelId,headers:p,body:m}}}},vi=a.object({text:a.string(),language:a.string().nullish(),duration:a.number().nullish(),words:a.array(a.object({word:a.string(),start:a.number(),end:a.number()})).nullish(),segments:a.array(a.object({id:a.number(),seek:a.number(),start:a.number(),end:a.number(),text:a.string(),tokens:a.array(a.number()),temperature:a.number(),avg_logprob:a.number(),compression_ratio:a.number(),no_speech_prob:a.number()})).nullish()});function yi(e={}){var t,n;let r=(t=Rn(e.baseURL))??`https://api.openai.com/v1`,i=(n=e.name)??`openai`,a=()=>({Authorization:`Bearer ${et({apiKey:e.apiKey,environmentVariableName:`OPENAI_API_KEY`,description:`OpenAI`})}`,"OpenAI-Organization":e.organization,"OpenAI-Project":e.project,...e.headers}),o=t=>new tr(t,{provider:`${i}.chat`,url:({path:e})=>`${r}${e}`,headers:a,fetch:e.fetch}),s=t=>new mr(t,{provider:`${i}.completion`,url:({path:e})=>`${r}${e}`,headers:a,fetch:e.fetch}),c=t=>new yr(t,{provider:`${i}.embedding`,url:({path:e})=>`${r}${e}`,headers:a,fetch:e.fetch}),l=t=>new Cr(t,{provider:`${i}.image`,url:({path:e})=>`${r}${e}`,headers:a,fetch:e.fetch}),u=t=>new _i(t,{provider:`${i}.transcription`,url:({path:e})=>`${r}${e}`,headers:a,fetch:e.fetch}),d=t=>new mi(t,{provider:`${i}.speech`,url:({path:e})=>`${r}${e}`,headers:a,fetch:e.fetch}),f=e=>{if(new.target)throw Error(`The OpenAI model function cannot be called with the new keyword.`);return p(e)},p=t=>new Br(t,{provider:`${i}.responses`,url:({path:e})=>`${r}${e}`,headers:a,fetch:e.fetch,fileIdPrefixes:[`file-`]}),m=function(e){return f(e)};return m.languageModel=f,m.chat=o,m.completion=s,m.responses=p,m.embedding=c,m.textEmbedding=c,m.textEmbeddingModel=c,m.image=l,m.imageModel=l,m.transcription=u,m.transcriptionModel=u,m.speech=d,m.speechModel=d,m.tools=jr,m}yi();var bi=`vercel.ai.gateway.error`,xi=Symbol.for(bi),Si,Ci,Z=class e extends (Ci=Error,Si=xi,Ci){constructor({message:e,statusCode:t=500,cause:n}){super(e),this[Si]=!0,this.statusCode=t,this.cause=n}static isInstance(t){return e.hasMarker(t)}static hasMarker(e){return typeof e==`object`&&!!e&&xi in e&&e[xi]===!0}},wi=`GatewayAuthenticationError`,Ti=`vercel.ai.gateway.error.${wi}`,Ei=Symbol.for(Ti),Di,Oi,ki=class e extends (Oi=Z,Di=Ei,Oi){constructor({message:e=`Authentication failed`,statusCode:t=401,cause:n}={}){super({message:e,statusCode:t,cause:n}),this[Di]=!0,this.name=wi,this.type=`authentication_error`}static isInstance(e){return Z.hasMarker(e)&&Ei in e}static createContextualError({apiKeyProvided:t,oidcTokenProvided:n,message:r=`Authentication failed`,statusCode:i=401,cause:a}){let o;return o=t?`AI Gateway authentication failed: Invalid API key provided.

The token is expected to be provided via the 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.`:n?`AI Gateway authentication failed: Invalid OIDC token provided.

The token is expected to be provided via the 'VERCEL_OIDC_TOKEN' environment variable. It expires every 12 hours.
- make sure your Vercel project settings have OIDC enabled
- if running locally with 'vercel dev', the token is automatically obtained and refreshed
- if running locally with your own dev server, run 'vercel env pull' to fetch the token
- in production/preview, the token is automatically obtained and refreshed

Alternative: Provide an API key via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.`:`AI Gateway authentication failed: No authentication provided.

Provide either an API key or OIDC token.

API key instructions:

The token is expected to be provided via the 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.

OIDC token instructions:

The token is expected to be provided via the 'VERCEL_OIDC_TOKEN' environment variable. It expires every 12 hours.
- make sure your Vercel project settings have OIDC enabled
- if running locally with 'vercel dev', the token is automatically obtained and refreshed
- if running locally with your own dev server, run 'vercel env pull' to fetch the token
- in production/preview, the token is automatically obtained and refreshed`,new e({message:o,statusCode:i,cause:a})}},Ai=`GatewayInvalidRequestError`,ji=`vercel.ai.gateway.error.${Ai}`,Mi=Symbol.for(ji),Ni,Pi,Fi=class extends (Pi=Z,Ni=Mi,Pi){constructor({message:e=`Invalid request`,statusCode:t=400,cause:n}={}){super({message:e,statusCode:t,cause:n}),this[Ni]=!0,this.name=Ai,this.type=`invalid_request_error`}static isInstance(e){return Z.hasMarker(e)&&Mi in e}},Ii=`GatewayRateLimitError`,Li=`vercel.ai.gateway.error.${Ii}`,Ri=Symbol.for(Li),zi,Bi,Vi=class extends (Bi=Z,zi=Ri,Bi){constructor({message:e=`Rate limit exceeded`,statusCode:t=429,cause:n}={}){super({message:e,statusCode:t,cause:n}),this[zi]=!0,this.name=Ii,this.type=`rate_limit_exceeded`}static isInstance(e){return Z.hasMarker(e)&&Ri in e}},Hi=`GatewayModelNotFoundError`,Ui=`vercel.ai.gateway.error.${Hi}`,Wi=Symbol.for(Ui),Gi=a.object({modelId:a.string()}),Ki,qi,Ji=class extends (qi=Z,Ki=Wi,qi){constructor({message:e=`Model not found`,statusCode:t=404,modelId:n,cause:r}={}){super({message:e,statusCode:t,cause:r}),this[Ki]=!0,this.name=Hi,this.type=`model_not_found`,this.modelId=n}static isInstance(e){return Z.hasMarker(e)&&Wi in e}},Yi=`GatewayInternalServerError`,Xi=`vercel.ai.gateway.error.${Yi}`,Zi=Symbol.for(Xi),Qi,$i,ea=class extends ($i=Z,Qi=Zi,$i){constructor({message:e=`Internal server error`,statusCode:t=500,cause:n}={}){super({message:e,statusCode:t,cause:n}),this[Qi]=!0,this.name=Yi,this.type=`internal_server_error`}static isInstance(e){return Z.hasMarker(e)&&Zi in e}},ta=`GatewayResponseError`,na=`vercel.ai.gateway.error.${ta}`,ra=Symbol.for(na),ia,aa,oa=class extends (aa=Z,ia=ra,aa){constructor({message:e=`Invalid response from Gateway`,statusCode:t=502,response:n,validationError:r,cause:i}={}){super({message:e,statusCode:t,cause:i}),this[ia]=!0,this.name=ta,this.type=`response_error`,this.response=n,this.validationError=r}static isInstance(e){return Z.hasMarker(e)&&ra in e}};function sa({response:e,statusCode:t,defaultMessage:n=`Gateway request failed`,cause:r,authMethod:i}){let a=ca.safeParse(e);if(!a.success)return new oa({message:`Invalid error response format: ${n}`,statusCode:t,response:e,validationError:a.error,cause:r});let o=a.data,s=o.error.type,c=o.error.message;switch(s){case`authentication_error`:return ki.createContextualError({apiKeyProvided:i===`api-key`,oidcTokenProvided:i===`oidc`,statusCode:t,cause:r});case`invalid_request_error`:return new Fi({message:c,statusCode:t,cause:r});case`rate_limit_exceeded`:return new Vi({message:c,statusCode:t,cause:r});case`model_not_found`:{let e=Gi.safeParse(o.error.param);return new Ji({message:c,statusCode:t,modelId:e.success?e.data.modelId:void 0,cause:r})}case`internal_server_error`:return new ea({message:c,statusCode:t,cause:r});default:return new ea({message:c,statusCode:t,cause:r})}}var ca=a.object({error:a.object({message:a.string(),type:a.string().nullish(),param:a.unknown().nullish(),code:a.union([a.string(),a.number()]).nullish()})});function la(e,t){var n;return Z.isInstance(e)?e:g.isInstance(e)?sa({response:ua(e),statusCode:(n=e.statusCode)??500,defaultMessage:`Gateway request failed`,cause:e,authMethod:t}):sa({response:{},statusCode:500,defaultMessage:e instanceof Error?`Gateway request failed: ${e.message}`:`Unknown Gateway error`,cause:e,authMethod:t})}function ua(e){if(e.data!==void 0)return e.data;if(e.responseBody!=null)try{return JSON.parse(e.responseBody)}catch{return e.responseBody}return{}}var da=`ai-gateway-auth-method`;function fa(e){let t=pa.safeParse(e[da]);return t.success?t.data:void 0}var pa=a.union([a.literal(`api-key`),a.literal(`oidc`)]),ma=class{constructor(e){this.config=e}async getAvailableModels(){try{let{value:e}=await Qe({url:`${this.config.baseURL}/config`,headers:await G(this.config.headers()),successfulResponseHandler:K(va),failedResponseHandler:wt({errorSchema:a.any(),errorToMessage:e=>e}),fetch:this.config.fetch});return e}catch(e){throw la(e)}}},ha=a.object({specificationVersion:a.literal(`v2`),provider:a.string(),modelId:a.string()}),ga=a.object({input:a.string(),output:a.string(),input_cache_read:a.string().nullish(),input_cache_write:a.string().nullish()}).transform(({input:e,output:t,input_cache_read:n,input_cache_write:r})=>({input:e,output:t,...n?{cachedInputTokens:n}:{},...r?{cacheCreationInputTokens:r}:{}})),_a=a.object({id:a.string(),name:a.string(),description:a.string().nullish(),pricing:ga.nullish(),specification:ha,modelType:a.enum([`language`,`embedding`,`image`]).nullish()}),va=a.object({models:a.array(_a)}),ya=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion=`v2`,this.supportedUrls={"*/*":[/.*/]}}get provider(){return this.config.provider}async getArgs(e){let{abortSignal:t,...n}=e;return{args:this.maybeEncodeFileParts(n),warnings:[]}}async doGenerate(e){let{args:t,warnings:n}=await this.getArgs(e),{abortSignal:r}=e,i=await G(this.config.headers());try{let{responseHeaders:o,value:s,rawValue:c}=await U({url:this.getUrl(),headers:B(i,e.headers,this.getModelConfigHeaders(this.modelId,!1),await G(this.config.o11yHeaders)),body:t,successfulResponseHandler:K(a.any()),failedResponseHandler:wt({errorSchema:a.any(),errorToMessage:e=>e}),...r&&{abortSignal:r},fetch:this.config.fetch});return{...s,request:{body:t},response:{headers:o,body:c},warnings:n}}catch(e){throw la(e,fa(i))}}async doStream(e){let{args:t,warnings:n}=await this.getArgs(e),{abortSignal:r}=e,i=await G(this.config.headers());try{let{value:o,responseHeaders:s}=await U({url:this.getUrl(),headers:B(i,e.headers,this.getModelConfigHeaders(this.modelId,!0),await G(this.config.o11yHeaders)),body:t,successfulResponseHandler:Tt(a.any()),failedResponseHandler:wt({errorSchema:a.any(),errorToMessage:e=>e}),...r&&{abortSignal:r},fetch:this.config.fetch});return{stream:o.pipeThrough(new TransformStream({start(e){n.length>0&&e.enqueue({type:`stream-start`,warnings:n})},transform(t,n){if(t.success){let r=t.value;if(r.type===`raw`&&!e.includeRawChunks)return;r.type===`response-metadata`&&r.timestamp&&typeof r.timestamp==`string`&&(r.timestamp=new Date(r.timestamp)),n.enqueue(r)}else n.error(t.error)}})),request:{body:t},response:{headers:s}}}catch(e){throw la(e,fa(i))}}isFilePart(e){return e&&typeof e==`object`&&`type`in e&&e.type===`file`}maybeEncodeFileParts(e){for(let t of e.prompt)for(let e of t.content)if(this.isFilePart(e)){let t=e;if(t.data instanceof Uint8Array){let e=Uint8Array.from(t.data),n=Buffer.from(e).toString(`base64`);t.data=new URL(`data:${t.mediaType||`application/octet-stream`};base64,${n}`)}}return e}getUrl(){return`${this.config.baseURL}/language-model`}getModelConfigHeaders(e,t){return{"ai-language-model-specification-version":`2`,"ai-language-model-id":e,"ai-language-model-streaming":String(t)}}},ba=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion=`v2`,this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:n,providerOptions:r}){var i;let o=await G(this.config.headers());try{let{responseHeaders:s,value:c,rawValue:l}=await U({url:this.getUrl(),headers:B(o,t??{},this.getModelConfigHeaders(),await G(this.config.o11yHeaders)),body:{input:e.length===1?e[0]:e,...r?{providerOptions:r}:{}},successfulResponseHandler:K(xa),failedResponseHandler:wt({errorSchema:a.any(),errorToMessage:e=>e}),...n&&{abortSignal:n},fetch:this.config.fetch});return{embeddings:c.embeddings,usage:(i=c.usage)??void 0,providerMetadata:c.providerMetadata,response:{headers:s,body:l}}}catch(e){throw la(e,fa(o))}}getUrl(){return`${this.config.baseURL}/embedding-model`}getModelConfigHeaders(){return{"ai-embedding-model-specification-version":`2`,"ai-model-id":this.modelId}}},xa=a.object({embeddings:a.array(a.array(a.number())),usage:a.object({tokens:a.number()}).nullish(),providerMetadata:a.record(a.string(),a.record(a.string(),a.unknown())).optional()});async function Sa(){var e,t;let n=(t=(e=Ta().headers)?.[`x-vercel-oidc-token`])??process.env.VERCEL_OIDC_TOKEN;if(!n)throw new ki({message:`OIDC token not available`,statusCode:401});return n}async function Ca(){var e;return(e=Ta().headers)?.[`x-vercel-id`]}var wa=Symbol.for(`@vercel/request-context`);function Ta(){var e,t,n;let r=globalThis;return(n=(t=(e=r[wa])?.get)?.call(e))??{}}var Ea=`0.0.1`;function Da(e={}){var t,n;let r=null,i=null,a=(t=e.metadataCacheRefreshMillis)??1e3*60*5,o=0,s=(n=Rn(e.baseURL))??`https://ai-gateway.vercel.sh/v1/ai`,c=async()=>{let t=await ka(e);if(t)return{Authorization:`Bearer ${t.token}`,"ai-gateway-protocol-version":Ea,[da]:t.authMethod,...e.headers};throw ki.createContextualError({apiKeyProvided:!1,oidcTokenProvided:!1,statusCode:401})},l=()=>{let e=tt({settingValue:void 0,environmentVariableName:`VERCEL_DEPLOYMENT_ID`}),t=tt({settingValue:void 0,environmentVariableName:`VERCEL_ENV`}),n=tt({settingValue:void 0,environmentVariableName:`VERCEL_REGION`});return async()=>{let r=await Ca();return{...e&&{"ai-o11y-deployment-id":e},...t&&{"ai-o11y-environment":t},...n&&{"ai-o11y-region":n},...r&&{"ai-o11y-request-id":r}}}},u=t=>new ya(t,{provider:`gateway`,baseURL:s,headers:c,fetch:e.fetch,o11yHeaders:l()}),d=async()=>{var t,n,l;let u=(l=(n=(t=e._internal)?.currentDate)?.call(t).getTime())??Date.now();return(!r||u-o>a)&&(o=u,r=new ma({baseURL:s,headers:c,fetch:e.fetch}).getAvailableModels().then(e=>(i=e,e)).catch(async e=>{throw la(e,fa(await c()))})),i?Promise.resolve(i):r},f=function(e){if(new.target)throw Error(`The Gateway Provider model function cannot be called with the new keyword.`);return u(e)};return f.getAvailableModels=d,f.imageModel=e=>{throw new xe({modelId:e,modelType:`imageModel`})},f.languageModel=u,f.textEmbeddingModel=t=>new ba(t,{provider:`gateway`,baseURL:s,headers:c,fetch:e.fetch,o11yHeaders:l()}),f}var Oa=Da();async function ka(e){let t=tt({settingValue:e.apiKey,environmentVariableName:`AI_GATEWAY_API_KEY`});if(t)return{token:t,authMethod:`api-key`};try{let e=await Sa();return{token:e,authMethod:`oidc`}}catch{return null}}var Aa,ja=e((()=>{Aa=typeof globalThis==`object`?globalThis:global})),Ma=e((()=>{ja()})),Na=e((()=>{Ma()})),Pa,Fa=e((()=>{Pa=`1.9.0`}));function Ia(e){var t=new Set([e]),n=new Set,r=e.match(La);if(!r)return function(){return!1};var i={major:+r[1],minor:+r[2],patch:+r[3],prerelease:r[4]};if(i.prerelease!=null)return function(t){return t===e};function a(e){return n.add(e),!1}function o(e){return t.add(e),!0}return function(e){if(t.has(e))return!0;if(n.has(e))return!1;var r=e.match(La);if(!r)return a(e);var s={major:+r[1],minor:+r[2],patch:+r[3],prerelease:r[4]};return s.prerelease!=null||i.major!==s.major?a(e):i.major===0?i.minor===s.minor&&i.patch<=s.patch?o(e):a(e):i.minor<=s.minor?o(e):a(e)}}var La,Ra,za=e((()=>{Fa(),La=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/,Ra=Ia(Pa)}));function Ba(e,t,n,r){var i;r===void 0&&(r=!1);var a=Ga[Wa]=(i=Ga[Wa])??{version:Pa};if(!r&&a[e]){var o=Error(`@opentelemetry/api: Attempted duplicate registration of API: `+e);return n.error(o.stack||o.message),!1}if(a.version!==Pa){var o=Error(`@opentelemetry/api: Registration of version v`+a.version+` for `+e+` does not match previously registered API v`+Pa);return n.error(o.stack||o.message),!1}return a[e]=t,n.debug(`@opentelemetry/api: Registered a global for `+e+` v`+Pa+`.`),!0}function Va(e){var t,n,r=(t=Ga[Wa])?.version;if(!(!r||!Ra(r)))return(n=Ga[Wa])?.[e]}function Ha(e,t){t.debug(`@opentelemetry/api: Unregistering a global for `+e+` v`+Pa+`.`);var n=Ga[Wa];n&&delete n[e]}var Ua,Wa,Ga,Ka=e((()=>{Na(),Fa(),za(),Ua=Pa.split(`.`)[0],Wa=Symbol.for(`opentelemetry.js.api.`+Ua),Ga=Aa}));function qa(e,t,n){var r=Va(`diag`);if(r)return n.unshift(t),r[e].apply(r,Ya([],Ja(n),!1))}var Ja,Ya,Xa,Za=e((()=>{Ka(),Ja=function(e,t){var n=typeof Symbol==`function`&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,a=[],o;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},Ya=function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,a;r<i;r++)(a||!(r in t))&&(a||=Array.prototype.slice.call(t,0,r),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))},Xa=function(){function e(e){this._namespace=e.namespace||`DiagComponentLogger`}return e.prototype.debug=function(){var e=[...arguments];return qa(`debug`,this._namespace,e)},e.prototype.error=function(){var e=[...arguments];return qa(`error`,this._namespace,e)},e.prototype.info=function(){var e=[...arguments];return qa(`info`,this._namespace,e)},e.prototype.warn=function(){var e=[...arguments];return qa(`warn`,this._namespace,e)},e.prototype.verbose=function(){var e=[...arguments];return qa(`verbose`,this._namespace,e)},e}()})),Q,Qa=e((()=>{(function(e){e[e.NONE=0]=`NONE`,e[e.ERROR=30]=`ERROR`,e[e.WARN=50]=`WARN`,e[e.INFO=60]=`INFO`,e[e.DEBUG=70]=`DEBUG`,e[e.VERBOSE=80]=`VERBOSE`,e[e.ALL=9999]=`ALL`})(Q||={})}));function $a(e,t){e<Q.NONE?e=Q.NONE:e>Q.ALL&&(e=Q.ALL),t||={};function n(n,r){var i=t[n];return typeof i==`function`&&e>=r?i.bind(t):function(){}}return{error:n(`error`,Q.ERROR),warn:n(`warn`,Q.WARN),info:n(`info`,Q.INFO),debug:n(`debug`,Q.DEBUG),verbose:n(`verbose`,Q.VERBOSE)}}var eo=e((()=>{Qa()})),to,no,ro,io,ao=e((()=>{Za(),eo(),Qa(),Ka(),to=function(e,t){var n=typeof Symbol==`function`&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,a=[],o;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},no=function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,a;r<i;r++)(a||!(r in t))&&(a||=Array.prototype.slice.call(t,0,r),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))},ro=`diag`,io=function(){function e(){function e(e){return function(){var t=[...arguments],n=Va(`diag`);if(n)return n[e].apply(n,no([],to(t),!1))}}var t=this,n=function(e,n){var r,i,a;if(n===void 0&&(n={logLevel:Q.INFO}),e===t){var o=Error(`Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation`);return t.error((r=o.stack)??o.message),!1}typeof n==`number`&&(n={logLevel:n});var s=Va(`diag`),c=$a((i=n.logLevel)??Q.INFO,e);if(s&&!n.suppressOverrideMessage){var l=(a=Error().stack)??`<failed to generate stacktrace>`;s.warn(`Current logger will be overwritten from `+l),c.warn(`Current logger will overwrite one already registered from `+l)}return Ba(`diag`,c,t,!0)};t.setLogger=n,t.disable=function(){Ha(ro,t)},t.createComponentLogger=function(e){return new Xa(e)},t.verbose=e(`verbose`),t.debug=e(`debug`),t.info=e(`info`),t.warn=e(`warn`),t.error=e(`error`)}return e.instance=function(){return this._instance||=new e,this._instance},e}()})),oo,so,co,lo=e((()=>{oo=function(e,t){var n=typeof Symbol==`function`&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,a=[],o;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},so=function(e){var t=typeof Symbol==`function`&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length==`number`)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw TypeError(t?`Object is not iterable.`:`Symbol.iterator is not defined.`)},co=function(){function e(e){this._entries=e?new Map(e):new Map}return e.prototype.getEntry=function(e){var t=this._entries.get(e);if(t)return Object.assign({},t)},e.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map(function(e){var t=oo(e,2),n=t[0],r=t[1];return[n,r]})},e.prototype.setEntry=function(t,n){var r=new e(this._entries);return r._entries.set(t,n),r},e.prototype.removeEntry=function(t){var n=new e(this._entries);return n._entries.delete(t),n},e.prototype.removeEntries=function(){for(var t,n,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var a=new e(this._entries);try{for(var o=so(r),s=o.next();!s.done;s=o.next()){var c=s.value;a._entries.delete(c)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return a},e.prototype.clear=function(){return new e},e}()})),uo,fo=e((()=>{uo=Symbol(`BaggageEntryMetadata`)}));function po(e){return e===void 0&&(e={}),new co(new Map(Object.entries(e)))}function mo(e){return typeof e!=`string`&&(ho.error(`Cannot create baggage metadata from unknown type: `+typeof e),e=``),{__TYPE__:uo,toString:function(){return e}}}var ho,go=e((()=>{ao(),lo(),fo(),ho=io.instance()}));function _o(e){return Symbol.for(e)}var vo,yo,bo=e((()=>{vo=function(){function e(t){var n=this;n._currentContext=t?new Map(t):new Map,n.getValue=function(e){return n._currentContext.get(e)},n.setValue=function(t,r){var i=new e(n._currentContext);return i._currentContext.set(t,r),i},n.deleteValue=function(t){var r=new e(n._currentContext);return r._currentContext.delete(t),r}}return e}(),yo=new vo})),xo,So,Co=e((()=>{xo=[{n:`error`,c:`error`},{n:`warn`,c:`warn`},{n:`info`,c:`info`},{n:`debug`,c:`debug`},{n:`verbose`,c:`trace`}],So=function(){function e(){function e(e){return function(){var t=[...arguments];if(console){var n=console[e];if(typeof n!=`function`&&(n=console.log),typeof n==`function`)return n.apply(console,t)}}}for(var t=0;t<xo.length;t++)this[xo[t].n]=e(xo[t].c)}return e}()}));function wo(){return Io}var To,Eo,Do,Oo,ko,Ao,jo,Mo,No,Po,Fo,Io,Lo,Ro,zo,Bo,Vo,Ho,Uo,Wo=e((()=>{To=(function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if(typeof n!=`function`&&n!==null)throw TypeError(`Class extends value `+String(n)+` is not a constructor or null`);e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}})(),Eo=function(){function e(){}return e.prototype.createGauge=function(e,t){return Ro},e.prototype.createHistogram=function(e,t){return zo},e.prototype.createCounter=function(e,t){return Lo},e.prototype.createUpDownCounter=function(e,t){return Bo},e.prototype.createObservableGauge=function(e,t){return Ho},e.prototype.createObservableCounter=function(e,t){return Vo},e.prototype.createObservableUpDownCounter=function(e,t){return Uo},e.prototype.addBatchObservableCallback=function(e,t){},e.prototype.removeBatchObservableCallback=function(e){},e}(),Do=function(){function e(){}return e}(),Oo=function(e){To(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.add=function(e,t){},t}(Do),ko=function(e){To(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.add=function(e,t){},t}(Do),Ao=function(e){To(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.record=function(e,t){},t}(Do),jo=function(e){To(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.record=function(e,t){},t}(Do),Mo=function(){function e(){}return e.prototype.addCallback=function(e){},e.prototype.removeCallback=function(e){},e}(),No=function(e){To(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(Mo),Po=function(e){To(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(Mo),Fo=function(e){To(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(Mo),Io=new Eo,Lo=new Oo,Ro=new Ao,zo=new jo,Bo=new ko,Vo=new No,Ho=new Po,Uo=new Fo})),Go,Ko=e((()=>{(function(e){e[e.INT=0]=`INT`,e[e.DOUBLE=1]=`DOUBLE`})(Go||={})})),qo,Jo,Yo=e((()=>{qo={get:function(e,t){if(e!=null)return e[t]},keys:function(e){return e==null?[]:Object.keys(e)}},Jo={set:function(e,t,n){e!=null&&(e[t]=n)}}})),Xo,Zo,Qo,$o=e((()=>{bo(),Xo=function(e,t){var n=typeof Symbol==`function`&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,a=[],o;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},Zo=function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,a;r<i;r++)(a||!(r in t))&&(a||=Array.prototype.slice.call(t,0,r),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))},Qo=function(){function e(){}return e.prototype.active=function(){return yo},e.prototype.with=function(e,t,n){var r=[...arguments].slice(3);return t.call.apply(t,Zo([n],Xo(r),!1))},e.prototype.bind=function(e,t){return t},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}()})),es,ts,ns,rs,os,ss=e((()=>{$o(),Ka(),ao(),es=function(e,t){var n=typeof Symbol==`function`&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,a=[],o;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},ts=function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,a;r<i;r++)(a||!(r in t))&&(a||=Array.prototype.slice.call(t,0,r),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))},ns=`context`,rs=new Qo,os=function(){function e(){}return e.getInstance=function(){return this._instance||=new e,this._instance},e.prototype.setGlobalContextManager=function(e){return Ba(ns,e,io.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(e,t,n){for(var r,i=[],a=3;a<arguments.length;a++)i[a-3]=arguments[a];return(r=this._getContextManager()).with.apply(r,ts([e,t,n],es(i),!1))},e.prototype.bind=function(e,t){return this._getContextManager().bind(e,t)},e.prototype._getContextManager=function(){return Va(ns)||rs},e.prototype.disable=function(){this._getContextManager().disable(),Ha(ns,io.instance())},e}()})),cs,ls=e((()=>{(function(e){e[e.NONE=0]=`NONE`,e[e.SAMPLED=1]=`SAMPLED`})(cs||={})})),us,ds,fs,ps=e((()=>{ls(),us=`0000000000000000`,ds=`00000000000000000000000000000000`,fs={traceId:ds,spanId:us,traceFlags:cs.NONE}})),ms,hs=e((()=>{ps(),ms=function(){function e(e){e===void 0&&(e=fs),this._spanContext=e}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return this},e.prototype.setAttributes=function(e){return this},e.prototype.addEvent=function(e,t){return this},e.prototype.addLink=function(e){return this},e.prototype.addLinks=function(e){return this},e.prototype.setStatus=function(e){return this},e.prototype.updateName=function(e){return this},e.prototype.end=function(e){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(e,t){},e}()}));function gs(e){return e.getValue(Ss)||void 0}function _s(){return gs(os.getInstance().active())}function vs(e,t){return e.setValue(Ss,t)}function ys(e){return e.deleteValue(Ss)}function bs(e,t){return vs(e,new ms(t))}function xs(e){var t;return(t=gs(e))?.spanContext()}var Ss,Cs=e((()=>{bo(),hs(),ss(),Ss=_o(`OpenTelemetry Context Key SPAN`)}));function ws(e){return Os.test(e)&&e!==ds}function Ts(e){return ks.test(e)&&e!==us}function Es(e){return ws(e.traceId)&&Ts(e.spanId)}function Ds(e){return new ms(e)}var Os,ks,As=e((()=>{ps(),hs(),Os=/^([0-9a-f]{32})$/i,ks=/^[0-9a-f]{16}$/i}));function js(e){return typeof e==`object`&&typeof e.spanId==`string`&&typeof e.traceId==`string`&&typeof e.traceFlags==`number`}var Ms,Ns,Ps=e((()=>{ss(),Cs(),hs(),As(),Ms=os.getInstance(),Ns=function(){function e(){}return e.prototype.startSpan=function(e,t,n){n===void 0&&(n=Ms.active());var r=!!t?.root;if(r)return new ms;var i=n&&xs(n);return js(i)&&Es(i)?new ms(i):new ms},e.prototype.startActiveSpan=function(e,t,n,r){var i,a,o;if(!(arguments.length<2)){arguments.length===2?o=t:arguments.length===3?(i=t,o=n):(i=t,a=n,o=r);var s=a??Ms.active(),c=this.startSpan(e,i,s),l=vs(s,c);return Ms.with(l,o,void 0,c)}},e}()})),Fs,Is,Ls=e((()=>{Ps(),Fs=new Ns,Is=function(){function e(e,t,n,r){this._provider=e,this.name=t,this.version=n,this.options=r}return e.prototype.startSpan=function(e,t,n){return this._getTracer().startSpan(e,t,n)},e.prototype.startActiveSpan=function(e,t,n,r){var i=this._getTracer();return Reflect.apply(i.startActiveSpan,i,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):Fs},e}()})),Rs,zs=e((()=>{Ps(),Rs=function(){function e(){}return e.prototype.getTracer=function(e,t,n){return new Ns},e}()})),Bs,Vs,Hs=e((()=>{Ls(),zs(),Bs=new Rs,Vs=function(){function e(){}return e.prototype.getTracer=function(e,t,n){var r;return(r=this.getDelegateTracer(e,t,n))??new Is(this,e,t,n)},e.prototype.getDelegate=function(){var e;return(e=this._delegate)??Bs},e.prototype.setDelegate=function(e){this._delegate=e},e.prototype.getDelegateTracer=function(e,t,n){var r;return(r=this._delegate)?.getTracer(e,t,n)},e}()})),Us,Ws=e((()=>{(function(e){e[e.NOT_RECORD=0]=`NOT_RECORD`,e[e.RECORD=1]=`RECORD`,e[e.RECORD_AND_SAMPLED=2]=`RECORD_AND_SAMPLED`})(Us||={})})),Gs,Ks=e((()=>{(function(e){e[e.INTERNAL=0]=`INTERNAL`,e[e.SERVER=1]=`SERVER`,e[e.CLIENT=2]=`CLIENT`,e[e.PRODUCER=3]=`PRODUCER`,e[e.CONSUMER=4]=`CONSUMER`})(Gs||={})})),qs,Js=e((()=>{(function(e){e[e.UNSET=0]=`UNSET`,e[e.OK=1]=`OK`,e[e.ERROR=2]=`ERROR`})(qs||={})}));function Ys(e){return ec.test(e)}function Xs(e){return tc.test(e)&&!nc.test(e)}var Zs,Qs,$s,ec,tc,nc,rc=e((()=>{Zs=`[_0-9a-z-*/]`,Qs=`[a-z]`+Zs+`{0,255}`,$s=`[a-z0-9]`+Zs+`{0,240}@[a-z]`+Zs+`{0,13}`,ec=RegExp(`^(?:`+Qs+`|`+$s+`)$`),tc=/^[ -~]{0,255}[!-~]$/,nc=/,|=/})),ic,ac,oc,sc,cc,lc=e((()=>{rc(),ic=32,ac=512,oc=`,`,sc=`=`,cc=function(){function e(e){this._internalState=new Map,e&&this._parse(e)}return e.prototype.set=function(e,t){var n=this._clone();return n._internalState.has(e)&&n._internalState.delete(e),n._internalState.set(e,t),n},e.prototype.unset=function(e){var t=this._clone();return t._internalState.delete(e),t},e.prototype.get=function(e){return this._internalState.get(e)},e.prototype.serialize=function(){var e=this;return this._keys().reduce(function(t,n){return t.push(n+sc+e.get(n)),t},[]).join(oc)},e.prototype._parse=function(e){e.length>ac||(this._internalState=e.split(oc).reverse().reduce(function(e,t){var n=t.trim(),r=n.indexOf(sc);if(r!==-1){var i=n.slice(0,r),a=n.slice(r+1,t.length);Ys(i)&&Xs(a)&&e.set(i,a)}return e},new Map),this._internalState.size>ic&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,ic))))},e.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},e.prototype._clone=function(){var t=new e;return t._internalState=new Map(this._internalState),t},e}()}));function uc(e){return new cc(e)}var dc=e((()=>{lc()})),fc,pc=e((()=>{ss(),fc=os.getInstance()})),mc,hc=e((()=>{ao(),mc=io.instance()})),gc,_c,vc=e((()=>{Wo(),gc=function(){function e(){}return e.prototype.getMeter=function(e,t,n){return Io},e}(),_c=new gc})),yc,bc,xc=e((()=>{vc(),Ka(),ao(),yc=`metrics`,bc=function(){function e(){}return e.getInstance=function(){return this._instance||=new e,this._instance},e.prototype.setGlobalMeterProvider=function(e){return Ba(yc,e,io.instance())},e.prototype.getMeterProvider=function(){return Va(yc)||_c},e.prototype.getMeter=function(e,t,n){return this.getMeterProvider().getMeter(e,t,n)},e.prototype.disable=function(){Ha(yc,io.instance())},e}()})),Sc,Cc=e((()=>{xc(),Sc=bc.getInstance()})),wc,Tc=e((()=>{wc=function(){function e(){}return e.prototype.inject=function(e,t){},e.prototype.extract=function(e,t){return e},e.prototype.fields=function(){return[]},e}()}));function Ec(e){return e.getValue(Ac)||void 0}function Dc(){return Ec(os.getInstance().active())}function Oc(e,t){return e.setValue(Ac,t)}function kc(e){return e.deleteValue(Ac)}var Ac,jc=e((()=>{ss(),bo(),Ac=_o(`OpenTelemetry Baggage Key`)})),Mc,Nc,Pc,Fc=e((()=>{Ka(),Tc(),Yo(),jc(),go(),ao(),Mc=`propagation`,Nc=new wc,Pc=function(){function e(){this.createBaggage=po,this.getBaggage=Ec,this.getActiveBaggage=Dc,this.setBaggage=Oc,this.deleteBaggage=kc}return e.getInstance=function(){return this._instance||=new e,this._instance},e.prototype.setGlobalPropagator=function(e){return Ba(Mc,e,io.instance())},e.prototype.inject=function(e,t,n){return n===void 0&&(n=Jo),this._getGlobalPropagator().inject(e,t,n)},e.prototype.extract=function(e,t,n){return n===void 0&&(n=qo),this._getGlobalPropagator().extract(e,t,n)},e.prototype.fields=function(){return this._getGlobalPropagator().fields()},e.prototype.disable=function(){Ha(Mc,io.instance())},e.prototype._getGlobalPropagator=function(){return Va(Mc)||Nc},e}()})),Ic,Lc=e((()=>{Fc(),Ic=Pc.getInstance()})),Rc,zc,Bc=e((()=>{Ka(),Hs(),As(),Cs(),ao(),Rc=`trace`,zc=function(){function e(){this._proxyTracerProvider=new Vs,this.wrapSpanContext=Ds,this.isSpanContextValid=Es,this.deleteSpan=ys,this.getSpan=gs,this.getActiveSpan=_s,this.getSpanContext=xs,this.setSpan=vs,this.setSpanContext=bs}return e.getInstance=function(){return this._instance||=new e,this._instance},e.prototype.setGlobalTracerProvider=function(e){var t=Ba(Rc,this._proxyTracerProvider,io.instance());return t&&this._proxyTracerProvider.setDelegate(e),t},e.prototype.getTracerProvider=function(){return Va(Rc)||this._proxyTracerProvider},e.prototype.getTracer=function(e,t){return this.getTracerProvider().getTracer(e,t)},e.prototype.disable=function(){Ha(Rc,io.instance()),this._proxyTracerProvider=new Vs},e}()})),Vc,Hc=e((()=>{Bc(),Vc=zc.getInstance()})),Uc={};t(Uc,{DiagConsoleLogger:()=>So,DiagLogLevel:()=>Q,INVALID_SPANID:()=>us,INVALID_SPAN_CONTEXT:()=>fs,INVALID_TRACEID:()=>ds,ProxyTracer:()=>Is,ProxyTracerProvider:()=>Vs,ROOT_CONTEXT:()=>yo,SamplingDecision:()=>Us,SpanKind:()=>Gs,SpanStatusCode:()=>qs,TraceFlags:()=>cs,ValueType:()=>Go,baggageEntryMetadataFromString:()=>mo,context:()=>fc,createContextKey:()=>_o,createNoopMeter:()=>wo,createTraceState:()=>uc,default:()=>Wc,defaultTextMapGetter:()=>qo,defaultTextMapSetter:()=>Jo,diag:()=>mc,isSpanContextValid:()=>Es,isValidSpanId:()=>Ts,isValidTraceId:()=>ws,metrics:()=>Sc,propagation:()=>Ic,trace:()=>Vc});var Wc,Gc=e((()=>{go(),bo(),Co(),Qa(),Wo(),Ko(),Yo(),Ls(),Hs(),Ws(),Ks(),Js(),ls(),dc(),As(),ps(),pc(),hc(),Cc(),Lc(),Hc(),Wc={context:fc,diag:mc,metrics:Sc,propagation:Ic,trace:Vc}}));Gc();var Kc=Object.defineProperty,qc=(e,t)=>{for(var n in t)Kc(e,n,{get:t[n],enumerable:!0})},Jc=`AI_NoOutputSpecifiedError`,Yc=`vercel.ai.error.${Jc}`,Xc=Symbol.for(Yc),Zc,Qc=class extends d{constructor({message:e=`No output specified.`}={}){super({name:Jc,message:e}),this[Zc]=!0}static isInstance(e){return d.hasMarker(e,Yc)}};Zc=Xc;function $c(e){let t=`AI SDK Warning:`;switch(e.type){case`unsupported-setting`:{let n=`${t} The "${e.setting}" setting is not supported by this model`;return e.details&&(n+=` - ${e.details}`),n}case`unsupported-tool`:{let n=`name`in e.tool?e.tool.name:`unknown tool`,r=`${t} The tool "${n}" is not supported by this model`;return e.details&&(r+=` - ${e.details}`),r}case`other`:return`${t} ${e.message}`;default:return`${t} ${JSON.stringify(e,null,2)}`}}var el=`AI SDK Warning System: To turn off warning logging, set the AI_SDK_LOG_WARNINGS global to false.`,tl=!1,nl=e=>{if(e.length===0)return;let t=globalThis.AI_SDK_LOG_WARNINGS;if(t!==!1){if(typeof t==`function`){t(e);return}tl||(tl=!0,console.info(el));for(let t of e)console.warn($c(t))}},rl=`AI_InvalidArgumentError`,il=`vercel.ai.error.${rl}`,al=Symbol.for(il),ol,sl=class extends d{constructor({parameter:e,value:t,message:n}){super({name:rl,message:`Invalid argument for parameter ${e}: ${n}`}),this[ol]=!0,this.parameter=e,this.value=t}static isInstance(e){return d.hasMarker(e,il)}};ol=al;var cl=`AI_InvalidStreamPartError`,ll=`vercel.ai.error.${cl}`,ul=Symbol.for(ll),dl;dl=ul;var fl=`AI_InvalidToolInputError`,pl=`vercel.ai.error.${fl}`,ml=Symbol.for(pl),hl,gl=class extends d{constructor({toolInput:e,toolName:t,cause:n,message:r=`Invalid input for tool ${t}: ${S(n)}`}){super({name:fl,message:r,cause:n}),this[hl]=!0,this.toolInput=e,this.toolName=t}static isInstance(e){return d.hasMarker(e,pl)}};hl=ml;var _l=`AI_MCPClientError`,vl=`vercel.ai.error.${_l}`,yl=Symbol.for(vl),bl;bl=yl;var xl=`AI_NoImageGeneratedError`,Sl=`vercel.ai.error.${xl}`,Cl=Symbol.for(Sl),wl;wl=Cl;var Tl=`AI_NoObjectGeneratedError`,El=`vercel.ai.error.${Tl}`,Dl=Symbol.for(El),Ol,kl=class extends d{constructor({message:e=`No object generated.`,cause:t,text:n,response:r,usage:i,finishReason:a}){super({name:Tl,message:e,cause:t}),this[Ol]=!0,this.text=n,this.response=r,this.usage=i,this.finishReason=a}static isInstance(e){return d.hasMarker(e,El)}};Ol=Dl;var Al=`AI_NoOutputGeneratedError`,jl=`vercel.ai.error.${Al}`,Ml=Symbol.for(jl),Nl,Pl=class extends d{constructor({message:e=`No output generated.`,cause:t}={}){super({name:Al,message:e,cause:t}),this[Nl]=!0}static isInstance(e){return d.hasMarker(e,jl)}};Nl=Ml;var Fl=`AI_NoSuchToolError`,Il=`vercel.ai.error.${Fl}`,Ll=Symbol.for(Il),Rl,zl=class extends d{constructor({toolName:e,availableTools:t=void 0,message:n=`Model tried to call unavailable tool '${e}'. ${t===void 0?`No tools are available.`:`Available tools: ${t.join(`, `)}.`}`}){super({name:Fl,message:n}),this[Rl]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return d.hasMarker(e,Il)}};Rl=Ll;var Bl=`AI_ToolCallRepairError`,Vl=`vercel.ai.error.${Bl}`,Hl=Symbol.for(Vl),Ul,Wl=class extends d{constructor({cause:e,originalError:t,message:n=`Error repairing tool call: ${S(e)}`}){super({name:Bl,message:n,cause:e}),this[Ul]=!0,this.originalError=t}static isInstance(e){return d.hasMarker(e,Vl)}};Ul=Hl;var Gl=class extends d{constructor(e){super({name:`AI_UnsupportedModelVersionError`,message:`Unsupported model version ${e.version} for provider "${e.provider}" and model "${e.modelId}". AI SDK 5 only supports models that implement specification version "v2".`}),this.version=e.version,this.provider=e.provider,this.modelId=e.modelId}},Kl=`AI_InvalidDataContentError`,ql=`vercel.ai.error.${Kl}`,Jl=Symbol.for(ql),Yl;Yl=Jl;var Xl=`AI_InvalidMessageRoleError`,Zl=`vercel.ai.error.${Xl}`,Ql=Symbol.for(Zl),$l,eu=class extends d{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:Xl,message:t}),this[$l]=!0,this.role=e}static isInstance(e){return d.hasMarker(e,Zl)}};$l=Ql;var tu=`AI_MessageConversionError`,nu=`vercel.ai.error.${tu}`,ru=Symbol.for(nu),iu;iu=ru;var au=`AI_DownloadError`,ou=`vercel.ai.error.${au}`,su=Symbol.for(ou),cu,lu=class extends d{constructor({url:e,statusCode:t,statusText:n,cause:r,message:i=r==null?`Failed to download ${e}: ${t} ${n}`:`Failed to download ${e}: ${r}`}){super({name:au,message:i,cause:r}),this[cu]=!0,this.url=e,this.statusCode=t,this.statusText=n}static isInstance(e){return d.hasMarker(e,ou)}};cu=su;var uu=`AI_RetryError`,du=`vercel.ai.error.${uu}`,fu=Symbol.for(du),pu,mu=class extends d{constructor({message:e,reason:t,errors:n}){super({name:uu,message:e}),this[pu]=!0,this.reason=t,this.errors=n,this.lastError=n[n.length-1]}static isInstance(e){return d.hasMarker(e,du)}};pu=fu;function hu(e){if(typeof e!=`string`){if(e.specificationVersion!==`v2`)throw new Gl({version:e.specificationVersion,provider:e.provider,modelId:e.modelId});return e}return gu().languageModel(e)}function gu(){var e;return(e=globalThis.AI_SDK_DEFAULT_PROVIDER)??Oa}var _u=[{mediaType:`image/gif`,bytesPrefix:[71,73,70],base64Prefix:`R0lG`},{mediaType:`image/png`,bytesPrefix:[137,80,78,71],base64Prefix:`iVBORw`},{mediaType:`image/jpeg`,bytesPrefix:[255,216],base64Prefix:`/9j/`},{mediaType:`image/webp`,bytesPrefix:[82,73,70,70],base64Prefix:`UklGRg`},{mediaType:`image/bmp`,bytesPrefix:[66,77],base64Prefix:`Qk`},{mediaType:`image/tiff`,bytesPrefix:[73,73,42,0],base64Prefix:`SUkqAA`},{mediaType:`image/tiff`,bytesPrefix:[77,77,0,42],base64Prefix:`TU0AKg`},{mediaType:`image/avif`,bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102],base64Prefix:`AAAAIGZ0eXBhdmlm`},{mediaType:`image/heic`,bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99],base64Prefix:`AAAAIGZ0eXBoZWlj`}],vu=e=>{let t=typeof e==`string`?Fn(e):e,n=(t[6]&127)<<21|(t[7]&127)<<14|(t[8]&127)<<7|t[9]&127;return t.slice(n+10)};function yu(e){let t=typeof e==`string`&&e.startsWith(`SUQz`)||typeof e!=`string`&&e.length>10&&e[0]===73&&e[1]===68&&e[2]===51;return t?vu(e):e}function bu({data:e,signatures:t}){let n=yu(e);for(let e of t)if(typeof n==`string`?n.startsWith(e.base64Prefix):n.length>=e.bytesPrefix.length&&e.bytesPrefix.every((e,t)=>n[t]===e))return e.mediaType}var xu=async({url:e})=>{var t;let n=e.toString();try{let e=await fetch(n);if(!e.ok)throw new lu({url:n,statusCode:e.status,statusText:e.statusText});return{data:new Uint8Array(await e.arrayBuffer()),mediaType:(t=e.headers.get(`content-type`))??void 0}}catch(e){throw lu.isInstance(e)?e:new lu({url:n,cause:e})}},Su=(e=xu)=>t=>Promise.all(t.map(async t=>t.isUrlSupportedByModel?null:e(t)));function Cu(e){try{let[t,n]=e.split(`,`);return{mediaType:t.split(`;`)[0].split(`:`)[1],base64Content:n}}catch{return{mediaType:void 0,base64Content:void 0}}}var wu=a.union([a.string(),a.instanceof(Uint8Array),a.instanceof(ArrayBuffer),a.custom(e=>{var t,n;return(n=(t=globalThis.Buffer)?.isBuffer(e))??!1},{message:`Must be a Buffer`})]);function Tu(e){if(e instanceof Uint8Array)return{data:e,mediaType:void 0};if(e instanceof ArrayBuffer)return{data:new Uint8Array(e),mediaType:void 0};if(typeof e==`string`)try{e=new URL(e)}catch{}if(e instanceof URL&&e.protocol===`data:`){let{mediaType:t,base64Content:n}=Cu(e.toString());if(t==null||n==null)throw new d({name:`InvalidDataContentError`,message:`Invalid data URL format in content ${e.toString()}`});return{data:n,mediaType:t}}return{data:e,mediaType:void 0}}function Eu(e){return typeof e==`string`?e:e instanceof ArrayBuffer?In(new Uint8Array(e)):In(e)}async function Du({prompt:e,supportedUrls:t,download:n=Su()}){let r=await ku(e.messages,n,t);return[...e.system==null?[]:[{role:`system`,content:e.system}],...e.messages.map(e=>Ou({message:e,downloadedAssets:r}))]}function Ou({message:e,downloadedAssets:t}){let n=e.role;switch(n){case`system`:return{role:`system`,content:e.content,providerOptions:e.providerOptions};case`user`:return typeof e.content==`string`?{role:`user`,content:[{type:`text`,text:e.content}],providerOptions:e.providerOptions}:{role:`user`,content:e.content.map(e=>Au(e,t)).filter(e=>e.type!==`text`||e.text!==``),providerOptions:e.providerOptions};case`assistant`:return typeof e.content==`string`?{role:`assistant`,content:[{type:`text`,text:e.content}],providerOptions:e.providerOptions}:{role:`assistant`,content:e.content.filter(e=>e.type!==`text`||e.text!==``).map(e=>{let t=e.providerOptions;switch(e.type){case`file`:{let{data:n,mediaType:r}=Tu(e.data);return{type:`file`,data:n,filename:e.filename,mediaType:r??e.mediaType,providerOptions:t}}case`reasoning`:return{type:`reasoning`,text:e.text,providerOptions:t};case`text`:return{type:`text`,text:e.text,providerOptions:t};case`tool-call`:return{type:`tool-call`,toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,providerExecuted:e.providerExecuted,providerOptions:t};case`tool-result`:return{type:`tool-result`,toolCallId:e.toolCallId,toolName:e.toolName,output:e.output,providerOptions:t}}}),providerOptions:e.providerOptions};case`tool`:return{role:`tool`,content:e.content.map(e=>({type:`tool-result`,toolCallId:e.toolCallId,toolName:e.toolName,output:e.output,providerOptions:e.providerOptions})),providerOptions:e.providerOptions};default:{let e=n;throw new eu({role:e})}}}async function ku(e,t,n){let r=e.filter(e=>e.role===`user`).map(e=>e.content).filter(e=>Array.isArray(e)).flat().filter(e=>e.type===`image`||e.type===`file`).map(e=>{var t;let n=(t=e.mediaType)??(e.type===`image`?`image/*`:void 0),r=e.type===`image`?e.image:e.data;if(typeof r==`string`)try{r=new URL(r)}catch{}return{mediaType:n,data:r}}).filter(e=>e.data instanceof URL).map(e=>({url:e.data,isUrlSupportedByModel:e.mediaType!=null&&$e({url:e.data.toString(),mediaType:e.mediaType,supportedUrls:n})})),i=await t(r);return Object.fromEntries(i.filter(e=>e?.data!=null).map(({data:e,mediaType:t},n)=>[r[n].url.toString(),{data:e,mediaType:t}]))}function Au(e,t){var n;if(e.type===`text`)return{type:`text`,text:e.text,providerOptions:e.providerOptions};let r,i=e.type;switch(i){case`image`:r=e.image;break;case`file`:r=e.data;break;default:throw Error(`Unsupported part type: ${i}`)}let{data:a,mediaType:o}=Tu(r),s=o??e.mediaType,c=a;if(c instanceof URL){let e=t[c.toString()];e&&(c=e.data,s??=e.mediaType)}switch(i){case`image`:return(c instanceof Uint8Array||typeof c==`string`)&&(s=(n=bu({data:c,signatures:_u}))??s),{type:`file`,mediaType:s??`image/*`,filename:void 0,data:c,providerOptions:e.providerOptions};case`file`:if(s==null)throw Error(`Media type is missing for file part`);return{type:`file`,mediaType:s,filename:e.filename,data:c,providerOptions:e.providerOptions}}}function ju({maxOutputTokens:e,temperature:t,topP:n,topK:r,presencePenalty:i,frequencyPenalty:a,seed:o,stopSequences:s}){if(e!=null){if(!Number.isInteger(e))throw new sl({parameter:`maxOutputTokens`,value:e,message:`maxOutputTokens must be an integer`});if(e<1)throw new sl({parameter:`maxOutputTokens`,value:e,message:`maxOutputTokens must be >= 1`})}if(t!=null&&typeof t!=`number`)throw new sl({parameter:`temperature`,value:t,message:`temperature must be a number`});if(n!=null&&typeof n!=`number`)throw new sl({parameter:`topP`,value:n,message:`topP must be a number`});if(r!=null&&typeof r!=`number`)throw new sl({parameter:`topK`,value:r,message:`topK must be a number`});if(i!=null&&typeof i!=`number`)throw new sl({parameter:`presencePenalty`,value:i,message:`presencePenalty must be a number`});if(a!=null&&typeof a!=`number`)throw new sl({parameter:`frequencyPenalty`,value:a,message:`frequencyPenalty must be a number`});if(o!=null&&!Number.isInteger(o))throw new sl({parameter:`seed`,value:o,message:`seed must be an integer`});return{maxOutputTokens:e,temperature:t,topP:n,topK:r,presencePenalty:i,frequencyPenalty:a,stopSequences:s,seed:o}}function Mu(e){return e!=null&&Object.keys(e).length>0}function Nu({tools:e,toolChoice:t,activeTools:n}){if(!Mu(e))return{tools:void 0,toolChoice:void 0};let r=n==null?Object.entries(e):Object.entries(e).filter(([e])=>n.includes(e));return{tools:r.map(([e,t])=>{let n=t.type;switch(n){case void 0:case`dynamic`:case`function`:return{type:`function`,name:e,description:t.description,inputSchema:Mn(t.inputSchema).jsonSchema,providerOptions:t.providerOptions};case`provider-defined`:return{type:`provider-defined`,name:e,id:t.id,args:t.args};default:{let e=n;throw Error(`Unsupported tool type: ${e}`)}}}),toolChoice:t==null?{type:`auto`}:typeof t==`string`?{type:t}:{type:`tool`,toolName:t.toolName}}}var Pu=a.lazy(()=>a.union([a.null(),a.string(),a.number(),a.boolean(),a.record(a.string(),Pu),a.array(Pu)])),$=a.record(a.string(),a.record(a.string(),Pu)),Fu=a.object({type:a.literal(`text`),text:a.string(),providerOptions:$.optional()}),Iu=a.object({type:a.literal(`image`),image:a.union([wu,a.instanceof(URL)]),mediaType:a.string().optional(),providerOptions:$.optional()}),Lu=a.object({type:a.literal(`file`),data:a.union([wu,a.instanceof(URL)]),filename:a.string().optional(),mediaType:a.string(),providerOptions:$.optional()}),Ru=a.object({type:a.literal(`reasoning`),text:a.string(),providerOptions:$.optional()}),zu=a.object({type:a.literal(`tool-call`),toolCallId:a.string(),toolName:a.string(),input:a.unknown(),providerOptions:$.optional(),providerExecuted:a.boolean().optional()}),Bu=a.discriminatedUnion(`type`,[a.object({type:a.literal(`text`),value:a.string()}),a.object({type:a.literal(`json`),value:Pu}),a.object({type:a.literal(`error-text`),value:a.string()}),a.object({type:a.literal(`error-json`),value:Pu}),a.object({type:a.literal(`content`),value:a.array(a.union([a.object({type:a.literal(`text`),text:a.string()}),a.object({type:a.literal(`media`),data:a.string(),mediaType:a.string()})]))})]),Vu=a.object({type:a.literal(`tool-result`),toolCallId:a.string(),toolName:a.string(),output:Bu,providerOptions:$.optional()}),Hu=a.object({role:a.literal(`system`),content:a.string(),providerOptions:$.optional()}),Uu=a.object({role:a.literal(`user`),content:a.union([a.string(),a.array(a.union([Fu,Iu,Lu]))]),providerOptions:$.optional()}),Wu=a.object({role:a.literal(`assistant`),content:a.union([a.string(),a.array(a.union([Fu,Lu,Ru,zu,Vu]))]),providerOptions:$.optional()}),Gu=a.object({role:a.literal(`tool`),content:a.array(Vu),providerOptions:$.optional()}),Ku=a.union([Hu,Uu,Wu,Gu]);async function qu(e){if(e.prompt==null&&e.messages==null)throw new A({prompt:e,message:`prompt or messages must be defined`});if(e.prompt!=null&&e.messages!=null)throw new A({prompt:e,message:`prompt and messages cannot be defined at the same time`});if(e.system!=null&&typeof e.system!=`string`)throw new A({prompt:e,message:`system must be a string`});let t;if(e.prompt!=null&&typeof e.prompt==`string`)t=[{role:`user`,content:e.prompt}];else if(e.prompt!=null&&Array.isArray(e.prompt))t=e.prompt;else if(e.messages!=null)t=e.messages;else throw new A({prompt:e,message:`prompt or messages must be defined`});if(t.length===0)throw new A({prompt:e,message:`messages must not be empty`});let n=await mt({value:t,schema:a.array(Ku)});if(!n.success)throw new A({prompt:e,message:`The messages must be a ModelMessage[]. If you have passed a UIMessage[], you can use convertToModelMessages to convert them.`,cause:n.error});return{messages:t,system:e.system}}function Ju(e){return ki.isInstance(e)||Ji.isInstance(e)?new d({name:`GatewayError`,message:`Vercel AI Gateway access failed. If you want to use AI SDK providers directly, use the providers, e.g. @ai-sdk/openai, or register a different global default provider.`,cause:e}):e}function Yu({operationId:e,telemetry:t}){return{"operation.name":`${e}${t?.functionId==null?``:` ${t.functionId}`}`,"resource.name":t?.functionId,"ai.operationId":e,"ai.telemetry.functionId":t?.functionId}}function Xu({model:e,settings:t,telemetry:n,headers:r}){var i;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((e,[t,n])=>(e[`ai.settings.${t}`]=n,e),{}),...Object.entries((i=n?.metadata)??{}).reduce((e,[t,n])=>(e[`ai.telemetry.metadata.${t}`]=n,e),{}),...Object.entries(r??{}).reduce((e,[t,n])=>(n!==void 0&&(e[`ai.request.headers.${t}`]=n),e),{})}}var Zu={startSpan(){return Qu},startActiveSpan(e,t,n,r){if(typeof t==`function`)return t(Qu);if(typeof n==`function`)return n(Qu);if(typeof r==`function`)return r(Qu)}},Qu={spanContext(){return $u},setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording(){return!1},recordException(){return this}},$u={traceId:``,spanId:``,traceFlags:0};function ed({isEnabled:e=!1,tracer:t}={}){return e?t||Vc.getTracer(`ai`):Zu}function td({name:e,tracer:t,attributes:n,fn:r,endWhenDone:i=!0}){return t.startActiveSpan(e,{attributes:n},async e=>{try{let t=await r(e);return i&&e.end(),t}catch(t){try{nd(e,t)}finally{e.end()}throw t}})}function nd(e,t){t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:qs.ERROR,message:t.message})):e.setStatus({code:qs.ERROR})}function rd({telemetry:e,attributes:t}){return e?.isEnabled===!0?Object.entries(t).reduce((t,[n,r])=>{if(r==null)return t;if(typeof r==`object`&&`input`in r&&typeof r.input==`function`){if(e?.recordInputs===!1)return t;let i=r.input();return i==null?t:{...t,[n]:i}}if(typeof r==`object`&&`output`in r&&typeof r.output==`function`){if(e?.recordOutputs===!1)return t;let i=r.output();return i==null?t:{...t,[n]:i}}return{...t,[n]:r}},{}):{}}function id(e){return JSON.stringify(e.map(e=>({...e,content:typeof e.content==`string`?e.content:e.content.map(e=>e.type===`file`?{...e,data:e.data instanceof Uint8Array?Eu(e.data):e.data}:e)})))}function ad(e,t){return{inputTokens:od(e.inputTokens,t.inputTokens),outputTokens:od(e.outputTokens,t.outputTokens),totalTokens:od(e.totalTokens,t.totalTokens),reasoningTokens:od(e.reasoningTokens,t.reasoningTokens),cachedInputTokens:od(e.cachedInputTokens,t.cachedInputTokens)}}function od(e,t){return e==null&&t==null?void 0:(e??0)+(t??0)}function sd(e){return e===void 0?[]:Array.isArray(e)?e:[e]}function cd({error:e,exponentialBackoffDelay:t}){let n=e.responseHeaders;if(!n)return t;let r,i=n[`retry-after-ms`];if(i){let e=parseFloat(i);Number.isNaN(e)||(r=e)}let a=n[`retry-after`];if(a&&r===void 0){let e=parseFloat(a);r=Number.isNaN(e)?Date.parse(a)-Date.now():e*1e3}return r!=null&&!Number.isNaN(r)&&0<=r&&(r<60*1e3||r<t)?r:t}var ld=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:n=2,abortSignal:r}={})=>async i=>ud(i,{maxRetries:e,delayInMs:t,backoffFactor:n,abortSignal:r});async function ud(e,{maxRetries:t,delayInMs:n,backoffFactor:r,abortSignal:i},a=[]){try{return await e()}catch(o){if(qe(o)||t===0)throw o;let s=Ke(o),c=[...a,o],l=c.length;if(l>t)throw new mu({message:`Failed after ${l} attempts. Last error: ${s}`,reason:`maxRetriesExceeded`,errors:c});if(o instanceof Error&&g.isInstance(o)&&o.isRetryable===!0&&l<=t)return await He(cd({error:o,exponentialBackoffDelay:n}),{abortSignal:i}),ud(e,{maxRetries:t,delayInMs:r*n,backoffFactor:r,abortSignal:i},c);throw l===1?o:new mu({message:`Failed after ${l} attempts with non-retryable error: '${s}'`,reason:`errorNotRetryable`,errors:c})}}function dd({maxRetries:e,abortSignal:t}){if(e!=null){if(!Number.isInteger(e))throw new sl({parameter:`maxRetries`,value:e,message:`maxRetries must be an integer`});if(e<0)throw new sl({parameter:`maxRetries`,value:e,message:`maxRetries must be >= 0`})}let n=e??2;return{maxRetries:n,retry:ld({maxRetries:n,abortSignal:t})}}var fd=class{constructor({data:e,mediaType:t}){let n=e instanceof Uint8Array;this.base64Data=n?void 0:e,this.uint8ArrayData=n?e:void 0,this.mediaType=t}get base64(){return this.base64Data??=In(this.uint8ArrayData),this.base64Data}get uint8Array(){return this.uint8ArrayData??=Fn(this.base64Data),this.uint8ArrayData}},pd=class extends fd{constructor(e){super(e),this.type=`file`}};async function md({toolCall:e,tools:t,repairToolCall:n,system:r,messages:i}){try{if(t==null)throw new zl({toolName:e.toolName});try{return await hd({toolCall:e,tools:t})}catch(a){if(n==null||!(zl.isInstance(a)||gl.isInstance(a)))throw a;let o=null;try{o=await n({toolCall:e,tools:t,inputSchema:({toolName:e})=>{let{inputSchema:n}=t[e];return Mn(n).jsonSchema},system:r,messages:i,error:a})}catch(e){throw new Wl({cause:e,originalError:a})}if(o==null)throw a;return await hd({toolCall:o,tools:t})}}catch(t){let n=await gt({text:e.input}),r=n.success?n.value:e.input;return{type:`tool-call`,toolCallId:e.toolCallId,toolName:e.toolName,input:r,dynamic:!0,invalid:!0,error:t}}}async function hd({toolCall:e,tools:t}){let n=e.toolName,r=t[n];if(r==null)throw new zl({toolName:e.toolName,availableTools:Object.keys(t)});let i=Mn(r.inputSchema),a=e.input.trim()===``?await mt({value:{},schema:i}):await gt({text:e.input,schema:i});if(a.success===!1)throw new gl({toolName:n,toolInput:e.input,cause:a.error});return r.type===`dynamic`?{type:`tool-call`,toolCallId:e.toolCallId,toolName:e.toolName,input:a.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,dynamic:!0}:{type:`tool-call`,toolCallId:e.toolCallId,toolName:n,input:a.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}}var gd=class{constructor({content:e,finishReason:t,usage:n,warnings:r,request:i,response:a,providerMetadata:o}){this.content=e,this.finishReason=t,this.usage=n,this.warnings=r,this.request=i,this.response=a,this.providerMetadata=o}get text(){return this.content.filter(e=>e.type===`text`).map(e=>e.text).join(``)}get reasoning(){return this.content.filter(e=>e.type===`reasoning`)}get reasoningText(){return this.reasoning.length===0?void 0:this.reasoning.map(e=>e.text).join(``)}get files(){return this.content.filter(e=>e.type===`file`).map(e=>e.file)}get sources(){return this.content.filter(e=>e.type===`source`)}get toolCalls(){return this.content.filter(e=>e.type===`tool-call`)}get staticToolCalls(){return this.toolCalls.filter(e=>e.dynamic===!1)}get dynamicToolCalls(){return this.toolCalls.filter(e=>e.dynamic===!0)}get toolResults(){return this.content.filter(e=>e.type===`tool-result`)}get staticToolResults(){return this.toolResults.filter(e=>e.dynamic===!1)}get dynamicToolResults(){return this.toolResults.filter(e=>e.dynamic===!0)}};function _d(e){return({steps:t})=>t.length===e}async function vd({stopConditions:e,steps:t}){return(await Promise.all(e.map(e=>e({steps:t})))).some(e=>e)}function yd({output:e,tool:t,errorMode:n}){return n===`text`?{type:`error-text`,value:S(e)}:n===`json`?{type:`error-json`,value:bd(e)}:t?.toModelOutput?t.toModelOutput(e):typeof e==`string`?{type:`text`,value:e}:{type:`json`,value:bd(e)}}function bd(e){return e===void 0?null:e}function xd({content:e,tools:t}){let n=[],r=e.filter(e=>e.type!==`source`).filter(e=>(e.type!==`tool-result`||e.providerExecuted)&&(e.type!==`tool-error`||e.providerExecuted)).filter(e=>e.type!==`text`||e.text.length>0).map(e=>{switch(e.type){case`text`:return{type:`text`,text:e.text,providerOptions:e.providerMetadata};case`reasoning`:return{type:`reasoning`,text:e.text,providerOptions:e.providerMetadata};case`file`:return{type:`file`,data:e.file.base64,mediaType:e.file.mediaType,providerOptions:e.providerMetadata};case`tool-call`:return{type:`tool-call`,toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,providerExecuted:e.providerExecuted,providerOptions:e.providerMetadata};case`tool-result`:return{type:`tool-result`,toolCallId:e.toolCallId,toolName:e.toolName,output:yd({tool:t?.[e.toolName],output:e.output,errorMode:`none`}),providerExecuted:!0,providerOptions:e.providerMetadata};case`tool-error`:return{type:`tool-result`,toolCallId:e.toolCallId,toolName:e.toolName,output:yd({tool:t?.[e.toolName],output:e.error,errorMode:`json`}),providerOptions:e.providerMetadata}}});r.length>0&&n.push({role:`assistant`,content:r});let i=e.filter(e=>e.type===`tool-result`||e.type===`tool-error`).filter(e=>!e.providerExecuted).map(e=>({type:`tool-result`,toolCallId:e.toolCallId,toolName:e.toolName,output:yd({tool:t?.[e.toolName],output:e.type===`tool-result`?e.output:e.error,errorMode:e.type===`tool-error`?`text`:`none`})}));return i.length>0&&n.push({role:`tool`,content:i}),n}Ge({prefix:`aitxt`,size:24});function Sd(e,t){let n=new Headers(e??{});for(let[e,r]of Object.entries(t))n.has(e)||n.set(e,r);return n}function Cd({status:e,statusText:t,headers:n,textStream:r}){return new Response(r.pipeThrough(new TextEncoderStream),{status:e??200,statusText:t,headers:Sd(n,{"content-type":`text/plain; charset=utf-8`})})}function wd({response:e,status:t,statusText:n,headers:r,stream:i}){e.writeHead(t??200,n,r);let a=i.getReader(),o=async()=>{try{for(;;){let{done:t,value:n}=await a.read();if(t)break;e.write(n)}}catch(e){throw e}finally{e.end()}};o()}function Td({response:e,status:t,statusText:n,headers:r,textStream:i}){wd({response:e,status:t,statusText:n,headers:Object.fromEntries(Sd(r,{"content-type":`text/plain; charset=utf-8`}).entries()),stream:i.pipeThrough(new TextEncoderStream)})}var Ed=class extends TransformStream{constructor(){super({transform(e,t){t.enqueue(`data: ${JSON.stringify(e)}

`)},flush(e){e.enqueue(`data: [DONE]

`)}})}},Dd={"content-type":`text/event-stream`,"cache-control":`no-cache`,connection:`keep-alive`,"x-vercel-ai-ui-message-stream":`v1`,"x-accel-buffering":`no`};function Od({status:e,statusText:t,headers:n,stream:r,consumeSseStream:i}){let a=r.pipeThrough(new Ed);if(i){let[e,t]=a.tee();a=e,i({stream:t})}return new Response(a.pipeThrough(new TextEncoderStream),{status:e,statusText:t,headers:Sd(n,Dd)})}function kd({originalMessages:e,responseMessageId:t}){if(e==null)return;let n=e[e.length-1];return n?.role===`assistant`?n.id:typeof t==`function`?t():t}a.union([a.strictObject({type:a.literal(`text-start`),id:a.string(),providerMetadata:$.optional()}),a.strictObject({type:a.literal(`text-delta`),id:a.string(),delta:a.string(),providerMetadata:$.optional()}),a.strictObject({type:a.literal(`text-end`),id:a.string(),providerMetadata:$.optional()}),a.strictObject({type:a.literal(`error`),errorText:a.string()}),a.strictObject({type:a.literal(`tool-input-start`),toolCallId:a.string(),toolName:a.string(),providerExecuted:a.boolean().optional(),dynamic:a.boolean().optional()}),a.strictObject({type:a.literal(`tool-input-delta`),toolCallId:a.string(),inputTextDelta:a.string()}),a.strictObject({type:a.literal(`tool-input-available`),toolCallId:a.string(),toolName:a.string(),input:a.unknown(),providerExecuted:a.boolean().optional(),providerMetadata:$.optional(),dynamic:a.boolean().optional()}),a.strictObject({type:a.literal(`tool-input-error`),toolCallId:a.string(),toolName:a.string(),input:a.unknown(),providerExecuted:a.boolean().optional(),providerMetadata:$.optional(),dynamic:a.boolean().optional(),errorText:a.string()}),a.strictObject({type:a.literal(`tool-output-available`),toolCallId:a.string(),output:a.unknown(),providerExecuted:a.boolean().optional(),dynamic:a.boolean().optional(),preliminary:a.boolean().optional()}),a.strictObject({type:a.literal(`tool-output-error`),toolCallId:a.string(),errorText:a.string(),providerExecuted:a.boolean().optional(),dynamic:a.boolean().optional()}),a.strictObject({type:a.literal(`reasoning`),text:a.string(),providerMetadata:$.optional()}),a.strictObject({type:a.literal(`reasoning-start`),id:a.string(),providerMetadata:$.optional()}),a.strictObject({type:a.literal(`reasoning-delta`),id:a.string(),delta:a.string(),providerMetadata:$.optional()}),a.strictObject({type:a.literal(`reasoning-end`),id:a.string(),providerMetadata:$.optional()}),a.strictObject({type:a.literal(`reasoning-part-finish`)}),a.strictObject({type:a.literal(`source-url`),sourceId:a.string(),url:a.string(),title:a.string().optional(),providerMetadata:$.optional()}),a.strictObject({type:a.literal(`source-document`),sourceId:a.string(),mediaType:a.string(),title:a.string(),filename:a.string().optional(),providerMetadata:$.optional()}),a.strictObject({type:a.literal(`file`),url:a.string(),mediaType:a.string(),providerMetadata:$.optional()}),a.strictObject({type:a.string().startsWith(`data-`),id:a.string().optional(),data:a.unknown(),transient:a.boolean().optional()}),a.strictObject({type:a.literal(`start-step`)}),a.strictObject({type:a.literal(`finish-step`)}),a.strictObject({type:a.literal(`start`),messageId:a.string().optional(),messageMetadata:a.unknown().optional()}),a.strictObject({type:a.literal(`finish`),messageMetadata:a.unknown().optional()}),a.strictObject({type:a.literal(`abort`)}),a.strictObject({type:a.literal(`message-metadata`),messageMetadata:a.unknown()})]);function Ad(e){return e.type.startsWith(`data-`)}function jd(e,t){if(e===void 0&&t===void 0)return;if(e===void 0)return t;if(t===void 0)return e;let n={...e};for(let r in t)if(Object.prototype.hasOwnProperty.call(t,r)){let i=t[r];if(i===void 0)continue;let a=r in e?e[r]:void 0,o=typeof i==`object`&&!!i&&!Array.isArray(i)&&!(i instanceof Date)&&!(i instanceof RegExp),s=typeof a==`object`&&!!a&&!Array.isArray(a)&&!(a instanceof Date)&&!(a instanceof RegExp);o&&s?n[r]=jd(a,i):n[r]=i}return n}function Md(e){let t=[`ROOT`],n=-1,r=null;function i(e,i,a){switch(e){case`"`:n=i,t.pop(),t.push(a),t.push(`INSIDE_STRING`);break;case`f`:case`t`:case`n`:n=i,r=i,t.pop(),t.push(a),t.push(`INSIDE_LITERAL`);break;case`-`:t.pop(),t.push(a),t.push(`INSIDE_NUMBER`);break;case`0`:case`1`:case`2`:case`3`:case`4`:case`5`:case`6`:case`7`:case`8`:case`9`:n=i,t.pop(),t.push(a),t.push(`INSIDE_NUMBER`);break;case`{`:n=i,t.pop(),t.push(a),t.push(`INSIDE_OBJECT_START`);break;case`[`:n=i,t.pop(),t.push(a),t.push(`INSIDE_ARRAY_START`);break}}function a(e,r){switch(e){case`,`:t.pop(),t.push(`INSIDE_OBJECT_AFTER_COMMA`);break;case`}`:n=r,t.pop();break}}function o(e,r){switch(e){case`,`:t.pop(),t.push(`INSIDE_ARRAY_AFTER_COMMA`);break;case`]`:n=r,t.pop();break}}for(let s=0;s<e.length;s++){let c=e[s],l=t[t.length-1];switch(l){case`ROOT`:i(c,s,`FINISH`);break;case`INSIDE_OBJECT_START`:switch(c){case`"`:t.pop(),t.push(`INSIDE_OBJECT_KEY`);break;case`}`:n=s,t.pop();break}break;case`INSIDE_OBJECT_AFTER_COMMA`:switch(c){case`"`:t.pop(),t.push(`INSIDE_OBJECT_KEY`);break}break;case`INSIDE_OBJECT_KEY`:switch(c){case`"`:t.pop(),t.push(`INSIDE_OBJECT_AFTER_KEY`);break}break;case`INSIDE_OBJECT_AFTER_KEY`:switch(c){case`:`:t.pop(),t.push(`INSIDE_OBJECT_BEFORE_VALUE`);break}break;case`INSIDE_OBJECT_BEFORE_VALUE`:i(c,s,`INSIDE_OBJECT_AFTER_VALUE`);break;case`INSIDE_OBJECT_AFTER_VALUE`:a(c,s);break;case`INSIDE_STRING`:switch(c){case`"`:t.pop(),n=s;break;case`\\`:t.push(`INSIDE_STRING_ESCAPE`);break;default:n=s}break;case`INSIDE_ARRAY_START`:switch(c){case`]`:n=s,t.pop();break;default:n=s,i(c,s,`INSIDE_ARRAY_AFTER_VALUE`);break}break;case`INSIDE_ARRAY_AFTER_VALUE`:switch(c){case`,`:t.pop(),t.push(`INSIDE_ARRAY_AFTER_COMMA`);break;case`]`:n=s,t.pop();break;default:n=s;break}break;case`INSIDE_ARRAY_AFTER_COMMA`:i(c,s,`INSIDE_ARRAY_AFTER_VALUE`);break;case`INSIDE_STRING_ESCAPE`:t.pop(),n=s;break;case`INSIDE_NUMBER`:switch(c){case`0`:case`1`:case`2`:case`3`:case`4`:case`5`:case`6`:case`7`:case`8`:case`9`:n=s;break;case`e`:case`E`:case`-`:case`.`:break;case`,`:t.pop(),t[t.length-1]===`INSIDE_ARRAY_AFTER_VALUE`&&o(c,s),t[t.length-1]===`INSIDE_OBJECT_AFTER_VALUE`&&a(c,s);break;case`}`:t.pop(),t[t.length-1]===`INSIDE_OBJECT_AFTER_VALUE`&&a(c,s);break;case`]`:t.pop(),t[t.length-1]===`INSIDE_ARRAY_AFTER_VALUE`&&o(c,s);break;default:t.pop();break}break;case`INSIDE_LITERAL`:{let i=e.substring(r,s+1);!`false`.startsWith(i)&&!`true`.startsWith(i)&&!`null`.startsWith(i)?(t.pop(),t[t.length-1]===`INSIDE_OBJECT_AFTER_VALUE`?a(c,s):t[t.length-1]===`INSIDE_ARRAY_AFTER_VALUE`&&o(c,s)):n=s;break}}}let s=e.slice(0,n+1);for(let n=t.length-1;n>=0;n--){let i=t[n];switch(i){case`INSIDE_STRING`:s+=`"`;break;case`INSIDE_OBJECT_KEY`:case`INSIDE_OBJECT_AFTER_KEY`:case`INSIDE_OBJECT_AFTER_COMMA`:case`INSIDE_OBJECT_START`:case`INSIDE_OBJECT_BEFORE_VALUE`:case`INSIDE_OBJECT_AFTER_VALUE`:s+=`}`;break;case`INSIDE_ARRAY_START`:case`INSIDE_ARRAY_AFTER_COMMA`:case`INSIDE_ARRAY_AFTER_VALUE`:s+=`]`;break;case`INSIDE_LITERAL`:{let t=e.substring(r,e.length);`true`.startsWith(t)?s+=`true`.slice(t.length):`false`.startsWith(t)?s+=`false`.slice(t.length):`null`.startsWith(t)&&(s+=`null`.slice(t.length))}}}return s}async function Nd(e){if(e===void 0)return{value:void 0,state:`undefined-input`};let t=await gt({text:e});return t.success?{value:t.value,state:`successful-parse`}:(t=await gt({text:Md(e)}),t.success?{value:t.value,state:`repaired-parse`}:{value:void 0,state:`failed-parse`})}function Pd(e){return e.type.startsWith(`tool-`)}function Fd(e){return e.type===`dynamic-tool`}function Id(e){return Pd(e)||Fd(e)}function Ld(e){return e.type.split(`-`).slice(1).join(`-`)}function Rd(e){return Fd(e)?e.toolName:Ld(e)}function zd({lastMessage:e,messageId:t}){return{message:e?.role===`assistant`?e:{id:t,metadata:void 0,role:`assistant`,parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}function Bd({stream:e,messageMetadataSchema:t,dataPartSchemas:n,runUpdateMessageJob:r,onError:i,onToolCall:a,onData:o}){return e.pipeThrough(new TransformStream({async transform(e,s){await r(async({state:r,write:c})=>{var l,u,d,f;function p(e){let t=r.message.parts.filter(Pd),n=t.find(t=>t.toolCallId===e);if(n==null)throw Error(`tool-output-error must be preceded by a tool-input-available`);return n}function m(e){let t=r.message.parts.filter(e=>e.type===`dynamic-tool`),n=t.find(t=>t.toolCallId===e);if(n==null)throw Error(`tool-output-error must be preceded by a tool-input-available`);return n}function h(e){var t;let n=r.message.parts.find(t=>Pd(t)&&t.toolCallId===e.toolCallId),i=e,a=n;n==null?r.message.parts.push({type:`tool-${e.toolName}`,toolCallId:e.toolCallId,state:e.state,input:i.input,output:i.output,rawInput:i.rawInput,errorText:i.errorText,providerExecuted:i.providerExecuted,preliminary:i.preliminary,...i.providerMetadata==null?{}:{callProviderMetadata:i.providerMetadata}}):(n.state=e.state,a.input=i.input,a.output=i.output,a.errorText=i.errorText,a.rawInput=i.rawInput,a.preliminary=i.preliminary,a.providerExecuted=(t=i.providerExecuted)??n.providerExecuted,i.providerMetadata!=null&&n.state===`input-available`&&(n.callProviderMetadata=i.providerMetadata))}function g(e){var t;let n=r.message.parts.find(t=>t.type===`dynamic-tool`&&t.toolCallId===e.toolCallId),i=e,a=n;n==null?r.message.parts.push({type:`dynamic-tool`,toolName:e.toolName,toolCallId:e.toolCallId,state:e.state,input:i.input,output:i.output,errorText:i.errorText,preliminary:i.preliminary,...i.providerMetadata==null?{}:{callProviderMetadata:i.providerMetadata}}):(n.state=e.state,a.toolName=e.toolName,a.input=i.input,a.output=i.output,a.errorText=i.errorText,a.rawInput=(t=i.rawInput)??a.rawInput,a.preliminary=i.preliminary,i.providerMetadata!=null&&n.state===`input-available`&&(n.callProviderMetadata=i.providerMetadata))}async function _(e){if(e!=null){let n=r.message.metadata==null?e:jd(r.message.metadata,e);t!=null&&await pt({value:n,schema:t}),r.message.metadata=n}}switch(e.type){case`text-start`:{let t={type:`text`,text:``,providerMetadata:e.providerMetadata,state:`streaming`};r.activeTextParts[e.id]=t,r.message.parts.push(t),c();break}case`text-delta`:{let t=r.activeTextParts[e.id];t.text+=e.delta,t.providerMetadata=(l=e.providerMetadata)??t.providerMetadata,c();break}case`text-end`:{let t=r.activeTextParts[e.id];t.state=`done`,t.providerMetadata=(u=e.providerMetadata)??t.providerMetadata,delete r.activeTextParts[e.id],c();break}case`reasoning-start`:{let t={type:`reasoning`,text:``,providerMetadata:e.providerMetadata,state:`streaming`};r.activeReasoningParts[e.id]=t,r.message.parts.push(t),c();break}case`reasoning-delta`:{let t=r.activeReasoningParts[e.id];t.text+=e.delta,t.providerMetadata=(d=e.providerMetadata)??t.providerMetadata,c();break}case`reasoning-end`:{let t=r.activeReasoningParts[e.id];t.providerMetadata=(f=e.providerMetadata)??t.providerMetadata,t.state=`done`,delete r.activeReasoningParts[e.id],c();break}case`file`:r.message.parts.push({type:`file`,mediaType:e.mediaType,url:e.url}),c();break;case`source-url`:r.message.parts.push({type:`source-url`,sourceId:e.sourceId,url:e.url,title:e.title,providerMetadata:e.providerMetadata}),c();break;case`source-document`:r.message.parts.push({type:`source-document`,sourceId:e.sourceId,mediaType:e.mediaType,title:e.title,filename:e.filename,providerMetadata:e.providerMetadata}),c();break;case`tool-input-start`:{let t=r.message.parts.filter(Pd);r.partialToolCalls[e.toolCallId]={text:``,toolName:e.toolName,index:t.length,dynamic:e.dynamic},e.dynamic?g({toolCallId:e.toolCallId,toolName:e.toolName,state:`input-streaming`,input:void 0}):h({toolCallId:e.toolCallId,toolName:e.toolName,state:`input-streaming`,input:void 0,providerExecuted:e.providerExecuted}),c();break}case`tool-input-delta`:{let t=r.partialToolCalls[e.toolCallId];t.text+=e.inputTextDelta;let{value:n}=await Nd(t.text);t.dynamic?g({toolCallId:e.toolCallId,toolName:t.toolName,state:`input-streaming`,input:n}):h({toolCallId:e.toolCallId,toolName:t.toolName,state:`input-streaming`,input:n}),c();break}case`tool-input-available`:e.dynamic?g({toolCallId:e.toolCallId,toolName:e.toolName,state:`input-available`,input:e.input,providerMetadata:e.providerMetadata}):h({toolCallId:e.toolCallId,toolName:e.toolName,state:`input-available`,input:e.input,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}),c(),a&&!e.providerExecuted&&await a({toolCall:e});break;case`tool-input-error`:e.dynamic?g({toolCallId:e.toolCallId,toolName:e.toolName,state:`output-error`,input:e.input,errorText:e.errorText,providerMetadata:e.providerMetadata}):h({toolCallId:e.toolCallId,toolName:e.toolName,state:`output-error`,input:void 0,rawInput:e.input,errorText:e.errorText,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}),c();break;case`tool-output-available`:if(e.dynamic){let t=m(e.toolCallId);g({toolCallId:e.toolCallId,toolName:t.toolName,state:`output-available`,input:t.input,output:e.output,preliminary:e.preliminary})}else{let t=p(e.toolCallId);h({toolCallId:e.toolCallId,toolName:Ld(t),state:`output-available`,input:t.input,output:e.output,providerExecuted:e.providerExecuted,preliminary:e.preliminary})}c();break;case`tool-output-error`:if(e.dynamic){let t=m(e.toolCallId);g({toolCallId:e.toolCallId,toolName:t.toolName,state:`output-error`,input:t.input,errorText:e.errorText})}else{let t=p(e.toolCallId);h({toolCallId:e.toolCallId,toolName:Ld(t),state:`output-error`,input:t.input,rawInput:t.rawInput,errorText:e.errorText})}c();break;case`start-step`:r.message.parts.push({type:`step-start`});break;case`finish-step`:r.activeTextParts={},r.activeReasoningParts={};break;case`start`:e.messageId!=null&&(r.message.id=e.messageId),await _(e.messageMetadata),(e.messageId!=null||e.messageMetadata!=null)&&c();break;case`finish`:await _(e.messageMetadata),e.messageMetadata!=null&&c();break;case`message-metadata`:await _(e.messageMetadata),e.messageMetadata!=null&&c();break;case`error`:i?.(Error(e.errorText));break;default:if(Ad(e)){n?.[e.type]!=null&&await pt({value:e.data,schema:n[e.type]});let t=e;if(t.transient){o?.(t);break}let i=t.id==null?void 0:r.message.parts.find(e=>t.type===e.type&&t.id===e.id);i==null?r.message.parts.push(t):i.data=t.data,o?.(t),c()}}s.enqueue(e)})}}))}function Vd({messageId:e,originalMessages:t=[],onFinish:n,onError:r,stream:i}){let a=t?.[t.length-1];a?.role===`assistant`?e=a.id:a=void 0;let o=!1,s=i.pipeThrough(new TransformStream({transform(t,n){if(t.type===`start`){let n=t;n.messageId==null&&e!=null&&(n.messageId=e)}t.type===`abort`&&(o=!0),n.enqueue(t)}}));if(n==null)return s;let c=zd({lastMessage:a?structuredClone(a):void 0,messageId:e??``}),l=async e=>{await e({state:c,write:()=>{}})},u=!1,d=async()=>{if(u||!n)return;u=!0;let e=c.message.id===a?.id;await n({isAborted:o,isContinuation:e,responseMessage:c.message,messages:[...e?t.slice(0,-1):t,c.message]})};return Bd({stream:s,runUpdateMessageJob:l,onError:r}).pipeThrough(new TransformStream({transform(e,t){t.enqueue(e)},async cancel(){await d()},async flush(){await d()}}))}function Hd({response:e,status:t,statusText:n,headers:r,stream:i,consumeSseStream:a}){let o=i.pipeThrough(new Ed);if(a){let[e,t]=o.tee();o=e,a({stream:t})}wd({response:e,status:t,statusText:n,headers:Object.fromEntries(Sd(r,Dd).entries()),stream:o.pipeThrough(new TextEncoderStream)})}function Ud(e){let t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=function(){let e=this.getReader(),t=!1;async function n(n){var r;t=!0;try{n&&await(r=e.cancel)?.call(e)}finally{try{e.releaseLock()}catch{}}}return{async next(){if(t)return{done:!0,value:void 0};let{done:r,value:i}=await e.read();return r?(await n(!0),{done:!0,value:void 0}):{done:!1,value:i}},async return(){return await n(!0),{done:!0,value:void 0}},async throw(e){throw await n(!0),e}}},t}async function Wd({stream:e,onError:t}){let n=e.getReader();try{for(;;){let{done:e}=await n.read();if(e)break}}catch(e){t?.(e)}finally{n.releaseLock()}}function Gd(){let e,t,n=new Promise((n,r)=>{e=n,t=r});return{promise:n,resolve:e,reject:t}}function Kd(){let e=[],t=null,n=!1,r=Gd(),i=()=>{n=!0,r.resolve(),e.forEach(e=>e.cancel()),e=[],t?.close()},a=async()=>{if(n&&e.length===0){t?.close();return}if(e.length===0)return r=Gd(),await r.promise,a();try{let{value:r,done:i}=await e[0].read();i?(e.shift(),e.length>0?await a():n&&t?.close()):t?.enqueue(r)}catch(n){t?.error(n),e.shift(),i()}};return{stream:new ReadableStream({start(e){t=e},pull:a,async cancel(){for(let t of e)await t.cancel();e=[],n=!0}}),addStream:t=>{if(n)throw Error(`Cannot add inner stream: outer stream is closed`);e.push(t.getReader()),r.resolve()},close:()=>{n=!0,r.resolve(),e.length===0&&t?.close()},terminate:i}}var qd=class{constructor(){this.status={type:`pending`},this._resolve=void 0,this._reject=void 0}get promise(){return this._promise||=new Promise((e,t)=>{this.status.type===`resolved`?e(this.status.value):this.status.type===`rejected`&&t(this.status.error),this._resolve=e,this._reject=t}),this._promise}resolve(e){var t;this.status={type:`resolved`,value:e},this._promise&&((t=this._resolve)==null||t.call(this,e))}reject(e){var t;this.status={type:`rejected`,error:e},this._promise&&((t=this._reject)==null||t.call(this,e))}};function Jd(){var e,t;return(t=(e=globalThis==null?void 0:globalThis.performance)?.now())??Date.now()}function Yd({tools:e,generatorStream:t,tracer:n,telemetry:r,system:i,messages:a,abortSignal:o,repairToolCall:s,experimental_context:c}){let l=null,u=new ReadableStream({start(e){l=e}}),d=new Set,f=new Map,p=!1,m;function h(){p&&d.size===0&&(m!=null&&l.enqueue(m),l.close())}let g=new TransformStream({async transform(t,u){let p=t.type;switch(p){case`stream-start`:case`text-start`:case`text-delta`:case`text-end`:case`reasoning-start`:case`reasoning-delta`:case`reasoning-end`:case`tool-input-start`:case`tool-input-delta`:case`tool-input-end`:case`source`:case`response-metadata`:case`error`:case`raw`:u.enqueue(t);break;case`file`:u.enqueue({type:`file`,file:new pd({data:t.data,mediaType:t.mediaType})});break;case`finish`:m={type:`finish`,finishReason:t.finishReason,usage:t.usage,providerMetadata:t.providerMetadata};break;case`tool-call`:try{let p=await md({toolCall:t,tools:e,repairToolCall:s,system:i,messages:a});if(u.enqueue(p),p.invalid){l.enqueue({type:`tool-error`,toolCallId:p.toolCallId,toolName:p.toolName,input:p.input,error:Ke(p.error),dynamic:!0});break}let m=e[p.toolName];if(f.set(p.toolCallId,p.input),m.onInputAvailable!=null&&await m.onInputAvailable({input:p.input,toolCallId:p.toolCallId,messages:a,abortSignal:o,experimental_context:c}),m.execute!=null&&p.providerExecuted!==!0){let e=V();d.add(e),td({name:`ai.toolCall`,attributes:rd({telemetry:r,attributes:{...Yu({operationId:`ai.toolCall`,telemetry:r}),"ai.toolCall.name":p.toolName,"ai.toolCall.id":p.toolCallId,"ai.toolCall.args":{output:()=>JSON.stringify(p.input)}}}),tracer:n,fn:async t=>{let n;try{let e=Bn({execute:m.execute.bind(m),input:p.input,options:{toolCallId:p.toolCallId,messages:a,abortSignal:o,experimental_context:c}});for await(let t of e)l.enqueue({...p,type:`tool-result`,output:t.output,...t.type===`preliminary`&&{preliminary:!0}}),t.type===`final`&&(n=t.output)}catch(n){nd(t,n),l.enqueue({...p,type:`tool-error`,error:n}),d.delete(e),h();return}d.delete(e),h();try{t.setAttributes(rd({telemetry:r,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(n)}}}))}catch{}}})}}catch(e){l.enqueue({type:`error`,error:e})}break;case`tool-result`:{let e=t.toolName;t.isError?l.enqueue({type:`tool-error`,toolCallId:t.toolCallId,toolName:e,input:f.get(t.toolCallId),providerExecuted:t.providerExecuted,error:t.result}):u.enqueue({type:`tool-result`,toolCallId:t.toolCallId,toolName:e,input:f.get(t.toolCallId),output:t.result,providerExecuted:t.providerExecuted});break}default:{let e=p;throw Error(`Unhandled chunk type: ${e}`)}}},flush(){p=!0,h()}});return new ReadableStream({async start(e){return Promise.all([t.pipeThrough(g).pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){}})),u.pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){e.close()}}))])}})}var Xd=Ge({prefix:`aitxt`,size:24});function Zd({model:e,tools:t,toolChoice:n,system:r,prompt:i,messages:a,maxRetries:o,abortSignal:s,headers:c,stopWhen:l=_d(1),experimental_output:u,experimental_telemetry:d,prepareStep:f,providerOptions:p,experimental_activeTools:m,activeTools:h=m,experimental_repairToolCall:g,experimental_transform:_,experimental_download:v,includeRawChunks:y=!1,onChunk:b,onError:x=({error:e})=>{console.error(e)},onFinish:S,onAbort:C,onStepFinish:w,experimental_context:T,_internal:{now:E=Jd,generateId:D=Xd,currentDate:O=()=>new Date}={},...ee}){return new $d({model:hu(e),telemetry:d,headers:c,settings:ee,maxRetries:o,abortSignal:s,system:r,prompt:i,messages:a,tools:t,toolChoice:n,transforms:sd(_),activeTools:h,repairToolCall:g,stopConditions:sd(l),output:u,providerOptions:p,prepareStep:f,includeRawChunks:y,onChunk:b,onError:x,onFinish:S,onAbort:C,onStepFinish:w,now:E,currentDate:O,generateId:D,experimental_context:T,download:v})}function Qd(e){if(!e)return new TransformStream({transform(e,t){t.enqueue({part:e,partialOutput:void 0})}});let t,n=``,r=``,i=``;function a({controller:e,partialOutput:n=void 0}){e.enqueue({part:{type:`text-delta`,id:t,text:r},partialOutput:n}),r=``}return new TransformStream({async transform(o,s){if(o.type===`finish-step`&&r.length>0&&a({controller:s}),o.type!==`text-delta`&&o.type!==`text-start`&&o.type!==`text-end`){s.enqueue({part:o,partialOutput:void 0});return}if(t==null)t=o.id;else if(o.id!==t){s.enqueue({part:o,partialOutput:void 0});return}if(o.type===`text-start`){s.enqueue({part:o,partialOutput:void 0});return}if(o.type===`text-end`){r.length>0&&a({controller:s}),s.enqueue({part:o,partialOutput:void 0});return}n+=o.text,r+=o.text;let c=await e.parsePartial({text:n});if(c!=null){let e=JSON.stringify(c.partial);e!==i&&(a({controller:s,partialOutput:c.partial}),i=e)}}})}var $d=class{constructor({model:e,telemetry:t,headers:n,settings:r,maxRetries:i,abortSignal:a,system:o,prompt:s,messages:c,tools:l,toolChoice:u,transforms:d,activeTools:f,repairToolCall:p,stopConditions:m,output:h,providerOptions:g,prepareStep:_,includeRawChunks:v,now:y,currentDate:b,generateId:x,onChunk:S,onError:C,onFinish:w,onAbort:T,onStepFinish:E,experimental_context:D,download:O}){this._totalUsage=new qd,this._finishReason=new qd,this._steps=new qd,this.output=h,this.includeRawChunks=v,this.tools=l;let ee,k=[],te=[],A,j,M={},N=[],P=[],ne,re={},ie={},ae=new TransformStream({async transform(e,t){var n,r,i;t.enqueue(e);let{part:a}=e;if((a.type===`text-delta`||a.type===`reasoning-delta`||a.type===`source`||a.type===`tool-call`||a.type===`tool-result`||a.type===`tool-input-start`||a.type===`tool-input-delta`||a.type===`raw`)&&await S?.({chunk:a}),a.type===`error`&&await C({error:Ju(a.error)}),a.type===`text-start`&&(re[a.id]={type:`text`,text:``,providerMetadata:a.providerMetadata},k.push(re[a.id])),a.type===`text-delta`){let e=re[a.id];if(e==null){t.enqueue({part:{type:`error`,error:`text part ${a.id} not found`},partialOutput:void 0});return}e.text+=a.text,e.providerMetadata=(n=a.providerMetadata)??e.providerMetadata}if(a.type===`text-end`&&delete re[a.id],a.type===`reasoning-start`&&(ie[a.id]={type:`reasoning`,text:``,providerMetadata:a.providerMetadata},k.push(ie[a.id])),a.type===`reasoning-delta`){let e=ie[a.id];if(e==null){t.enqueue({part:{type:`error`,error:`reasoning part ${a.id} not found`},partialOutput:void 0});return}e.text+=a.text,e.providerMetadata=(r=a.providerMetadata)??e.providerMetadata}if(a.type===`reasoning-end`){let e=ie[a.id];if(e==null){t.enqueue({part:{type:`error`,error:`reasoning part ${a.id} not found`},partialOutput:void 0});return}e.providerMetadata=(i=a.providerMetadata)??e.providerMetadata,delete ie[a.id]}if(a.type===`file`&&k.push({type:`file`,file:a.file}),a.type===`source`&&k.push(a),a.type===`tool-call`&&k.push(a),a.type===`tool-result`&&!a.preliminary&&k.push(a),a.type===`tool-error`&&k.push(a),a.type===`start-step`&&(M=a.request,N=a.warnings),a.type===`finish-step`){let e=xd({content:k,tools:l}),t=new gd({content:k,finishReason:a.finishReason,usage:a.usage,warnings:N,request:M,response:{...a.response,messages:[...te,...e]},providerMetadata:a.providerMetadata});await E?.(t),nl(N),P.push(t),k=[],ie={},re={},te.push(...e),ee.resolve()}a.type===`finish`&&(j=a.totalUsage,A=a.finishReason)},async flush(e){try{if(P.length===0){let e=new Pl({message:`No output generated. Check the stream for errors.`});I._finishReason.reject(e),I._totalUsage.reject(e),I._steps.reject(e);return}let e=A??`unknown`,n=j??{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};I._finishReason.resolve(e),I._totalUsage.resolve(n),I._steps.resolve(P);let r=P[P.length-1];await w?.({finishReason:e,totalUsage:n,usage:r.usage,content:r.content,text:r.text,reasoningText:r.reasoningText,reasoning:r.reasoning,files:r.files,sources:r.sources,toolCalls:r.toolCalls,staticToolCalls:r.staticToolCalls,dynamicToolCalls:r.dynamicToolCalls,toolResults:r.toolResults,staticToolResults:r.staticToolResults,dynamicToolResults:r.dynamicToolResults,request:r.request,response:r.response,warnings:r.warnings,providerMetadata:r.providerMetadata,steps:P}),ne.setAttributes(rd({telemetry:t,attributes:{"ai.response.finishReason":e,"ai.response.text":{output:()=>r.text},"ai.response.toolCalls":{output:()=>{var e;return(e=r.toolCalls)?.length?JSON.stringify(r.toolCalls):void 0}},"ai.response.providerMetadata":JSON.stringify(r.providerMetadata),"ai.usage.inputTokens":n.inputTokens,"ai.usage.outputTokens":n.outputTokens,"ai.usage.totalTokens":n.totalTokens,"ai.usage.reasoningTokens":n.reasoningTokens,"ai.usage.cachedInputTokens":n.cachedInputTokens}}))}catch(t){e.error(t)}finally{ne.end()}}}),oe=Kd();this.addStream=oe.addStream,this.closeStream=oe.close;let se=oe.stream.getReader(),ce=new ReadableStream({async start(e){e.enqueue({type:`start`})},async pull(e){function t(){T?.({steps:P}),e.enqueue({type:`abort`}),e.close()}try{let{done:n,value:r}=await se.read();if(n){e.close();return}if(a?.aborted){t();return}e.enqueue(r)}catch(n){qe(n)&&a?.aborted?t():e.error(n)}},cancel(e){return oe.stream.cancel(e)}});for(let e of d)ce=ce.pipeThrough(e({tools:l,stopStream(){oe.terminate()}}));this.baseStream=ce.pipeThrough(Qd(h)).pipeThrough(ae);let{maxRetries:le,retry:ue}=dd({maxRetries:i,abortSignal:a}),de=ed(t),F=ju(r),fe=Xu({model:e,telemetry:t,headers:n,settings:{...F,maxRetries:le}}),I=this;td({name:`ai.streamText`,attributes:rd({telemetry:t,attributes:{...Yu({operationId:`ai.streamText`,telemetry:t}),...fe,"ai.prompt":{input:()=>JSON.stringify({system:o,prompt:s,messages:c})}}}),tracer:de,endWhenDone:!1,fn:async r=>{ne=r;async function i({currentStep:r,responseMessages:d,usage:v}){var S,C,w,T,E;let k=I.includeRawChunks;ee=new qd;let te=await qu({system:o,prompt:s,messages:c}),A=[...te.messages,...d],j=await _?.({model:e,steps:P,stepNumber:P.length,messages:A}),M=await Du({prompt:{system:(S=j?.system)??te.system,messages:(C=j?.messages)??A},supportedUrls:await e.supportedUrls,download:O}),N=hu((w=j?.model)??e),{toolChoice:ne,tools:re}=Nu({tools:l,toolChoice:(T=j?.toolChoice)??u,activeTools:(E=j?.activeTools)??f}),{result:{stream:ie,response:ae,request:oe},doStreamSpan:se,startTimestampMs:ce}=await ue(()=>td({name:`ai.streamText.doStream`,attributes:rd({telemetry:t,attributes:{...Yu({operationId:`ai.streamText.doStream`,telemetry:t}),...fe,"ai.model.provider":N.provider,"ai.model.id":N.modelId,"ai.prompt.messages":{input:()=>id(M)},"ai.prompt.tools":{input:()=>re?.map(e=>JSON.stringify(e))},"ai.prompt.toolChoice":{input:()=>ne==null?void 0:JSON.stringify(ne)},"gen_ai.system":N.provider,"gen_ai.request.model":N.modelId,"gen_ai.request.frequency_penalty":F.frequencyPenalty,"gen_ai.request.max_tokens":F.maxOutputTokens,"gen_ai.request.presence_penalty":F.presencePenalty,"gen_ai.request.stop_sequences":F.stopSequences,"gen_ai.request.temperature":F.temperature,"gen_ai.request.top_k":F.topK,"gen_ai.request.top_p":F.topP}}),tracer:de,endWhenDone:!1,fn:async e=>({startTimestampMs:y(),doStreamSpan:e,result:await N.doStream({...F,tools:re,toolChoice:ne,responseFormat:h?.responseFormat,prompt:M,providerOptions:g,abortSignal:a,headers:n,includeRawChunks:k})})})),le=Yd({tools:l,generatorStream:ie,tracer:de,telemetry:t,system:o,messages:A,repairToolCall:p,abortSignal:a,experimental_context:D}),pe=oe??{},me=[],he=[],ge,_e={},ve=`unknown`,L={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},ye,be=!0,R={id:x(),timestamp:b(),modelId:e.modelId},xe=``;I.addStream(le.pipeThrough(new TransformStream({async transform(e,t){var n,r,i,o;if(e.type===`stream-start`){ge=e.warnings;return}if(be){let e=y()-ce;be=!1,se.addEvent(`ai.stream.firstChunk`,{"ai.response.msToFirstChunk":e}),se.setAttributes({"ai.response.msToFirstChunk":e}),t.enqueue({type:`start-step`,request:pe,warnings:ge??[]})}let s=e.type;switch(s){case`text-start`:case`text-end`:t.enqueue(e);break;case`text-delta`:e.delta.length>0&&(t.enqueue({type:`text-delta`,id:e.id,text:e.delta,providerMetadata:e.providerMetadata}),xe+=e.delta);break;case`reasoning-start`:case`reasoning-end`:t.enqueue(e);break;case`reasoning-delta`:t.enqueue({type:`reasoning-delta`,id:e.id,text:e.delta,providerMetadata:e.providerMetadata});break;case`tool-call`:t.enqueue(e),me.push(e);break;case`tool-result`:t.enqueue(e),e.preliminary||he.push(e);break;case`tool-error`:t.enqueue(e),he.push(e);break;case`response-metadata`:R={id:(n=e.id)??R.id,timestamp:(r=e.timestamp)??R.timestamp,modelId:(i=e.modelId)??R.modelId};break;case`finish`:{L=e.usage,ve=e.finishReason,ye=e.providerMetadata;let t=y()-ce;se.addEvent(`ai.stream.finish`),se.setAttributes({"ai.response.msToFinish":t,"ai.response.avgOutputTokensPerSecond":1e3*((o=L.outputTokens)??0)/t});break}case`file`:t.enqueue(e);break;case`source`:t.enqueue(e);break;case`tool-input-start`:{_e[e.id]=e.toolName;let n=l?.[e.toolName];n?.onInputStart!=null&&await n.onInputStart({toolCallId:e.id,messages:A,abortSignal:a,experimental_context:D}),t.enqueue({...e,dynamic:n?.type===`dynamic`});break}case`tool-input-end`:delete _e[e.id],t.enqueue(e);break;case`tool-input-delta`:{let n=_e[e.id],r=l?.[n];r?.onInputDelta!=null&&await r.onInputDelta({inputTextDelta:e.delta,toolCallId:e.id,messages:A,abortSignal:a,experimental_context:D}),t.enqueue(e);break}case`error`:t.enqueue(e),ve=`error`;break;case`raw`:k&&t.enqueue(e);break;default:{let e=s;throw Error(`Unknown chunk type: ${e}`)}}},async flush(e){let n=me.length>0?JSON.stringify(me):void 0;try{se.setAttributes(rd({telemetry:t,attributes:{"ai.response.finishReason":ve,"ai.response.text":{output:()=>xe},"ai.response.toolCalls":{output:()=>n},"ai.response.id":R.id,"ai.response.model":R.modelId,"ai.response.timestamp":R.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(ye),"ai.usage.inputTokens":L.inputTokens,"ai.usage.outputTokens":L.outputTokens,"ai.usage.totalTokens":L.totalTokens,"ai.usage.reasoningTokens":L.reasoningTokens,"ai.usage.cachedInputTokens":L.cachedInputTokens,"gen_ai.response.finish_reasons":[ve],"gen_ai.response.id":R.id,"gen_ai.response.model":R.modelId,"gen_ai.usage.input_tokens":L.inputTokens,"gen_ai.usage.output_tokens":L.outputTokens}}))}catch{}finally{se.end()}e.enqueue({type:`finish-step`,finishReason:ve,usage:L,providerMetadata:ye,response:{...R,headers:ae?.headers}});let a=ad(v,L);await ee.promise;let o=me.filter(e=>e.providerExecuted!==!0),s=he.filter(e=>e.providerExecuted!==!0);if(o.length>0&&s.length===o.length&&!await vd({stopConditions:m,steps:P})){d.push(...xd({content:P[P.length-1].content,tools:l}));try{await i({currentStep:r+1,responseMessages:d,usage:a})}catch(t){e.enqueue({type:`error`,error:t}),I.closeStream()}}else e.enqueue({type:`finish`,finishReason:ve,totalUsage:a}),I.closeStream()}})))}await i({currentStep:0,responseMessages:[],usage:{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0}})}}).catch(e=>{I.addStream(new ReadableStream({start(t){t.enqueue({type:`error`,error:e}),t.close()}})),I.closeStream()})}get steps(){return this.consumeStream(),this._steps.promise}get finalStep(){return this.steps.then(e=>e[e.length-1])}get content(){return this.finalStep.then(e=>e.content)}get warnings(){return this.finalStep.then(e=>e.warnings)}get providerMetadata(){return this.finalStep.then(e=>e.providerMetadata)}get text(){return this.finalStep.then(e=>e.text)}get reasoningText(){return this.finalStep.then(e=>e.reasoningText)}get reasoning(){return this.finalStep.then(e=>e.reasoning)}get sources(){return this.finalStep.then(e=>e.sources)}get files(){return this.finalStep.then(e=>e.files)}get toolCalls(){return this.finalStep.then(e=>e.toolCalls)}get staticToolCalls(){return this.finalStep.then(e=>e.staticToolCalls)}get dynamicToolCalls(){return this.finalStep.then(e=>e.dynamicToolCalls)}get toolResults(){return this.finalStep.then(e=>e.toolResults)}get staticToolResults(){return this.finalStep.then(e=>e.staticToolResults)}get dynamicToolResults(){return this.finalStep.then(e=>e.dynamicToolResults)}get usage(){return this.finalStep.then(e=>e.usage)}get request(){return this.finalStep.then(e=>e.request)}get response(){return this.finalStep.then(e=>e.response)}get totalUsage(){return this.consumeStream(),this._totalUsage.promise}get finishReason(){return this.consumeStream(),this._finishReason.promise}teeStream(){let[e,t]=this.baseStream.tee();return this.baseStream=t,e}get textStream(){return Ud(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){e.type===`text-delta`&&t.enqueue(e.text)}})))}get fullStream(){return Ud(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){t.enqueue(e)}})))}async consumeStream(e){var t;try{await Wd({stream:this.fullStream,onError:e?.onError})}catch(n){(t=e?.onError)==null||t.call(e,n)}}get experimental_partialOutputStream(){if(this.output==null)throw new Qc;return Ud(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:e},t){e!=null&&t.enqueue(e)}})))}toUIMessageStream({originalMessages:e,generateMessageId:t,onFinish:n,messageMetadata:r,sendReasoning:i=!0,sendSources:a=!1,sendStart:o=!0,sendFinish:s=!0,onError:c=S}={}){let l=t==null?void 0:kd({originalMessages:e,responseMessageId:t}),u={},d=e=>{var t,n;let r=u[e],i=(n=(t=this.tools)?.[r])?.type===`dynamic`;return i?!0:void 0},f=this.fullStream.pipeThrough(new TransformStream({transform:async(e,t)=>{let n=r?.({part:e}),f=e.type;switch(f){case`text-start`:t.enqueue({type:`text-start`,id:e.id,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}});break;case`text-delta`:t.enqueue({type:`text-delta`,id:e.id,delta:e.text,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}});break;case`text-end`:t.enqueue({type:`text-end`,id:e.id,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}});break;case`reasoning-start`:t.enqueue({type:`reasoning-start`,id:e.id,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}});break;case`reasoning-delta`:i&&t.enqueue({type:`reasoning-delta`,id:e.id,delta:e.text,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}});break;case`reasoning-end`:t.enqueue({type:`reasoning-end`,id:e.id,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}});break;case`file`:t.enqueue({type:`file`,mediaType:e.file.mediaType,url:`data:${e.file.mediaType};base64,${e.file.base64}`});break;case`source`:a&&e.sourceType===`url`&&t.enqueue({type:`source-url`,sourceId:e.id,url:e.url,title:e.title,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}}),a&&e.sourceType===`document`&&t.enqueue({type:`source-document`,sourceId:e.id,mediaType:e.mediaType,title:e.title,filename:e.filename,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}});break;case`tool-input-start`:{u[e.id]=e.toolName;let n=d(e.id);t.enqueue({type:`tool-input-start`,toolCallId:e.id,toolName:e.toolName,...e.providerExecuted==null?{}:{providerExecuted:e.providerExecuted},...n==null?{}:{dynamic:n}});break}case`tool-input-delta`:t.enqueue({type:`tool-input-delta`,toolCallId:e.id,inputTextDelta:e.delta});break;case`tool-call`:{u[e.toolCallId]=e.toolName;let n=d(e.toolCallId);e.invalid?t.enqueue({type:`tool-input-error`,toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,...e.providerExecuted==null?{}:{providerExecuted:e.providerExecuted},...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata},...n==null?{}:{dynamic:n},errorText:c(e.error)}):t.enqueue({type:`tool-input-available`,toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,...e.providerExecuted==null?{}:{providerExecuted:e.providerExecuted},...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata},...n==null?{}:{dynamic:n}});break}case`tool-result`:{let n=d(e.toolCallId);t.enqueue({type:`tool-output-available`,toolCallId:e.toolCallId,output:e.output,...e.providerExecuted==null?{}:{providerExecuted:e.providerExecuted},...e.preliminary==null?{}:{preliminary:e.preliminary},...n==null?{}:{dynamic:n}});break}case`tool-error`:{let n=d(e.toolCallId);t.enqueue({type:`tool-output-error`,toolCallId:e.toolCallId,errorText:c(e.error),...e.providerExecuted==null?{}:{providerExecuted:e.providerExecuted},...n==null?{}:{dynamic:n}});break}case`error`:t.enqueue({type:`error`,errorText:c(e.error)});break;case`start-step`:t.enqueue({type:`start-step`});break;case`finish-step`:t.enqueue({type:`finish-step`});break;case`start`:o&&t.enqueue({type:`start`,...n==null?{}:{messageMetadata:n},...l==null?{}:{messageId:l}});break;case`finish`:s&&t.enqueue({type:`finish`,...n==null?{}:{messageMetadata:n}});break;case`abort`:t.enqueue(e);break;case`tool-input-end`:break;case`raw`:break;default:{let e=f;throw Error(`Unknown chunk type: ${e}`)}}n!=null&&f!==`start`&&f!==`finish`&&t.enqueue({type:`message-metadata`,messageMetadata:n})}}));return Ud(Vd({stream:f,messageId:l??t?.(),originalMessages:e,onFinish:n,onError:c}))}pipeUIMessageStreamToResponse(e,{originalMessages:t,generateMessageId:n,onFinish:r,messageMetadata:i,sendReasoning:a,sendSources:o,sendFinish:s,sendStart:c,onError:l,...u}={}){Hd({response:e,stream:this.toUIMessageStream({originalMessages:t,generateMessageId:n,onFinish:r,messageMetadata:i,sendReasoning:a,sendSources:o,sendFinish:s,sendStart:c,onError:l}),...u})}pipeTextStreamToResponse(e,t){Td({response:e,textStream:this.textStream,...t})}toUIMessageStreamResponse({originalMessages:e,generateMessageId:t,onFinish:n,messageMetadata:r,sendReasoning:i,sendSources:a,sendFinish:o,sendStart:s,onError:c,...l}={}){return Od({stream:this.toUIMessageStream({originalMessages:e,generateMessageId:t,onFinish:n,messageMetadata:r,sendReasoning:i,sendSources:a,sendFinish:o,sendStart:s,onError:c}),...l})}toTextStreamResponse(e){return Cd({textStream:this.textStream,...e})}};Ge({prefix:`aiobj`,size:24}),Ge({prefix:`aiobj`,size:24});var ef={};qc(ef,{object:()=>nf,text:()=>tf});var tf=()=>({type:`text`,responseFormat:{type:`text`},async parsePartial({text:e}){return{partial:e}},async parseOutput({text:e}){return e}}),nf=({schema:e})=>{let t=Mn(e);return{type:`object`,responseFormat:{type:`json`,schema:t.jsonSchema},async parsePartial({text:e}){let t=await Nd(e);switch(t.state){case`failed-parse`:case`undefined-input`:return;case`repaired-parse`:case`successful-parse`:return{partial:t.value};default:{let e=t.state;throw Error(`Unsupported parse state: ${e}`)}}},async parseOutput({text:e},n){let r=await gt({text:e});if(!r.success)throw new kl({message:`No object generated: could not parse the response.`,cause:r.error,text:e,response:n.response,usage:n.usage,finishReason:n.finishReason});let i=await mt({value:r.value,schema:t});if(!i.success)throw new kl({message:`No object generated: response did not match schema.`,cause:i.error,text:e,response:n.response,usage:n.usage,finishReason:n.finishReason});return i.value}}},rf=`AI_NoSuchProviderError`,af=`vercel.ai.error.${rf}`,sf=Symbol.for(af),cf;cf=sf;var lf=a.looseObject({name:a.string(),version:a.string()}),uf=a.looseObject({_meta:a.optional(a.object({}).loose())}),df=uf,ff=a.object({method:a.string(),params:a.optional(uf)}),pf=a.looseObject({experimental:a.optional(a.object({}).loose()),logging:a.optional(a.object({}).loose()),prompts:a.optional(a.looseObject({listChanged:a.optional(a.boolean())})),resources:a.optional(a.looseObject({subscribe:a.optional(a.boolean()),listChanged:a.optional(a.boolean())})),tools:a.optional(a.looseObject({listChanged:a.optional(a.boolean())}))});df.extend({protocolVersion:a.string(),capabilities:pf,serverInfo:lf,instructions:a.optional(a.string())});var mf=df.extend({nextCursor:a.optional(a.string())}),hf=a.object({name:a.string(),description:a.optional(a.string()),inputSchema:a.object({type:a.literal(`object`),properties:a.optional(a.object({}).loose())}).loose()}).loose();mf.extend({tools:a.array(hf)});var gf=a.object({type:a.literal(`text`),text:a.string()}).loose(),_f=a.object({type:a.literal(`image`),data:a.base64(),mimeType:a.string()}).loose(),vf=a.object({uri:a.string(),mimeType:a.optional(a.string())}).loose(),yf=vf.extend({text:a.string()}),bf=vf.extend({blob:a.base64()}),xf=a.object({type:a.literal(`resource`),resource:a.union([yf,bf])}).loose();df.extend({content:a.array(a.union([gf,_f,xf])),isError:a.boolean().default(!1).optional()}).or(df.extend({toolResult:a.unknown()}));var Sf=`2.0`,Cf=a.object({jsonrpc:a.literal(Sf),id:a.union([a.string(),a.number().int()])}).merge(ff).strict(),wf=a.object({jsonrpc:a.literal(Sf),id:a.union([a.string(),a.number().int()]),result:df}).strict(),Tf=a.object({jsonrpc:a.literal(Sf),id:a.union([a.string(),a.number().int()]),error:a.object({code:a.number().int(),message:a.string(),data:a.optional(a.unknown())})}).strict(),Ef=a.object({jsonrpc:a.literal(Sf)}).merge(a.object({method:a.string(),params:a.optional(uf)})).strict();a.union([Cf,Ef,wf,Tf]);function Df({messages:e}){let t=e[e.length-1];if(!t||t.role!==`assistant`)return!1;let n=t.parts.reduce((e,t,n)=>t.type===`step-start`?n:e,-1),r=t.parts.slice(n+1).filter(Id);return r.length>0&&r.every(e=>e.state===`output-available`)}var Of=a.object({type:a.literal(`text`),text:a.string(),state:a.enum([`streaming`,`done`]).optional(),providerMetadata:$.optional()}),kf=a.object({type:a.literal(`reasoning`),text:a.string(),state:a.enum([`streaming`,`done`]).optional(),providerMetadata:$.optional()}),Af=a.object({type:a.literal(`source-url`),sourceId:a.string(),url:a.string(),title:a.string().optional(),providerMetadata:$.optional()}),jf=a.object({type:a.literal(`source-document`),sourceId:a.string(),mediaType:a.string(),title:a.string(),filename:a.string().optional(),providerMetadata:$.optional()}),Mf=a.object({type:a.literal(`file`),mediaType:a.string(),filename:a.string().optional(),url:a.string(),providerMetadata:$.optional()}),Nf=a.object({type:a.literal(`step-start`)}),Pf=a.object({type:a.string().startsWith(`data-`),id:a.string().optional(),data:a.unknown()}),Ff=[a.object({type:a.literal(`dynamic-tool`),toolName:a.string(),toolCallId:a.string(),state:a.literal(`input-streaming`),input:a.unknown().optional(),output:a.never().optional(),errorText:a.never().optional()}),a.object({type:a.literal(`dynamic-tool`),toolName:a.string(),toolCallId:a.string(),state:a.literal(`input-available`),input:a.unknown(),output:a.never().optional(),errorText:a.never().optional(),callProviderMetadata:$.optional()}),a.object({type:a.literal(`dynamic-tool`),toolName:a.string(),toolCallId:a.string(),state:a.literal(`output-available`),input:a.unknown(),output:a.unknown(),errorText:a.never().optional(),callProviderMetadata:$.optional(),preliminary:a.boolean().optional()}),a.object({type:a.literal(`dynamic-tool`),toolName:a.string(),toolCallId:a.string(),state:a.literal(`output-error`),input:a.unknown(),output:a.never().optional(),errorText:a.string(),callProviderMetadata:$.optional()})],If=[a.object({type:a.string().startsWith(`tool-`),toolCallId:a.string(),state:a.literal(`input-streaming`),input:a.unknown().optional(),output:a.never().optional(),errorText:a.never().optional()}),a.object({type:a.string().startsWith(`tool-`),toolCallId:a.string(),state:a.literal(`input-available`),input:a.unknown(),output:a.never().optional(),errorText:a.never().optional(),callProviderMetadata:$.optional()}),a.object({type:a.string().startsWith(`tool-`),toolCallId:a.string(),state:a.literal(`output-available`),input:a.unknown(),output:a.unknown(),errorText:a.never().optional(),callProviderMetadata:$.optional(),preliminary:a.boolean().optional()}),a.object({type:a.string().startsWith(`tool-`),toolCallId:a.string(),state:a.literal(`output-error`),input:a.unknown(),output:a.never().optional(),errorText:a.string(),callProviderMetadata:$.optional()})];a.object({id:a.string(),role:a.enum([`system`,`user`,`assistant`]),metadata:a.unknown().optional(),parts:a.array(a.union([Of,kf,Af,jf,Mf,Nf,Pf,...Ff,...If]))});var Lf=a.object({type:a.literal(`error`),error:a.object({type:a.string(),message:a.string()})}),Rf=wt({errorSchema:Lf,errorToMessage:e=>e.error.message}),zf=a.object({citations:a.object({enabled:a.boolean()}).optional(),title:a.string().optional(),context:a.string().optional()}),Bf=a.object({sendReasoning:a.boolean().optional(),thinking:a.object({type:a.union([a.literal(`enabled`),a.literal(`disabled`)]),budgetTokens:a.number().optional()}).optional(),disableParallelToolUse:a.boolean().optional()});function Vf(e){var t;let n=e?.anthropic,r=(t=n?.cacheControl)??n?.cache_control;return r}var Hf=a.object({maxUses:a.number().optional(),allowedDomains:a.array(a.string()).optional(),blockedDomains:a.array(a.string()).optional(),userLocation:a.object({type:a.literal(`approximate`),city:a.string().optional(),region:a.string().optional(),country:a.string().optional(),timezone:a.string().optional()}).optional()}),Uf=a.array(a.object({url:a.string(),title:a.string(),pageAge:a.string().nullable(),encryptedContent:a.string(),type:a.string()})),Wf=Ct({id:`anthropic.web_search_20250305`,name:`web_search`,inputSchema:a.object({query:a.string()}),outputSchema:Uf}),Gf=(e={})=>Wf(e);function Kf(e){return typeof e==`object`&&!!e&&`type`in e&&e.type===`web_search_20250305`}function qf({tools:e,toolChoice:t,disableParallelToolUse:n}){e=e?.length?e:void 0;let r=[],i=new Set;if(e==null)return{tools:void 0,toolChoice:void 0,toolWarnings:r,betas:i};let a=[];for(let t of e){if(Kf(t)){a.push(t);continue}switch(t.type){case`function`:let e=Vf(t.providerOptions);a.push({name:t.name,description:t.description,input_schema:t.inputSchema,cache_control:e});break;case`provider-defined`:switch(t.id){case`anthropic.computer_20250124`:i.add(`computer-use-2025-01-24`),a.push({name:`computer`,type:`computer_20250124`,display_width_px:t.args.displayWidthPx,display_height_px:t.args.displayHeightPx,display_number:t.args.displayNumber});break;case`anthropic.computer_20241022`:i.add(`computer-use-2024-10-22`),a.push({name:`computer`,type:`computer_20241022`,display_width_px:t.args.displayWidthPx,display_height_px:t.args.displayHeightPx,display_number:t.args.displayNumber});break;case`anthropic.text_editor_20250124`:i.add(`computer-use-2025-01-24`),a.push({name:`str_replace_editor`,type:`text_editor_20250124`});break;case`anthropic.text_editor_20241022`:i.add(`computer-use-2024-10-22`),a.push({name:`str_replace_editor`,type:`text_editor_20241022`});break;case`anthropic.text_editor_20250429`:i.add(`computer-use-2025-01-24`),a.push({name:`str_replace_based_edit_tool`,type:`text_editor_20250429`});break;case`anthropic.bash_20250124`:i.add(`computer-use-2025-01-24`),a.push({name:`bash`,type:`bash_20250124`});break;case`anthropic.bash_20241022`:i.add(`computer-use-2024-10-22`),a.push({name:`bash`,type:`bash_20241022`});break;case`anthropic.web_search_20250305`:{let e=Hf.parse(t.args);a.push({type:`web_search_20250305`,name:`web_search`,max_uses:e.maxUses,allowed_domains:e.allowedDomains,blocked_domains:e.blockedDomains,user_location:e.userLocation});break}case`anthropic.code_execution_20250522`:i.add(`code-execution-2025-05-22`),a.push({type:`code_execution_20250522`,name:`code_execution`});break;default:r.push({type:`unsupported-tool`,tool:t});break}break;default:r.push({type:`unsupported-tool`,tool:t});break}}if(t==null)return{tools:a,toolChoice:n?{type:`auto`,disable_parallel_tool_use:n}:void 0,toolWarnings:r,betas:i};let o=t.type;switch(o){case`auto`:return{tools:a,toolChoice:{type:`auto`,disable_parallel_tool_use:n},toolWarnings:r,betas:i};case`required`:return{tools:a,toolChoice:{type:`any`,disable_parallel_tool_use:n},toolWarnings:r,betas:i};case`none`:return{tools:void 0,toolChoice:void 0,toolWarnings:r,betas:i};case`tool`:return{tools:a,toolChoice:{type:`tool`,name:t.toolName,disable_parallel_tool_use:n},toolWarnings:r,betas:i};default:{let e=o;throw new z({functionality:`tool choice type: ${e}`})}}}var Jf=a.object({type:a.literal(`code_execution_result`),stdout:a.string(),stderr:a.string(),return_code:a.number()}),Yf=Ct({id:`anthropic.code_execution_20250522`,name:`code_execution`,inputSchema:a.object({code:a.string()}),outputSchema:Jf}),Xf=(e={})=>Yf(e);function Zf(e){if(typeof e==`string`)return Buffer.from(e,`base64`).toString(`utf-8`);if(e instanceof Uint8Array)return new TextDecoder().decode(e);throw e instanceof URL?new z({functionality:`URL-based text documents are not supported for citations`}):new z({functionality:`unsupported data type for text documents: ${typeof e}`})}async function Qf({prompt:e,sendReasoning:t,warnings:n}){var r,i,a,o,s;let c=new Set,l=$f(e),u,d=[];async function f(e){var t,n;let r=await H({provider:`anthropic`,providerOptions:e,schema:zf});return(n=(t=r?.citations)?.enabled)??!1}async function p(e){let t=await H({provider:`anthropic`,providerOptions:e,schema:zf});return{title:t?.title,context:t?.context}}for(let e=0;e<l.length;e++){let m=l[e],h=e===l.length-1,g=m.type;switch(g){case`system`:if(u!=null)throw new z({functionality:`Multiple system messages that are separated by user/assistant messages`});u=m.messages.map(({content:e,providerOptions:t})=>({type:`text`,text:e,cache_control:Vf(t)}));break;case`user`:{let e=[];for(let t of m.messages){let{role:n,content:s}=t;switch(n){case`user`:for(let n=0;n<s.length;n++){let o=s[n],l=n===s.length-1,u=(r=Vf(o.providerOptions))??(l?Vf(t.providerOptions):void 0);switch(o.type){case`text`:e.push({type:`text`,text:o.text,cache_control:u});break;case`file`:if(o.mediaType.startsWith(`image/`))e.push({type:`image`,source:o.data instanceof URL?{type:`url`,url:o.data.toString()}:{type:`base64`,media_type:o.mediaType===`image/*`?`image/jpeg`:o.mediaType,data:Ln(o.data)},cache_control:u});else if(o.mediaType===`application/pdf`){c.add(`pdfs-2024-09-25`);let t=await f(o.providerOptions),n=await p(o.providerOptions);e.push({type:`document`,source:o.data instanceof URL?{type:`url`,url:o.data.toString()}:{type:`base64`,media_type:`application/pdf`,data:Ln(o.data)},title:(i=n.title)??o.filename,...n.context&&{context:n.context},...t&&{citations:{enabled:!0}},cache_control:u})}else if(o.mediaType===`text/plain`){let t=await f(o.providerOptions),n=await p(o.providerOptions);e.push({type:`document`,source:o.data instanceof URL?{type:`url`,url:o.data.toString()}:{type:`text`,media_type:`text/plain`,data:Zf(o.data)},title:(a=n.title)??o.filename,...n.context&&{context:n.context},...t&&{citations:{enabled:!0}},cache_control:u})}else throw new z({functionality:`media type: ${o.mediaType}`});break}}break;case`tool`:for(let n=0;n<s.length;n++){let r=s[n],i=n===s.length-1,a=(o=Vf(r.providerOptions))??(i?Vf(t.providerOptions):void 0),c=r.output,l;switch(c.type){case`content`:l=c.value.map(e=>{switch(e.type){case`text`:return{type:`text`,text:e.text,cache_control:void 0};case`media`:if(e.mediaType.startsWith(`image/`))return{type:`image`,source:{type:`base64`,media_type:e.mediaType,data:e.data},cache_control:void 0};throw new z({functionality:`media type: ${e.mediaType}`})}});break;case`text`:case`error-text`:l=c.value;break;case`json`:case`error-json`:default:l=JSON.stringify(c.value);break}e.push({type:`tool_result`,tool_use_id:r.toolCallId,content:l,is_error:c.type===`error-text`||c.type===`error-json`?!0:void 0,cache_control:a})}break;default:{let e=n;throw Error(`Unsupported role: ${e}`)}}}d.push({role:`user`,content:e});break}case`assistant`:{let e=[];for(let r=0;r<m.messages.length;r++){let i=m.messages[r],a=r===m.messages.length-1,{content:o}=i;for(let r=0;r<o.length;r++){let c=o[r],l=r===o.length-1,u=(s=Vf(c.providerOptions))??(l?Vf(i.providerOptions):void 0);switch(c.type){case`text`:e.push({type:`text`,text:h&&a&&l?c.text.trim():c.text,cache_control:u});break;case`reasoning`:if(t){let t=await H({provider:`anthropic`,providerOptions:c.providerOptions,schema:cp});t==null?n.push({type:`other`,message:`unsupported reasoning metadata`}):t.signature==null?t.redactedData==null?n.push({type:`other`,message:`unsupported reasoning metadata`}):e.push({type:`redacted_thinking`,data:t.redactedData,cache_control:u}):e.push({type:`thinking`,thinking:c.text,signature:t.signature,cache_control:u})}else n.push({type:`other`,message:`sending reasoning content is disabled for this model`});break;case`tool-call`:if(c.providerExecuted){if(c.toolName===`web_search`){e.push({type:`server_tool_use`,id:c.toolCallId,name:`web_search`,input:c.input,cache_control:u});break}if(c.toolName===`code_execution`){e.push({type:`server_tool_use`,id:c.toolCallId,name:`code_execution`,input:c.input,cache_control:u});break}n.push({type:`other`,message:`provider executed tool call for tool ${c.toolName} is not supported`});break}e.push({type:`tool_use`,id:c.toolCallId,name:c.toolName,input:c.input,cache_control:u});break;case`tool-result`:if(c.toolName===`web_search`){let t=c.output;if(t.type!==`json`){n.push({type:`other`,message:`provider executed tool result output type ${t.type} for tool ${c.toolName} is not supported`});break}let r=Uf.parse(t.value);e.push({type:`web_search_tool_result`,tool_use_id:c.toolCallId,content:r.map(e=>({url:e.url,title:e.title,page_age:e.pageAge,encrypted_content:e.encryptedContent,type:e.type})),cache_control:u});break}if(c.toolName===`code_execution`){let t=c.output;if(t.type!==`json`){n.push({type:`other`,message:`provider executed tool result output type ${t.type} for tool ${c.toolName} is not supported`});break}let r=Jf.parse(t.value);e.push({type:`code_execution_tool_result`,tool_use_id:c.toolCallId,content:{type:r.type,stdout:r.stdout,stderr:r.stderr,return_code:r.return_code},cache_control:u});break}n.push({type:`other`,message:`provider executed tool result for tool ${c.toolName} is not supported`});break}}}d.push({role:`assistant`,content:e});break}default:{let e=g;throw Error(`content type: ${e}`)}}}return{prompt:{system:u,messages:d},betas:c}}function $f(e){let t=[],n;for(let r of e){let{role:e}=r;switch(e){case`system`:n?.type!==`system`&&(n={type:`system`,messages:[]},t.push(n)),n.messages.push(r);break;case`assistant`:n?.type!==`assistant`&&(n={type:`assistant`,messages:[]},t.push(n)),n.messages.push(r);break;case`user`:n?.type!==`user`&&(n={type:`user`,messages:[]},t.push(n)),n.messages.push(r);break;case`tool`:n?.type!==`user`&&(n={type:`user`,messages:[]},t.push(n)),n.messages.push(r);break;default:{let t=e;throw Error(`Unsupported role: ${t}`)}}}return t}function ep({finishReason:e,isJsonResponseFromTool:t}){switch(e){case`pause_turn`:case`end_turn`:case`stop_sequence`:return`stop`;case`refusal`:return`content-filter`;case`tool_use`:return t?`stop`:`tool-calls`;case`max_tokens`:return`length`;default:return`unknown`}}var tp={webSearchResult:a.object({type:a.literal(`web_search_result_location`),cited_text:a.string(),url:a.string(),title:a.string(),encrypted_index:a.string()}),pageLocation:a.object({type:a.literal(`page_location`),cited_text:a.string(),document_index:a.number(),document_title:a.string().nullable(),start_page_number:a.number(),end_page_number:a.number()}),charLocation:a.object({type:a.literal(`char_location`),cited_text:a.string(),document_index:a.number(),document_title:a.string().nullable(),start_char_index:a.number(),end_char_index:a.number()})},np=a.discriminatedUnion(`type`,[tp.webSearchResult,tp.pageLocation,tp.charLocation]);a.discriminatedUnion(`type`,[tp.pageLocation,tp.charLocation]);function rp(e,t,n,r){if(e.type===`page_location`||e.type===`char_location`){let i=ip(e,t,n);i&&r(i)}}function ip(e,t,n){var r;let i=t[e.document_index];if(!i)return null;let a=e.type===`page_location`?{citedText:e.cited_text,startPageNumber:e.start_page_number,endPageNumber:e.end_page_number}:{citedText:e.cited_text,startCharIndex:e.start_char_index,endCharIndex:e.end_char_index};return{type:`source`,sourceType:`document`,id:n(),mediaType:i.mediaType,title:(r=e.document_title)??i.title,filename:i.filename,providerMetadata:{anthropic:a}}}var ap=class{constructor(e,t){this.specificationVersion=`v2`;var n;this.modelId=e,this.config=t,this.generateId=(n=t.generateId)??V}supportsUrl(e){return e.protocol===`https:`}get provider(){return this.config.provider}get supportedUrls(){var e,t,n;return(n=(t=(e=this.config).supportedUrls)?.call(e))??{}}async getArgs({prompt:e,maxOutputTokens:t=4096,temperature:n,topP:r,topK:i,frequencyPenalty:a,presencePenalty:o,stopSequences:s,responseFormat:c,seed:l,tools:u,toolChoice:d,providerOptions:f}){var p,m,h;let g=[];a!=null&&g.push({type:`unsupported-setting`,setting:`frequencyPenalty`}),o!=null&&g.push({type:`unsupported-setting`,setting:`presencePenalty`}),l!=null&&g.push({type:`unsupported-setting`,setting:`seed`}),c?.type===`json`&&(c.schema==null?g.push({type:`unsupported-setting`,setting:`responseFormat`,details:`JSON response format requires a schema. The response format is ignored.`}):u!=null&&g.push({type:`unsupported-setting`,setting:`tools`,details:`JSON response format does not support tools. The provided tools are ignored.`}));let _=c?.type===`json`&&c.schema!=null?{type:`function`,name:`json`,description:`Respond with a JSON object.`,inputSchema:c.schema}:void 0,v=await H({provider:`anthropic`,providerOptions:f,schema:Bf}),{prompt:y,betas:b}=await Qf({prompt:e,sendReasoning:(p=v?.sendReasoning)??!0,warnings:g}),x=(m=v?.thinking)?.type===`enabled`,S=(h=v?.thinking)?.budgetTokens,C={model:this.modelId,max_tokens:t,temperature:n,top_k:i,top_p:r,stop_sequences:s,...x&&{thinking:{type:`enabled`,budget_tokens:S}},system:y.system,messages:y.messages};if(x){if(S==null)throw new z({functionality:`thinking requires a budget`});C.temperature!=null&&(C.temperature=void 0,g.push({type:`unsupported-setting`,setting:`temperature`,details:`temperature is not supported when thinking is enabled`})),i!=null&&(C.top_k=void 0,g.push({type:`unsupported-setting`,setting:`topK`,details:`topK is not supported when thinking is enabled`})),r!=null&&(C.top_p=void 0,g.push({type:`unsupported-setting`,setting:`topP`,details:`topP is not supported when thinking is enabled`})),C.max_tokens=t+S}let{tools:w,toolChoice:T,toolWarnings:E,betas:D}=qf(_==null?{tools:u??[],toolChoice:d,disableParallelToolUse:v?.disableParallelToolUse}:{tools:[_],toolChoice:{type:`tool`,toolName:_.name},disableParallelToolUse:!0});return{args:{...C,tools:w,tool_choice:T},warnings:[...g,...E],betas:new Set([...b,...D]),usesJsonResponseTool:_!=null}}async getHeaders({betas:e,headers:t}){return B(await G(this.config.headers),e.size>0?{"anthropic-beta":Array.from(e).join(`,`)}:{},t)}buildRequestUrl(e){var t,n,r;return(r=(n=(t=this.config).buildRequestUrl)?.call(t,this.config.baseURL,e))??`${this.config.baseURL}/messages`}transformRequestBody(e){var t,n,r;return(r=(n=(t=this.config).transformRequestBody)?.call(t,e))??e}extractCitationDocuments(e){let t=e=>{var t,n;if(e.type!==`file`||e.mediaType!==`application/pdf`&&e.mediaType!==`text/plain`)return!1;let r=(t=e.providerOptions)?.anthropic,i=r?.citations;return(n=i?.enabled)??!1};return e.filter(e=>e.role===`user`).flatMap(e=>e.content).filter(t).map(e=>{var t;let n=e;return{title:(t=n.filename)??`Untitled Document`,filename:n.filename,mediaType:n.mediaType}})}async doGenerate(e){var t,n,r,i,a;let{args:o,warnings:s,betas:c,usesJsonResponseTool:l}=await this.getArgs(e),u=this.extractCitationDocuments(e.prompt),{responseHeaders:d,value:f,rawValue:p}=await U({url:this.buildRequestUrl(!1),headers:await this.getHeaders({betas:c,headers:e.headers}),body:this.transformRequestBody(o),failedResponseHandler:Rf,successfulResponseHandler:K(op),abortSignal:e.abortSignal,fetch:this.config.fetch}),m=[];for(let e of f.content)switch(e.type){case`text`:if(!l&&(m.push({type:`text`,text:e.text}),e.citations))for(let t of e.citations)rp(t,u,this.generateId,e=>m.push(e));break;case`thinking`:m.push({type:`reasoning`,text:e.thinking,providerMetadata:{anthropic:{signature:e.signature}}});break;case`redacted_thinking`:m.push({type:`reasoning`,text:``,providerMetadata:{anthropic:{redactedData:e.data}}});break;case`tool_use`:m.push(l?{type:`text`,text:JSON.stringify(e.input)}:{type:`tool-call`,toolCallId:e.id,toolName:e.name,input:JSON.stringify(e.input)});break;case`server_tool_use`:(e.name===`web_search`||e.name===`code_execution`)&&m.push({type:`tool-call`,toolCallId:e.id,toolName:e.name,input:JSON.stringify(e.input),providerExecuted:!0});break;case`web_search_tool_result`:if(Array.isArray(e.content)){m.push({type:`tool-result`,toolCallId:e.tool_use_id,toolName:`web_search`,result:e.content.map(e=>{var t;return{url:e.url,title:e.title,pageAge:(t=e.page_age)??null,encryptedContent:e.encrypted_content,type:e.type}}),providerExecuted:!0});for(let n of e.content)m.push({type:`source`,sourceType:`url`,id:this.generateId(),url:n.url,title:n.title,providerMetadata:{anthropic:{pageAge:(t=n.page_age)??null}}})}else m.push({type:`tool-result`,toolCallId:e.tool_use_id,toolName:`web_search`,isError:!0,result:{type:`web_search_tool_result_error`,errorCode:e.content.error_code},providerExecuted:!0});break;case`code_execution_tool_result`:e.content.type===`code_execution_result`?m.push({type:`tool-result`,toolCallId:e.tool_use_id,toolName:`code_execution`,result:{type:e.content.type,stdout:e.content.stdout,stderr:e.content.stderr,return_code:e.content.return_code},providerExecuted:!0}):e.content.type===`code_execution_tool_result_error`&&m.push({type:`tool-result`,toolCallId:e.tool_use_id,toolName:`code_execution`,isError:!0,result:{type:`code_execution_tool_result_error`,errorCode:e.content.error_code},providerExecuted:!0});break}return{content:m,finishReason:ep({finishReason:f.stop_reason,isJsonResponseFromTool:l}),usage:{inputTokens:f.usage.input_tokens,outputTokens:f.usage.output_tokens,totalTokens:f.usage.input_tokens+f.usage.output_tokens,cachedInputTokens:(n=f.usage.cache_read_input_tokens)??void 0},request:{body:o},response:{id:(r=f.id)??void 0,modelId:(i=f.model)??void 0,headers:d,body:p},warnings:s,providerMetadata:{anthropic:{usage:f.usage,cacheCreationInputTokens:(a=f.usage.cache_creation_input_tokens)??null}}}}async doStream(e){let{args:t,warnings:n,betas:r,usesJsonResponseTool:i}=await this.getArgs(e),a=this.extractCitationDocuments(e.prompt),o={...t,stream:!0},{responseHeaders:s,value:c}=await U({url:this.buildRequestUrl(!0),headers:await this.getHeaders({betas:r,headers:e.headers}),body:this.transformRequestBody(o),failedResponseHandler:Rf,successfulResponseHandler:Tt(sp),abortSignal:e.abortSignal,fetch:this.config.fetch}),l=`unknown`,u={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},d={},f,p,m=this.generateId;return{stream:c.pipeThrough(new TransformStream({start(e){e.enqueue({type:`stream-start`,warnings:n})},transform(t,n){var r,o,s,c,h,g,_;if(e.includeRawChunks&&n.enqueue({type:`raw`,rawValue:t.rawValue}),!t.success){n.enqueue({type:`error`,error:t.error});return}let v=t.value;switch(v.type){case`ping`:return;case`content_block_start`:{let e=v.content_block.type;switch(p=e,e){case`text`:d[v.index]={type:`text`},n.enqueue({type:`text-start`,id:String(v.index)});return;case`thinking`:d[v.index]={type:`reasoning`},n.enqueue({type:`reasoning-start`,id:String(v.index)});return;case`redacted_thinking`:d[v.index]={type:`reasoning`},n.enqueue({type:`reasoning-start`,id:String(v.index),providerMetadata:{anthropic:{redactedData:v.content_block.data}}});return;case`tool_use`:d[v.index]=i?{type:`text`}:{type:`tool-call`,toolCallId:v.content_block.id,toolName:v.content_block.name,input:``},n.enqueue(i?{type:`text-start`,id:String(v.index)}:{type:`tool-input-start`,id:v.content_block.id,toolName:v.content_block.name});return;case`server_tool_use`:(v.content_block.name===`web_search`||v.content_block.name===`code_execution`)&&(d[v.index]={type:`tool-call`,toolCallId:v.content_block.id,toolName:v.content_block.name,input:``,providerExecuted:!0},n.enqueue({type:`tool-input-start`,id:v.content_block.id,toolName:v.content_block.name,providerExecuted:!0}));return;case`web_search_tool_result`:{let e=v.content_block;if(Array.isArray(e.content)){n.enqueue({type:`tool-result`,toolCallId:e.tool_use_id,toolName:`web_search`,result:e.content.map(e=>{var t;return{url:e.url,title:e.title,pageAge:(t=e.page_age)??null,encryptedContent:e.encrypted_content,type:e.type}}),providerExecuted:!0});for(let t of e.content)n.enqueue({type:`source`,sourceType:`url`,id:m(),url:t.url,title:t.title,providerMetadata:{anthropic:{pageAge:(r=t.page_age)??null}}})}else n.enqueue({type:`tool-result`,toolCallId:e.tool_use_id,toolName:`web_search`,isError:!0,result:{type:`web_search_tool_result_error`,errorCode:e.content.error_code},providerExecuted:!0});return}case`code_execution_tool_result`:{let e=v.content_block;e.content.type===`code_execution_result`?n.enqueue({type:`tool-result`,toolCallId:e.tool_use_id,toolName:`code_execution`,result:{type:e.content.type,stdout:e.content.stdout,stderr:e.content.stderr,return_code:e.content.return_code},providerExecuted:!0}):e.content.type===`code_execution_tool_result_error`&&n.enqueue({type:`tool-result`,toolCallId:e.tool_use_id,toolName:`code_execution`,isError:!0,result:{type:`code_execution_tool_result_error`,errorCode:e.content.error_code},providerExecuted:!0});return}default:{let t=e;throw Error(`Unsupported content block type: ${t}`)}}}case`content_block_stop`:if(d[v.index]!=null){let e=d[v.index];switch(e.type){case`text`:n.enqueue({type:`text-end`,id:String(v.index)});break;case`reasoning`:n.enqueue({type:`reasoning-end`,id:String(v.index)});break;case`tool-call`:i||(n.enqueue({type:`tool-input-end`,id:e.toolCallId}),n.enqueue(e));break}delete d[v.index]}p=void 0;return;case`content_block_delta`:{let e=v.delta.type;switch(e){case`text_delta`:if(i)return;n.enqueue({type:`text-delta`,id:String(v.index),delta:v.delta.text});return;case`thinking_delta`:n.enqueue({type:`reasoning-delta`,id:String(v.index),delta:v.delta.thinking});return;case`signature_delta`:p===`thinking`&&n.enqueue({type:`reasoning-delta`,id:String(v.index),delta:``,providerMetadata:{anthropic:{signature:v.delta.signature}}});return;case`input_json_delta`:{let e=d[v.index],t=v.delta.partial_json;if(i){if(e?.type!==`text`)return;n.enqueue({type:`text-delta`,id:String(v.index),delta:t})}else{if(e?.type!==`tool-call`)return;n.enqueue({type:`tool-input-delta`,id:e.toolCallId,delta:t}),e.input+=t}return}case`citations_delta`:{let e=v.delta.citation;rp(e,a,m,e=>n.enqueue(e));return}default:{let t=e;throw Error(`Unsupported delta type: ${t}`)}}}case`message_start`:u.inputTokens=v.message.usage.input_tokens,u.cachedInputTokens=(o=v.message.usage.cache_read_input_tokens)??void 0,f={anthropic:{usage:v.message.usage,cacheCreationInputTokens:(s=v.message.usage.cache_creation_input_tokens)??null}},n.enqueue({type:`response-metadata`,id:(c=v.message.id)??void 0,modelId:(h=v.message.model)??void 0});return;case`message_delta`:u.outputTokens=v.usage.output_tokens,u.totalTokens=((g=u.inputTokens)??0)+((_=v.usage.output_tokens)??0),l=ep({finishReason:v.delta.stop_reason,isJsonResponseFromTool:i});return;case`message_stop`:n.enqueue({type:`finish`,finishReason:l,usage:u,providerMetadata:f});return;case`error`:n.enqueue({type:`error`,error:v.error});return;default:{let e=v;throw Error(`Unsupported chunk type: ${e}`)}}}})),request:{body:o},response:{headers:s}}}},op=a.object({type:a.literal(`message`),id:a.string().nullish(),model:a.string().nullish(),content:a.array(a.discriminatedUnion(`type`,[a.object({type:a.literal(`text`),text:a.string(),citations:a.array(np).optional()}),a.object({type:a.literal(`thinking`),thinking:a.string(),signature:a.string()}),a.object({type:a.literal(`redacted_thinking`),data:a.string()}),a.object({type:a.literal(`tool_use`),id:a.string(),name:a.string(),input:a.unknown()}),a.object({type:a.literal(`server_tool_use`),id:a.string(),name:a.string(),input:a.record(a.string(),a.unknown()).nullish()}),a.object({type:a.literal(`web_search_tool_result`),tool_use_id:a.string(),content:a.union([a.array(a.object({type:a.literal(`web_search_result`),url:a.string(),title:a.string(),encrypted_content:a.string(),page_age:a.string().nullish()})),a.object({type:a.literal(`web_search_tool_result_error`),error_code:a.string()})])}),a.object({type:a.literal(`code_execution_tool_result`),tool_use_id:a.string(),content:a.union([a.object({type:a.literal(`code_execution_result`),stdout:a.string(),stderr:a.string(),return_code:a.number()}),a.object({type:a.literal(`code_execution_tool_result_error`),error_code:a.string()})])})])),stop_reason:a.string().nullish(),usage:a.looseObject({input_tokens:a.number(),output_tokens:a.number(),cache_creation_input_tokens:a.number().nullish(),cache_read_input_tokens:a.number().nullish()})}),sp=a.discriminatedUnion(`type`,[a.object({type:a.literal(`message_start`),message:a.object({id:a.string().nullish(),model:a.string().nullish(),usage:a.looseObject({input_tokens:a.number(),output_tokens:a.number(),cache_creation_input_tokens:a.number().nullish(),cache_read_input_tokens:a.number().nullish()})})}),a.object({type:a.literal(`content_block_start`),index:a.number(),content_block:a.discriminatedUnion(`type`,[a.object({type:a.literal(`text`),text:a.string()}),a.object({type:a.literal(`thinking`),thinking:a.string()}),a.object({type:a.literal(`tool_use`),id:a.string(),name:a.string()}),a.object({type:a.literal(`redacted_thinking`),data:a.string()}),a.object({type:a.literal(`server_tool_use`),id:a.string(),name:a.string(),input:a.record(a.string(),a.unknown()).nullish()}),a.object({type:a.literal(`web_search_tool_result`),tool_use_id:a.string(),content:a.union([a.array(a.object({type:a.literal(`web_search_result`),url:a.string(),title:a.string(),encrypted_content:a.string(),page_age:a.string().nullish()})),a.object({type:a.literal(`web_search_tool_result_error`),error_code:a.string()})])}),a.object({type:a.literal(`code_execution_tool_result`),tool_use_id:a.string(),content:a.union([a.object({type:a.literal(`code_execution_result`),stdout:a.string(),stderr:a.string(),return_code:a.number()}),a.object({type:a.literal(`code_execution_tool_result_error`),error_code:a.string()})])})])}),a.object({type:a.literal(`content_block_delta`),index:a.number(),delta:a.discriminatedUnion(`type`,[a.object({type:a.literal(`input_json_delta`),partial_json:a.string()}),a.object({type:a.literal(`text_delta`),text:a.string()}),a.object({type:a.literal(`thinking_delta`),thinking:a.string()}),a.object({type:a.literal(`signature_delta`),signature:a.string()}),a.object({type:a.literal(`citations_delta`),citation:np})])}),a.object({type:a.literal(`content_block_stop`),index:a.number()}),a.object({type:a.literal(`error`),error:a.object({type:a.string(),message:a.string()})}),a.object({type:a.literal(`message_delta`),delta:a.object({stop_reason:a.string().nullish()}),usage:a.object({output_tokens:a.number()})}),a.object({type:a.literal(`message_stop`)}),a.object({type:a.literal(`ping`)})]),cp=a.object({signature:a.string().optional(),redactedData:a.string().optional()}),lp=W({id:`anthropic.bash_20241022`,name:`bash`,inputSchema:i.object({command:i.string(),restart:i.boolean().optional()})}),up=W({id:`anthropic.bash_20250124`,name:`bash`,inputSchema:i.object({command:i.string(),restart:i.boolean().optional()})}),dp=W({id:`anthropic.computer_20241022`,name:`computer`,inputSchema:a.object({action:a.enum([`key`,`type`,`mouse_move`,`left_click`,`left_click_drag`,`right_click`,`middle_click`,`double_click`,`screenshot`,`cursor_position`]),coordinate:a.array(a.number().int()).optional(),text:a.string().optional()})}),fp=W({id:`anthropic.computer_20250124`,name:`computer`,inputSchema:a.object({action:a.enum([`key`,`hold_key`,`type`,`cursor_position`,`mouse_move`,`left_mouse_down`,`left_mouse_up`,`left_click`,`left_click_drag`,`right_click`,`middle_click`,`double_click`,`triple_click`,`scroll`,`wait`,`screenshot`]),coordinate:a.tuple([a.number().int(),a.number().int()]).optional(),duration:a.number().optional(),scroll_amount:a.number().optional(),scroll_direction:a.enum([`up`,`down`,`left`,`right`]).optional(),start_coordinate:a.tuple([a.number().int(),a.number().int()]).optional(),text:a.string().optional()})}),pp=W({id:`anthropic.text_editor_20241022`,name:`str_replace_editor`,inputSchema:a.object({command:a.enum([`view`,`create`,`str_replace`,`insert`,`undo_edit`]),path:a.string(),file_text:a.string().optional(),insert_line:a.number().int().optional(),new_str:a.string().optional(),old_str:a.string().optional(),view_range:a.array(a.number().int()).optional()})}),mp=W({id:`anthropic.text_editor_20250124`,name:`str_replace_editor`,inputSchema:a.object({command:a.enum([`view`,`create`,`str_replace`,`insert`,`undo_edit`]),path:a.string(),file_text:a.string().optional(),insert_line:a.number().int().optional(),new_str:a.string().optional(),old_str:a.string().optional(),view_range:a.array(a.number().int()).optional()})}),hp=W({id:`anthropic.text_editor_20250429`,name:`str_replace_based_edit_tool`,inputSchema:a.object({command:a.enum([`view`,`create`,`str_replace`,`insert`]),path:a.string(),file_text:a.string().optional(),insert_line:a.number().int().optional(),new_str:a.string().optional(),old_str:a.string().optional(),view_range:a.array(a.number().int()).optional()})}),gp={bash_20241022:lp,bash_20250124:up,codeExecution_20250522:Xf,computer_20241022:dp,computer_20250124:fp,textEditor_20241022:pp,textEditor_20250124:mp,textEditor_20250429:hp,webSearch_20250305:Gf};function _p(e={}){var t;let n=(t=Rn(e.baseURL))??`https://api.anthropic.com/v1`,r=()=>({"anthropic-version":`2023-06-01`,"x-api-key":et({apiKey:e.apiKey,environmentVariableName:`ANTHROPIC_API_KEY`,description:`Anthropic`}),...e.headers}),i=t=>{var i;return new ap(t,{provider:`anthropic.messages`,baseURL:n,headers:r,fetch:e.fetch,generateId:(i=e.generateId)??V,supportedUrls:()=>({"image/*":[/^https?:\/\/.*$/]})})},a=function(e){if(new.target)throw Error(`The Anthropic model function cannot be called with the new keyword.`);return i(e)};return a.languageModel=i,a.chat=i,a.messages=i,a.textEmbeddingModel=e=>{throw new xe({modelId:e,modelType:`textEmbeddingModel`})},a.imageModel=e=>{throw new xe({modelId:e,modelType:`imageModel`})},a.tools=gp,a}_p();var vp=a.object({error:a.object({code:a.number().nullable(),message:a.string(),status:a.string()})}),yp=wt({errorSchema:vp,errorToMessage:e=>e.error.message}),bp=a.object({outputDimensionality:a.number().optional(),taskType:a.enum([`SEMANTIC_SIMILARITY`,`CLASSIFICATION`,`CLUSTERING`,`RETRIEVAL_DOCUMENT`,`RETRIEVAL_QUERY`,`QUESTION_ANSWERING`,`FACT_VERIFICATION`,`CODE_RETRIEVAL_QUERY`]).optional()}),xp=class{constructor(e,t){this.specificationVersion=`v2`,this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0,this.modelId=e,this.config=t}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:n,providerOptions:r}){let i=await H({provider:`google`,providerOptions:r,schema:bp});if(e.length>this.maxEmbeddingsPerCall)throw new Ee({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let a=B(await G(this.config.headers),t);if(e.length===1){let{responseHeaders:t,value:r,rawValue:o}=await U({url:`${this.config.baseURL}/models/${this.modelId}:embedContent`,headers:a,body:{model:`models/${this.modelId}`,content:{parts:[{text:e[0]}]},outputDimensionality:i?.outputDimensionality,taskType:i?.taskType},failedResponseHandler:yp,successfulResponseHandler:K(Cp),abortSignal:n,fetch:this.config.fetch});return{embeddings:[r.embedding.values],usage:void 0,response:{headers:t,body:o}}}let{responseHeaders:o,value:s,rawValue:c}=await U({url:`${this.config.baseURL}/models/${this.modelId}:batchEmbedContents`,headers:a,body:{requests:e.map(e=>({model:`models/${this.modelId}`,content:{role:`user`,parts:[{text:e}]},outputDimensionality:i?.outputDimensionality,taskType:i?.taskType}))},failedResponseHandler:yp,successfulResponseHandler:K(Sp),abortSignal:n,fetch:this.config.fetch});return{embeddings:s.embeddings.map(e=>e.values),usage:void 0,response:{headers:o,body:c}}}},Sp=a.object({embeddings:a.array(a.object({values:a.array(a.number())}))}),Cp=a.object({embedding:a.object({values:a.array(a.number())})});function wp(e){if(e==null||Tp(e))return;if(typeof e==`boolean`)return{type:`boolean`,properties:{}};let{type:t,description:n,required:r,properties:i,items:a,allOf:o,anyOf:s,oneOf:c,format:l,const:u,minLength:d,enum:f}=e,p={};if(n&&(p.description=n),r&&(p.required=r),l&&(p.format=l),u!==void 0&&(p.enum=[u]),t&&(Array.isArray(t)?t.includes(`null`)?(p.type=t.filter(e=>e!==`null`)[0],p.nullable=!0):p.type=t:t===`null`?p.type=`null`:p.type=t),f!==void 0&&(p.enum=f),i!=null&&(p.properties=Object.entries(i).reduce((e,[t,n])=>(e[t]=wp(n),e),{})),a&&(p.items=Array.isArray(a)?a.map(wp):wp(a)),o&&(p.allOf=o.map(wp)),s)if(s.some(e=>typeof e==`object`&&e?.type===`null`)){let e=s.filter(e=>!(typeof e==`object`&&e?.type===`null`));if(e.length===1){let t=wp(e[0]);typeof t==`object`&&(p.nullable=!0,Object.assign(p,t))}else p.anyOf=e.map(wp),p.nullable=!0}else p.anyOf=s.map(wp);return c&&(p.oneOf=c.map(wp)),d!==void 0&&(p.minLength=d),p}function Tp(e){return typeof e==`object`&&!!e&&e.type===`object`&&(e.properties==null||Object.keys(e.properties).length===0)&&!e.additionalProperties}function Ep(e,t){var n;let r=[],i=[],a=!0,o=(n=t?.isGemmaModel)??!1;for(let{role:t,content:n}of e)switch(t){case`system`:if(!a)throw new z({functionality:`system messages are only supported at the beginning of the conversation`});r.push({text:n});break;case`user`:{a=!1;let e=[];for(let t of n)switch(t.type){case`text`:e.push({text:t.text});break;case`file`:{let n=t.mediaType===`image/*`?`image/jpeg`:t.mediaType;e.push(t.data instanceof URL?{fileData:{mimeType:n,fileUri:t.data.toString()}}:{inlineData:{mimeType:n,data:Ln(t.data)}});break}}i.push({role:`user`,parts:e});break}case`assistant`:a=!1,i.push({role:`model`,parts:n.map(e=>{var t,n,r,i,a,o;switch(e.type){case`text`:return e.text.length===0?void 0:{text:e.text,thoughtSignature:(n=(t=e.providerOptions)?.google)?.thoughtSignature};case`reasoning`:return e.text.length===0?void 0:{text:e.text,thought:!0,thoughtSignature:(i=(r=e.providerOptions)?.google)?.thoughtSignature};case`file`:if(e.mediaType!==`image/png`)throw new z({functionality:`Only PNG images are supported in assistant messages`});if(e.data instanceof URL)throw new z({functionality:`File data URLs in assistant messages are not supported`});return{inlineData:{mimeType:e.mediaType,data:Ln(e.data)}};case`tool-call`:return{functionCall:{name:e.toolName,args:e.input},thoughtSignature:(o=(a=e.providerOptions)?.google)?.thoughtSignature}}}).filter(e=>e!==void 0)});break;case`tool`:{a=!1;let e=[];for(let t of n){let n=t.output;if(n.type===`content`)for(let r of n.value)switch(r.type){case`text`:e.push({functionResponse:{name:t.toolName,response:{name:t.toolName,content:r.text}}});break;case`media`:e.push({inlineData:{mimeType:r.mediaType,data:r.data}},{text:`Tool executed successfully and returned this image as a response`});break;default:e.push({text:JSON.stringify(r)});break}else e.push({functionResponse:{name:t.toolName,response:{name:t.toolName,content:n.value}}})}i.push({role:`user`,parts:e});break}}if(o&&r.length>0&&i.length>0&&i[0].role===`user`){let e=r.map(e=>e.text).join(`

`);i[0].parts.unshift({text:e+`

`})}return{systemInstruction:r.length>0&&!o?{parts:r}:void 0,contents:i}}function Dp(e){return e.includes(`/`)?e:`models/${e}`}var Op=a.object({responseModalities:a.array(a.enum([`TEXT`,`IMAGE`])).optional(),thinkingConfig:a.object({thinkingBudget:a.number().optional(),includeThoughts:a.boolean().optional()}).optional(),cachedContent:a.string().optional(),structuredOutputs:a.boolean().optional(),safetySettings:a.array(a.object({category:a.enum([`HARM_CATEGORY_UNSPECIFIED`,`HARM_CATEGORY_HATE_SPEECH`,`HARM_CATEGORY_DANGEROUS_CONTENT`,`HARM_CATEGORY_HARASSMENT`,`HARM_CATEGORY_SEXUALLY_EXPLICIT`,`HARM_CATEGORY_CIVIC_INTEGRITY`]),threshold:a.enum([`HARM_BLOCK_THRESHOLD_UNSPECIFIED`,`BLOCK_LOW_AND_ABOVE`,`BLOCK_MEDIUM_AND_ABOVE`,`BLOCK_ONLY_HIGH`,`BLOCK_NONE`,`OFF`])})).optional(),threshold:a.enum([`HARM_BLOCK_THRESHOLD_UNSPECIFIED`,`BLOCK_LOW_AND_ABOVE`,`BLOCK_MEDIUM_AND_ABOVE`,`BLOCK_ONLY_HIGH`,`BLOCK_NONE`,`OFF`]).optional(),audioTimestamp:a.boolean().optional(),labels:a.record(a.string(),a.string()).optional()});function kp({tools:e,toolChoice:t,modelId:n}){var r;e=e?.length?e:void 0;let i=[],a=n.includes(`gemini-2`),o=n.includes(`gemini-1.5-flash`)&&!n.includes(`-8b`);if(e==null)return{tools:void 0,toolConfig:void 0,toolWarnings:i};let s=e.some(e=>e.type===`function`),c=e.some(e=>e.type===`provider-defined`);if(s&&c&&i.push({type:`unsupported-tool`,tool:e.find(e=>e.type===`function`),details:`Cannot mix function tools with provider-defined tools in the same request. Please use either function tools or provider-defined tools, but not both.`}),c){let t={},n=e.filter(e=>e.type===`provider-defined`);return n.forEach(e=>{switch(e.id){case`google.google_search`:a?t.googleSearch={}:o?t.googleSearchRetrieval={dynamicRetrievalConfig:{mode:e.args.mode,dynamicThreshold:e.args.dynamicThreshold}}:t.googleSearchRetrieval={};break;case`google.url_context`:a?t.urlContext={}:i.push({type:`unsupported-tool`,tool:e,details:`The URL context tool is not supported with other Gemini models than Gemini 2.`});break;case`google.code_execution`:a?t.codeExecution={}:i.push({type:`unsupported-tool`,tool:e,details:`The code execution tools is not supported with other Gemini models than Gemini 2.`});break;default:i.push({type:`unsupported-tool`,tool:e});break}}),{tools:Object.keys(t).length>0?t:void 0,toolConfig:void 0,toolWarnings:i}}let l=[];for(let t of e)switch(t.type){case`function`:l.push({name:t.name,description:(r=t.description)??``,parameters:wp(t.inputSchema)});break;default:i.push({type:`unsupported-tool`,tool:t});break}if(t==null)return{tools:{functionDeclarations:l},toolConfig:void 0,toolWarnings:i};let u=t.type;switch(u){case`auto`:return{tools:{functionDeclarations:l},toolConfig:{functionCallingConfig:{mode:`AUTO`}},toolWarnings:i};case`none`:return{tools:{functionDeclarations:l},toolConfig:{functionCallingConfig:{mode:`NONE`}},toolWarnings:i};case`required`:return{tools:{functionDeclarations:l},toolConfig:{functionCallingConfig:{mode:`ANY`}},toolWarnings:i};case`tool`:return{tools:{functionDeclarations:l},toolConfig:{functionCallingConfig:{mode:`ANY`,allowedFunctionNames:[t.toolName]}},toolWarnings:i};default:{let e=u;throw new z({functionality:`tool choice type: ${e}`})}}}function Ap({finishReason:e,hasToolCalls:t}){switch(e){case`STOP`:return t?`tool-calls`:`stop`;case`MAX_TOKENS`:return`length`;case`IMAGE_SAFETY`:case`RECITATION`:case`SAFETY`:case`BLOCKLIST`:case`PROHIBITED_CONTENT`:case`SPII`:return`content-filter`;case`FINISH_REASON_UNSPECIFIED`:case`OTHER`:return`other`;case`MALFORMED_FUNCTION_CALL`:return`error`;default:return`unknown`}}var jp=a.object({web:a.object({uri:a.string(),title:a.string()}).nullish(),retrievedContext:a.object({uri:a.string(),title:a.string()}).nullish()}),Mp=a.object({webSearchQueries:a.array(a.string()).nullish(),retrievalQueries:a.array(a.string()).nullish(),searchEntryPoint:a.object({renderedContent:a.string()}).nullish(),groundingChunks:a.array(jp).nullish(),groundingSupports:a.array(a.object({segment:a.object({startIndex:a.number().nullish(),endIndex:a.number().nullish(),text:a.string().nullish()}),segment_text:a.string().nullish(),groundingChunkIndices:a.array(a.number()).nullish(),supportChunkIndices:a.array(a.number()).nullish(),confidenceScores:a.array(a.number()).nullish(),confidenceScore:a.array(a.number()).nullish()})).nullish(),retrievalMetadata:a.union([a.object({webDynamicRetrievalScore:a.number()}),a.object({})]).nullish()}),Np=W({id:`google.google_search`,name:`google_search`,inputSchema:a.object({mode:a.enum([`MODE_DYNAMIC`,`MODE_UNSPECIFIED`]).default(`MODE_UNSPECIFIED`),dynamicThreshold:a.number().default(1)})}),Pp=a.object({retrievedUrl:a.string(),urlRetrievalStatus:a.string()}),Fp=a.object({urlMetadata:a.array(Pp)}),Ip=W({id:`google.url_context`,name:`url_context`,inputSchema:a.object({})}),Lp=class{constructor(e,t){this.specificationVersion=`v2`;var n;this.modelId=e,this.config=t,this.generateId=(n=t.generateId)??V}get provider(){return this.config.provider}get supportedUrls(){var e,t,n;return(n=(t=(e=this.config).supportedUrls)?.call(e))??{}}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,topK:i,frequencyPenalty:a,presencePenalty:o,stopSequences:s,responseFormat:c,seed:l,tools:u,toolChoice:d,providerOptions:f}){var p,m;let h=[],g=await H({provider:`google`,providerOptions:f,schema:Op});(p=g?.thinkingConfig)?.includeThoughts===!0&&!this.config.provider.startsWith(`google.vertex.`)&&h.push({type:`other`,message:`The 'includeThoughts' option is only supported with the Google Vertex provider and might not be supported or could behave unexpectedly with the current Google provider (${this.config.provider}).`});let _=this.modelId.toLowerCase().startsWith(`gemma-`),{contents:v,systemInstruction:y}=Ep(e,{isGemmaModel:_}),{tools:b,toolConfig:x,toolWarnings:S}=kp({tools:u,toolChoice:d,modelId:this.modelId});return{args:{generationConfig:{maxOutputTokens:t,temperature:n,topK:i,topP:r,frequencyPenalty:a,presencePenalty:o,stopSequences:s,seed:l,responseMimeType:c?.type===`json`?`application/json`:void 0,responseSchema:c?.type===`json`&&c.schema!=null&&((m=g?.structuredOutputs)??!0)?wp(c.schema):void 0,...g?.audioTimestamp&&{audioTimestamp:g.audioTimestamp},responseModalities:g?.responseModalities,thinkingConfig:g?.thinkingConfig},contents:v,systemInstruction:_?void 0:y,safetySettings:g?.safetySettings,tools:b,toolConfig:x,cachedContent:g?.cachedContent,labels:g?.labels},warnings:[...h,...S]}}async doGenerate(e){var t,n,r,i,a,o,s,c,l,u,d,f;let{args:p,warnings:m}=await this.getArgs(e),h=JSON.stringify(p),g=B(await G(this.config.headers),e.headers),{responseHeaders:_,value:v,rawValue:y}=await U({url:`${this.config.baseURL}/${Dp(this.modelId)}:generateContent`,headers:g,body:p,failedResponseHandler:yp,successfulResponseHandler:K(Wp),abortSignal:e.abortSignal,fetch:this.config.fetch}),b=v.candidates[0],x=[],S=(n=(t=b.content)?.parts)??[],C=v.usageMetadata,w;for(let e of S)if(`executableCode`in e&&(r=e.executableCode)?.code){let t=this.config.generateId();w=t,x.push({type:`tool-call`,toolCallId:t,toolName:`code_execution`,input:JSON.stringify(e.executableCode),providerExecuted:!0})}else `codeExecutionResult`in e&&e.codeExecutionResult?(x.push({type:`tool-result`,toolCallId:w,toolName:`code_execution`,result:{outcome:e.codeExecutionResult.outcome,output:e.codeExecutionResult.output},providerExecuted:!0}),w=void 0):`text`in e&&e.text!=null&&e.text.length>0?x.push({type:e.thought===!0?`reasoning`:`text`,text:e.text,providerMetadata:e.thoughtSignature?{google:{thoughtSignature:e.thoughtSignature}}:void 0}):`functionCall`in e?x.push({type:`tool-call`,toolCallId:this.config.generateId(),toolName:e.functionCall.name,input:JSON.stringify(e.functionCall.args),providerMetadata:e.thoughtSignature?{google:{thoughtSignature:e.thoughtSignature}}:void 0}):`inlineData`in e&&x.push({type:`file`,data:e.inlineData.data,mediaType:e.inlineData.mimeType});let T=(i=Bp({groundingMetadata:b.groundingMetadata,generateId:this.config.generateId}))??[];for(let e of T)x.push(e);return{content:x,finishReason:Ap({finishReason:b.finishReason,hasToolCalls:x.some(e=>e.type===`tool-call`)}),usage:{inputTokens:(a=C?.promptTokenCount)??void 0,outputTokens:(o=C?.candidatesTokenCount)??void 0,totalTokens:(s=C?.totalTokenCount)??void 0,reasoningTokens:(c=C?.thoughtsTokenCount)??void 0,cachedInputTokens:(l=C?.cachedContentTokenCount)??void 0},warnings:m,providerMetadata:{google:{groundingMetadata:(u=b.groundingMetadata)??null,urlContextMetadata:(d=b.urlContextMetadata)??null,safetyRatings:(f=b.safetyRatings)??null,usageMetadata:C??null}},request:{body:h},response:{headers:_,body:y}}}async doStream(e){let{args:t,warnings:n}=await this.getArgs(e),r=JSON.stringify(t),i=B(await G(this.config.headers),e.headers),{responseHeaders:a,value:o}=await U({url:`${this.config.baseURL}/${Dp(this.modelId)}:streamGenerateContent?alt=sse`,headers:i,body:t,failedResponseHandler:yp,successfulResponseHandler:Tt(Gp),abortSignal:e.abortSignal,fetch:this.config.fetch}),s=`unknown`,c={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},l,u=this.config.generateId,d=!1,f=null,p=null,m=0,h=new Set,g;return{stream:o.pipeThrough(new TransformStream({start(e){e.enqueue({type:`stream-start`,warnings:n})},transform(t,n){var r,i,a,o,_,v,y,b,x,S,C;if(e.includeRawChunks&&n.enqueue({type:`raw`,rawValue:t.rawValue}),!t.success){n.enqueue({type:`error`,error:t.error});return}let w=t.value,T=w.usageMetadata;T!=null&&(c.inputTokens=(r=T.promptTokenCount)??void 0,c.outputTokens=(i=T.candidatesTokenCount)??void 0,c.totalTokens=(a=T.totalTokenCount)??void 0,c.reasoningTokens=(o=T.thoughtsTokenCount)??void 0,c.cachedInputTokens=(_=T.cachedContentTokenCount)??void 0);let E=(v=w.candidates)?.[0];if(E==null)return;let D=E.content,O=Bp({groundingMetadata:E.groundingMetadata,generateId:u});if(O!=null)for(let e of O)e.sourceType===`url`&&!h.has(e.url)&&(h.add(e.url),n.enqueue(e));if(D!=null){let e=(y=D.parts)??[];for(let t of e)if(`executableCode`in t&&(b=t.executableCode)?.code){let e=u();g=e,n.enqueue({type:`tool-call`,toolCallId:e,toolName:`code_execution`,input:JSON.stringify(t.executableCode),providerExecuted:!0}),d=!0}else if(`codeExecutionResult`in t&&t.codeExecutionResult){let e=g;e&&(n.enqueue({type:`tool-result`,toolCallId:e,toolName:`code_execution`,result:{outcome:t.codeExecutionResult.outcome,output:t.codeExecutionResult.output},providerExecuted:!0}),g=void 0)}else `text`in t&&t.text!=null&&t.text.length>0&&(t.thought===!0?(f!==null&&(n.enqueue({type:`text-end`,id:f}),f=null),p===null&&(p=String(m++),n.enqueue({type:`reasoning-start`,id:p,providerMetadata:t.thoughtSignature?{google:{thoughtSignature:t.thoughtSignature}}:void 0})),n.enqueue({type:`reasoning-delta`,id:p,delta:t.text,providerMetadata:t.thoughtSignature?{google:{thoughtSignature:t.thoughtSignature}}:void 0})):(p!==null&&(n.enqueue({type:`reasoning-end`,id:p}),p=null),f===null&&(f=String(m++),n.enqueue({type:`text-start`,id:f,providerMetadata:t.thoughtSignature?{google:{thoughtSignature:t.thoughtSignature}}:void 0})),n.enqueue({type:`text-delta`,id:f,delta:t.text,providerMetadata:t.thoughtSignature?{google:{thoughtSignature:t.thoughtSignature}}:void 0})));let t=zp(D.parts);if(t!=null)for(let e of t)n.enqueue({type:`file`,mediaType:e.inlineData.mimeType,data:e.inlineData.data});let r=Rp({parts:D.parts,generateId:u});if(r!=null)for(let e of r)n.enqueue({type:`tool-input-start`,id:e.toolCallId,toolName:e.toolName,providerMetadata:e.providerMetadata}),n.enqueue({type:`tool-input-delta`,id:e.toolCallId,delta:e.args,providerMetadata:e.providerMetadata}),n.enqueue({type:`tool-input-end`,id:e.toolCallId,providerMetadata:e.providerMetadata}),n.enqueue({type:`tool-call`,toolCallId:e.toolCallId,toolName:e.toolName,input:e.args,providerMetadata:e.providerMetadata}),d=!0}E.finishReason!=null&&(s=Ap({finishReason:E.finishReason,hasToolCalls:d}),l={google:{groundingMetadata:(x=E.groundingMetadata)??null,urlContextMetadata:(S=E.urlContextMetadata)??null,safetyRatings:(C=E.safetyRatings)??null}},T!=null&&(l.google.usageMetadata=T))},flush(e){f!==null&&e.enqueue({type:`text-end`,id:f}),p!==null&&e.enqueue({type:`reasoning-end`,id:p}),e.enqueue({type:`finish`,finishReason:s,usage:c,providerMetadata:l})}})),response:{headers:a},request:{body:r}}}};function Rp({parts:e,generateId:t}){let n=e?.filter(e=>`functionCall`in e);return n==null||n.length===0?void 0:n.map(e=>({type:`tool-call`,toolCallId:t(),toolName:e.functionCall.name,args:JSON.stringify(e.functionCall.args),providerMetadata:e.thoughtSignature?{google:{thoughtSignature:e.thoughtSignature}}:void 0}))}function zp(e){return e?.filter(e=>`inlineData`in e)}function Bp({groundingMetadata:e,generateId:t}){var n;return(n=e?.groundingChunks)?.filter(e=>e.web!=null).map(e=>({type:`source`,sourceType:`url`,id:t(),url:e.web.uri,title:e.web.title}))}var Vp=a.object({parts:a.array(a.union([a.object({functionCall:a.object({name:a.string(),args:a.unknown()}),thoughtSignature:a.string().nullish()}),a.object({inlineData:a.object({mimeType:a.string(),data:a.string()})}),a.object({executableCode:a.object({language:a.string(),code:a.string()}).nullish(),codeExecutionResult:a.object({outcome:a.string(),output:a.string()}).nullish(),text:a.string().nullish(),thought:a.boolean().nullish(),thoughtSignature:a.string().nullish()})])).nullish()}),Hp=a.object({category:a.string().nullish(),probability:a.string().nullish(),probabilityScore:a.number().nullish(),severity:a.string().nullish(),severityScore:a.number().nullish(),blocked:a.boolean().nullish()}),Up=a.object({cachedContentTokenCount:a.number().nullish(),thoughtsTokenCount:a.number().nullish(),promptTokenCount:a.number().nullish(),candidatesTokenCount:a.number().nullish(),totalTokenCount:a.number().nullish()}),Wp=a.object({candidates:a.array(a.object({content:Vp.nullish().or(a.object({}).strict()),finishReason:a.string().nullish(),safetyRatings:a.array(Hp).nullish(),groundingMetadata:Mp.nullish(),urlContextMetadata:Fp.nullish()})),usageMetadata:Up.nullish()}),Gp=a.object({candidates:a.array(a.object({content:Vp.nullish(),finishReason:a.string().nullish(),safetyRatings:a.array(Hp).nullish(),groundingMetadata:Mp.nullish(),urlContextMetadata:Fp.nullish()})).nullish(),usageMetadata:Up.nullish()}),Kp=Ct({id:`google.code_execution`,name:`code_execution`,inputSchema:a.object({language:a.string().describe(`The programming language of the code.`),code:a.string().describe(`The code to be executed.`)}),outputSchema:a.object({outcome:a.string().describe(`The outcome of the execution (e.g., "OUTCOME_OK").`),output:a.string().describe(`The output from the code execution.`)})}),qp={googleSearch:Np,urlContext:Ip,codeExecution:Kp},Jp=class{constructor(e,t,n){this.modelId=e,this.settings=t,this.config=n,this.specificationVersion=`v2`}get maxImagesPerCall(){var e;return(e=this.settings.maxImagesPerCall)??4}get provider(){return this.config.provider}async doGenerate(e){var t,n,r;let{prompt:i,n:a=1,size:o=`1024x1024`,aspectRatio:s=`1:1`,seed:c,providerOptions:l,headers:u,abortSignal:d}=e,f=[];o!=null&&f.push({type:`unsupported-setting`,setting:`size`,details:"This model does not support the `size` option. Use `aspectRatio` instead."}),c!=null&&f.push({type:`unsupported-setting`,setting:`seed`,details:"This model does not support the `seed` option through this provider."});let p=await H({provider:`google`,providerOptions:l,schema:Xp}),m=(r=(n=(t=this.config._internal)?.currentDate)?.call(t))??new Date,h={sampleCount:a};s!=null&&(h.aspectRatio=s),p&&Object.assign(h,p);let g={instances:[{prompt:i}],parameters:h},{responseHeaders:_,value:v}=await U({url:`${this.config.baseURL}/models/${this.modelId}:predict`,headers:B(await G(this.config.headers),u),body:g,failedResponseHandler:yp,successfulResponseHandler:K(Yp),abortSignal:d,fetch:this.config.fetch});return{images:v.predictions.map(e=>e.bytesBase64Encoded),warnings:f??[],providerMetadata:{google:{images:v.predictions.map(e=>({}))}},response:{timestamp:m,modelId:this.modelId,headers:_}}}},Yp=a.object({predictions:a.array(a.object({bytesBase64Encoded:a.string()})).default([])}),Xp=a.object({personGeneration:a.enum([`dont_allow`,`allow_adult`,`allow_all`]).nullish(),aspectRatio:a.enum([`1:1`,`3:4`,`4:3`,`9:16`,`16:9`]).nullish()});function Zp(e={}){var t;let n=(t=Rn(e.baseURL))??`https://generativelanguage.googleapis.com/v1beta`,r=()=>({"x-goog-api-key":et({apiKey:e.apiKey,environmentVariableName:`GOOGLE_GENERATIVE_AI_API_KEY`,description:`Google Generative AI`}),...e.headers}),i=t=>{var i;return new Lp(t,{provider:`google.generative-ai`,baseURL:n,headers:r,generateId:(i=e.generateId)??V,supportedUrls:()=>({"*":[RegExp(`^${n}/files/.*$`),RegExp(`^https://(?:www\\.)?youtube\\.com/watch\\?v=[\\w-]+(?:&[\\w=&.-]*)?$`),RegExp(`^https://youtu\\.be/[\\w-]+(?:\\?[\\w=&.-]*)?$`)]}),fetch:e.fetch})},a=t=>new xp(t,{provider:`google.generative-ai`,baseURL:n,headers:r,fetch:e.fetch}),o=(t,i={})=>new Jp(t,i,{provider:`google.generative-ai`,baseURL:n,headers:r,fetch:e.fetch}),s=function(e){if(new.target)throw Error(`The Google Generative AI model function cannot be called with the new keyword.`);return i(e)};return s.languageModel=i,s.chat=i,s.generativeAI=i,s.embedding=a,s.textEmbedding=a,s.textEmbeddingModel=a,s.image=o,s.imageModel=o,s.tools=qp,s}Zp(),a.object({user:a.string().optional(),reasoningEffort:a.string().optional()});var Qp=a.object({error:a.object({message:a.string(),type:a.string().nullish(),param:a.any().nullish(),code:a.union([a.string(),a.number()]).nullish()})}),$p={errorSchema:Qp,errorToMessage:e=>e.error.message},em=a.object({prompt_tokens:a.number().nullish(),completion_tokens:a.number().nullish(),total_tokens:a.number().nullish(),prompt_tokens_details:a.object({cached_tokens:a.number().nullish()}).nullish(),completion_tokens_details:a.object({reasoning_tokens:a.number().nullish(),accepted_prediction_tokens:a.number().nullish(),rejected_prediction_tokens:a.number().nullish()}).nullish()}).nullish();a.object({id:a.string().nullish(),created:a.number().nullish(),model:a.string().nullish(),choices:a.array(a.object({message:a.object({role:a.literal(`assistant`).nullish(),content:a.string().nullish(),reasoning_content:a.string().nullish(),reasoning:a.string().nullish(),tool_calls:a.array(a.object({id:a.string().nullish(),function:a.object({name:a.string(),arguments:a.string()})})).nullish()}),finish_reason:a.string().nullish()})),usage:em}),a.object({echo:a.boolean().optional(),logitBias:a.record(a.string(),a.number()).optional(),suffix:a.string().optional(),user:a.string().optional()});var tm=a.object({prompt_tokens:a.number(),completion_tokens:a.number(),total_tokens:a.number()});a.object({id:a.string().nullish(),created:a.number().nullish(),model:a.string().nullish(),choices:a.array(a.object({text:a.string(),finish_reason:a.string()})),usage:tm.nullish()}),a.object({dimensions:a.number().optional(),user:a.string().optional()}),a.object({data:a.array(a.object({embedding:a.array(a.number())})),usage:a.object({prompt_tokens:a.number()}).nullish(),providerMetadata:a.record(a.string(),a.record(a.string(),a.any())).optional()});var nm=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion=`v2`,this.maxImagesPerCall=10}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:n,aspectRatio:r,seed:i,providerOptions:a,headers:o,abortSignal:s}){var c,l,u,d,f;let p=[];r!=null&&p.push({type:`unsupported-setting`,setting:`aspectRatio`,details:"This model does not support aspect ratio. Use `size` instead."}),i!=null&&p.push({type:`unsupported-setting`,setting:`seed`});let m=(u=(l=(c=this.config._internal)?.currentDate)?.call(c))??new Date,{value:h,responseHeaders:g}=await U({url:this.config.url({path:`/images/generations`,modelId:this.modelId}),headers:B(this.config.headers(),o),body:{model:this.modelId,prompt:e,n:t,size:n,...(d=a.openai)??{},response_format:`b64_json`},failedResponseHandler:wt((f=this.config.errorStructure)??$p),successfulResponseHandler:K(rm),abortSignal:s,fetch:this.config.fetch});return{images:h.data.map(e=>e.b64_json),warnings:p,response:{timestamp:m,modelId:this.modelId,headers:g}}}},rm=a.object({data:a.array(a.object({b64_json:a.string()}))});function im(e){let t=[],n=[];for(let{role:n,content:r}of e)switch(n){case`system`:t.push({role:`system`,content:r});break;case`user`:if(r.length===1&&r[0].type===`text`){t.push({role:`user`,content:r[0].text});break}t.push({role:`user`,content:r.map(e=>{switch(e.type){case`text`:return{type:`text`,text:e.text};case`file`:if(e.mediaType.startsWith(`image/`)){let t=e.mediaType===`image/*`?`image/jpeg`:e.mediaType;return{type:`image_url`,image_url:{url:e.data instanceof URL?e.data.toString():`data:${t};base64,${Ln(e.data)}`}}}else throw new z({functionality:`file part media type ${e.mediaType}`})}})});break;case`assistant`:{let e=``,n=[];for(let t of r)switch(t.type){case`text`:e+=t.text;break;case`tool-call`:n.push({id:t.toolCallId,type:`function`,function:{name:t.toolName,arguments:JSON.stringify(t.input)}});break}t.push({role:`assistant`,content:e,tool_calls:n.length>0?n:void 0});break}case`tool`:for(let e of r){let n=e.output,r;switch(n.type){case`text`:case`error-text`:r=n.value;break;case`content`:case`json`:case`error-json`:r=JSON.stringify(n.value);break}t.push({role:`tool`,tool_call_id:e.toolCallId,content:r})}break;default:{let e=n;throw Error(`Unsupported role: ${e}`)}}return{messages:t,warnings:n}}function am({id:e,model:t,created:n}){return{id:e??void 0,modelId:t??void 0,timestamp:n==null?void 0:new Date(n*1e3)}}function om(e){switch(e){case`stop`:return`stop`;case`length`:return`length`;case`tool_calls`:case`function_call`:return`tool-calls`;case`content_filter`:return`content-filter`;default:return`unknown`}}var sm=a.object({type:a.literal(`web`),country:a.string().length(2).optional(),excludedWebsites:a.array(a.string()).max(5).optional(),allowedWebsites:a.array(a.string()).max(5).optional(),safeSearch:a.boolean().optional()}),cm=a.object({type:a.literal(`x`),xHandles:a.array(a.string()).optional()}),lm=a.object({type:a.literal(`news`),country:a.string().length(2).optional(),excludedWebsites:a.array(a.string()).max(5).optional(),safeSearch:a.boolean().optional()}),um=a.object({type:a.literal(`rss`),links:a.array(a.string().url()).max(1)}),dm=a.discriminatedUnion(`type`,[sm,cm,lm,um]),fm=a.object({reasoningEffort:a.enum([`low`,`high`]).optional(),searchParameters:a.object({mode:a.enum([`off`,`auto`,`on`]),returnCitations:a.boolean().optional(),fromDate:a.string().optional(),toDate:a.string().optional(),maxSearchResults:a.number().min(1).max(50).optional(),sources:a.array(dm).optional()}).optional()}),pm=a.object({error:a.object({message:a.string(),type:a.string().nullish(),param:a.any().nullish(),code:a.union([a.string(),a.number()]).nullish()})}),mm=wt({errorSchema:pm,errorToMessage:e=>e.error.message});function hm({tools:e,toolChoice:t}){e=e?.length?e:void 0;let n=[];if(e==null)return{tools:void 0,toolChoice:void 0,toolWarnings:n};let r=[];for(let t of e)t.type===`provider-defined`?n.push({type:`unsupported-tool`,tool:t}):r.push({type:`function`,function:{name:t.name,description:t.description,parameters:t.inputSchema}});if(t==null)return{tools:r,toolChoice:void 0,toolWarnings:n};let i=t.type;switch(i){case`auto`:case`none`:return{tools:r,toolChoice:i,toolWarnings:n};case`required`:return{tools:r,toolChoice:`required`,toolWarnings:n};case`tool`:return{tools:r,toolChoice:{type:`function`,function:{name:t.toolName}},toolWarnings:n};default:{let e=i;throw new z({functionality:`tool choice type: ${e}`})}}}var gm=class{constructor(e,t){this.specificationVersion=`v2`,this.supportedUrls={"image/*":[/^https?:\/\/.*$/]},this.modelId=e,this.config=t}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,topK:i,frequencyPenalty:a,presencePenalty:o,stopSequences:s,seed:c,responseFormat:l,providerOptions:u,tools:d,toolChoice:f}){var p,m,h;let g=[],_=(p=await H({provider:`xai`,providerOptions:u,schema:fm}))??{};i!=null&&g.push({type:`unsupported-setting`,setting:`topK`}),a!=null&&g.push({type:`unsupported-setting`,setting:`frequencyPenalty`}),o!=null&&g.push({type:`unsupported-setting`,setting:`presencePenalty`}),s!=null&&g.push({type:`unsupported-setting`,setting:`stopSequences`}),l!=null&&l.type===`json`&&l.schema!=null&&g.push({type:`unsupported-setting`,setting:`responseFormat`,details:`JSON response format schema is not supported`});let{messages:v,warnings:y}=im(e);g.push(...y);let{tools:b,toolChoice:x,toolWarnings:S}=hm({tools:d,toolChoice:f});g.push(...S);let C={model:this.modelId,max_tokens:t,temperature:n,top_p:r,seed:c,reasoning_effort:_.reasoningEffort,response_format:l?.type===`json`?l.schema==null?{type:`json_object`}:{type:`json_schema`,json_schema:{name:(m=l.name)??`response`,schema:l.schema,strict:!0}}:void 0,search_parameters:_.searchParameters?{mode:_.searchParameters.mode,return_citations:_.searchParameters.returnCitations,from_date:_.searchParameters.fromDate,to_date:_.searchParameters.toDate,max_search_results:_.searchParameters.maxSearchResults,sources:(h=_.searchParameters.sources)?.map(e=>({type:e.type,...e.type===`web`&&{country:e.country,excluded_websites:e.excludedWebsites,allowed_websites:e.allowedWebsites,safe_search:e.safeSearch},...e.type===`x`&&{x_handles:e.xHandles},...e.type===`news`&&{country:e.country,excluded_websites:e.excludedWebsites,safe_search:e.safeSearch},...e.type===`rss`&&{links:e.links}}))}:void 0,messages:v,tools:b,tool_choice:x};return{args:C,warnings:g}}async doGenerate(e){var t,n,r;let{args:i,warnings:a}=await this.getArgs(e),{responseHeaders:o,value:s,rawValue:c}=await U({url:`${(t=this.config.baseURL)??`https://api.x.ai/v1`}/chat/completions`,headers:B(this.config.headers(),e.headers),body:i,failedResponseHandler:mm,successfulResponseHandler:K(vm),abortSignal:e.abortSignal,fetch:this.config.fetch}),l=s.choices[0],u=[];if(l.message.content!=null&&l.message.content.length>0){let e=l.message.content,t=i.messages[i.messages.length-1];t?.role===`assistant`&&e===t.content&&(e=``),e.length>0&&u.push({type:`text`,text:e})}if(l.message.reasoning_content!=null&&l.message.reasoning_content.length>0&&u.push({type:`reasoning`,text:l.message.reasoning_content}),l.message.tool_calls!=null)for(let e of l.message.tool_calls)u.push({type:`tool-call`,toolCallId:e.id,toolName:e.function.name,input:e.function.arguments});if(s.citations!=null)for(let e of s.citations)u.push({type:`source`,sourceType:`url`,id:this.config.generateId(),url:e});return{content:u,finishReason:om(l.finish_reason),usage:{inputTokens:s.usage.prompt_tokens,outputTokens:s.usage.completion_tokens,totalTokens:s.usage.total_tokens,reasoningTokens:(r=(n=s.usage.completion_tokens_details)?.reasoning_tokens)??void 0},request:{body:i},response:{...am(s),headers:o,body:c},warnings:a}}async doStream(e){var t;let{args:n,warnings:r}=await this.getArgs(e),i={...n,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:a,value:o}=await U({url:`${(t=this.config.baseURL)??`https://api.x.ai/v1`}/chat/completions`,headers:B(this.config.headers(),e.headers),body:i,failedResponseHandler:mm,successfulResponseHandler:Tt(ym),abortSignal:e.abortSignal,fetch:this.config.fetch}),s=`unknown`,c={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},l={},u={},d=this;return{stream:o.pipeThrough(new TransformStream({start(e){e.enqueue({type:`stream-start`,warnings:r})},transform(t,n){var r,a;if(e.includeRawChunks&&n.enqueue({type:`raw`,rawValue:t.rawValue}),!t.success){n.enqueue({type:`error`,error:t.error});return}let o=t.value;if(n.enqueue({type:`response-metadata`,...am(o)}),o.citations!=null)for(let e of o.citations)n.enqueue({type:`source`,sourceType:`url`,id:d.config.generateId(),url:e});o.usage!=null&&(c.inputTokens=o.usage.prompt_tokens,c.outputTokens=o.usage.completion_tokens,c.totalTokens=o.usage.total_tokens,c.reasoningTokens=(a=(r=o.usage.completion_tokens_details)?.reasoning_tokens)??void 0);let f=o.choices[0];if(f?.finish_reason!=null&&(s=om(f.finish_reason)),f?.delta==null)return;let p=f.delta,m=f.index;if(p.content!=null&&p.content.length>0){let e=p.content,t=i.messages[i.messages.length-1];if(t?.role===`assistant`&&e===t.content)return;let r=`text-${o.id||m}`;l[r]??(l[r]={type:`text`},n.enqueue({type:`text-start`,id:r})),n.enqueue({type:`text-delta`,id:r,delta:e})}if(p.reasoning_content!=null&&p.reasoning_content.length>0){let e=`reasoning-${o.id||m}`;if(u[e]===p.reasoning_content)return;u[e]=p.reasoning_content,l[e]??(l[e]={type:`reasoning`},n.enqueue({type:`reasoning-start`,id:e})),n.enqueue({type:`reasoning-delta`,id:e,delta:p.reasoning_content})}if(p.tool_calls!=null)for(let e of p.tool_calls){let t=e.id;n.enqueue({type:`tool-input-start`,id:t,toolName:e.function.name}),n.enqueue({type:`tool-input-delta`,id:t,delta:e.function.arguments}),n.enqueue({type:`tool-input-end`,id:t}),n.enqueue({type:`tool-call`,toolCallId:t,toolName:e.function.name,input:e.function.arguments})}},flush(e){for(let[t,n]of Object.entries(l))e.enqueue({type:n.type===`text`?`text-end`:`reasoning-end`,id:t});e.enqueue({type:`finish`,finishReason:s,usage:c})}})),request:{body:i},response:{headers:a}}}},_m=a.object({prompt_tokens:a.number(),completion_tokens:a.number(),total_tokens:a.number(),completion_tokens_details:a.object({reasoning_tokens:a.number().nullish()}).nullish()}),vm=a.object({id:a.string().nullish(),created:a.number().nullish(),model:a.string().nullish(),choices:a.array(a.object({message:a.object({role:a.literal(`assistant`),content:a.string().nullish(),reasoning_content:a.string().nullish(),tool_calls:a.array(a.object({id:a.string(),type:a.literal(`function`),function:a.object({name:a.string(),arguments:a.string()})})).nullish()}),index:a.number(),finish_reason:a.string().nullish()})),object:a.literal(`chat.completion`),usage:_m,citations:a.array(a.string().url()).nullish()}),ym=a.object({id:a.string().nullish(),created:a.number().nullish(),model:a.string().nullish(),choices:a.array(a.object({delta:a.object({role:a.enum([`assistant`]).optional(),content:a.string().nullish(),reasoning_content:a.string().nullish(),tool_calls:a.array(a.object({id:a.string(),type:a.literal(`function`),function:a.object({name:a.string(),arguments:a.string()})})).nullish()}),finish_reason:a.string().nullish(),index:a.number()})),usage:_m.nullish(),citations:a.array(a.string().url()).nullish()}),bm={errorSchema:pm,errorToMessage:e=>e.error.message};function xm(e={}){var t;let n=Rn((t=e.baseURL)??`https://api.x.ai/v1`),r=()=>({Authorization:`Bearer ${et({apiKey:e.apiKey,environmentVariableName:`XAI_API_KEY`,description:`xAI API key`})}`,...e.headers}),i=t=>new gm(t,{provider:`xai.chat`,baseURL:n,headers:r,generateId:V,fetch:e.fetch}),a=t=>new nm(t,{provider:`xai.image`,url:({path:e})=>`${n}${e}`,headers:r,fetch:e.fetch,errorStructure:bm}),o=e=>i(e);return o.languageModel=i,o.chat=i,o.textEmbeddingModel=e=>{throw new xe({modelId:e,modelType:`textEmbeddingModel`})},o.imageModel=a,o.image=a,o}xm();function Sm(e){if(!e.body)throw Error(`Response body is required`);let t=e.headers.get(n);if(!t||t===`ui-message`)return e.body.pipeThrough(new TextDecoderStream).pipeThrough(new Ve).pipeThrough(new TransformStream({async transform(e,t){if(e.data===`[DONE]`)return;let n=await gt({text:e.data});n.success?t.enqueue(n.value):t.error(n.error)}}));let r=e=>Zd({model:e,prompt:[{role:`user`,content:[{type:`text`,text:`Hello, world!`}]}]}).toUIMessageStream();switch(t){case`openai-chat`:return r(yi({apiKey:`ignored`,fetch:(t,n)=>e}).chat(`fake-model`));case`openai-response`:return r(yi({apiKey:`ignored`,fetch:(t,n)=>e}).responses(`fake-model`));case`anthropic`:return r(_p({apiKey:`ignored`,fetch:(t,n)=>e}).chat(`fake-model`));case`google`:return r(Zp({apiKey:`ignored`,fetch:(t,n)=>e}).chat(`fake-model`));case`xai`:return r(xm({apiKey:`ignored`,fetch:(t,n)=>e}).chat(`fake-model`));default:throw Error(`Unsupported response format: ${t}`)}}function Cm(e){return new Tm(e)}function wm(e){return new Tm(`http://agent.local`,{fetch:async(t,n)=>e.fetch(new Request(t,n))})}var Tm=class{baseUrl;fetch;constructor(e,t){this.baseUrl=e,this.fetch=t?.fetch??fetch}async sendMessages(e,t){return this.fetch(`${this.baseUrl}/sendMessages`,{method:`POST`,body:JSON.stringify(e),signal:t?.abortSignal})}};export{d as AISDKError,Tm as AgentClient,So as DiagConsoleLogger,Q as DiagLogLevel,Ve as EventSourceParserStream,Go as ValueType,Mn as asSchema,Sm as convertResponseToUIMessageStream,Cm as createClient,wm as createClientFromAgent,Ge as createIdGenerator,ze as createParser,mc as diag,Uc as esm_exports,V as generateId,Rd as getToolOrDynamicToolName,Gc as init_esm,Pd as isToolUIPart,Df as lastAssistantMessageIsCompleteWithToolCalls,Sc as metrics,vt as parseJsonEventStream,G as resolve,gt as safeParseJSON,mt as safeValidateTypes,pt as validateTypes};